<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BSV Wallet Funding</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0d1117; color: #e6edf3; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
    .container { max-width: 560px; width: 100%; padding: 2rem; }
    h1 { font-size: 1.5rem; margin-bottom: 1.5rem; }
    .log { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 1rem; font-family: 'SF Mono', monospace; font-size: 0.85rem; line-height: 1.6; white-space: pre-wrap; word-break: break-all; max-height: 70vh; overflow-y: auto; }
    .log .error { color: #f85149; }
    .log .success { color: #3fb950; }
    .log .info { color: #58a6ff; }
    button { margin-top: 1rem; padding: 0.6rem 1.5rem; background: #238636; color: #fff; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; }
    button:hover { background: #2ea043; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .password-row { display: flex; gap: 0.5rem; margin-top: 1rem; }
    .password-row input { flex: 1; padding: 0.6rem 0.75rem; background: #161b22; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 1rem; outline: none; }
    .password-row input:focus { border-color: #58a6ff; }
  </style>
  <script type="module" crossorigin>var Ei=Object.defineProperty;var Ai=(r,t,e)=>t in r?Ei(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var l=(r,t,e)=>Ai(r,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const De=typeof globalThis<"u"?globalThis.Buffer:void 0,Pi=De!=null&&typeof De.from=="function",ne=new Int8Array(256).fill(-1);for(let r=0;r<10;r++)ne[48+r]=r;for(let r=0;r<6;r++)ne[65+r]=10+r,ne[97+r]=10+r;const A=class A{constructor(t=0,e=10,n="be"){l(this,"_magnitude");l(this,"_sign");l(this,"_nominalWordLength");l(this,"red");if(this._magnitude=0n,this._sign=0,this._nominalWordLength=1,this.red=null,t===void 0&&(t=0),t===null){this._initializeState(0n,0);return}if(typeof t=="bigint"){this._initializeState(t<0n?-t:t,t<0n?1:0),this.normSign();return}let i=e,s=n;if((e==="le"||e==="be")&&(s=e,i=10),typeof t=="number"){this.initNumber(t,s);return}if(Array.isArray(t)){this.initArray(t,s);return}if(typeof t=="string"){i==="hex"&&(i=16),this.assert(typeof i=="number"&&i===(i|0)&&i>=2&&i<=36,"Base must be an integer between 2 and 36");const a=t.toString().replace(/\s+/g,"");let o=0,c=0;a.startsWith("-")?(o++,c=1):a.startsWith("+")&&o++;const f=a.substring(o);if(f.length===0){this._initializeState(0n,c===1&&a.startsWith("-")?1:0),this.normSign();return}if(i===16){let u;if(s==="le"){const h=[];let b=f;b.length%2!==0&&(b="0"+b);for(let g=0;g<b.length;g+=2){const p=b.substring(g,g+2),m=parseInt(p,16);if(isNaN(m))throw new Error("Invalid character in "+b);h.push(m)}this.initArray(h,"le"),this._sign=c,this.normSign();return}else try{u=BigInt("0x"+f)}catch{throw new Error("Invalid character in "+f)}this._initializeState(u,c),this.normSign()}else try{if(this._parseBaseString(f,i),this._sign=c,this.normSign(),s==="le"){const u=this._sign;this.initArray(this.toArray("be"),"le"),this._sign=u,this.normSign()}}catch(u){const h=u;throw h.message.includes("Invalid character in string")||h.message.includes("Invalid digit for base")||h.message.startsWith("Invalid character:")?new Error("Invalid character"):h}}else t!==0?this.assert(!1,"Unsupported input type for BigNumber constructor"):this._initializeState(0n,0)}get negative(){return this._sign}set negative(t){this.assert(t===0||t===1,"Negative property must be 0 or 1");const e=t===1?1:0;this._magnitude===0n?this._sign=0:this._sign=e}get _computedWordsArray(){if(this._magnitude===0n)return[0];const t=[];let e=this._magnitude;for(;e>0n;)t.push(Number(e&A.WORD_MASK)),e>>=A.WORD_SIZE_BIGINT;return t.length>0?t:[0]}get words(){const t=this._computedWordsArray;if(this._nominalWordLength<=t.length)return t;const e=new Array(this._nominalWordLength).fill(0);for(let n=0;n<t.length;n++)e[n]=t[n];return e}set words(t){const e=this._sign;let n=0n;const i=t.length>0?t.length:1;for(let s=i-1;s>=0;s--){const a=t[s]===void 0?0:t[s];n=n<<A.WORD_SIZE_BIGINT|BigInt(a&Number(A.WORD_MASK))}this._magnitude=n,this._sign=e,this._nominalWordLength=i,this.normSign()}get length(){return Math.max(1,this._nominalWordLength)}static isBN(t){var e;return t instanceof A?!0:t!==null&&typeof t=="object"&&((e=t.constructor)==null?void 0:e.wordSize)===A.wordSize&&Array.isArray(t.words)}static max(t,e){return t.cmp(e)>0?t:e}static min(t,e){return t.cmp(e)<0?t:e}_bigIntToStringInBase(t,e){if(t===0n)return"0";if(e<2||e>36)throw new Error("Base must be between 2 and 36");const n="0123456789abcdefghijklmnopqrstuvwxyz";let i="",s=t>0n?t:-t;const a=BigInt(e);for(;s>0n;)i=n[Number(s%a)]+i,s/=a;return i}_parseBaseString(t,e){if(t.length===0){this._magnitude=0n,this._finishInitialization();return}this._magnitude=0n;const n=BigInt(e);let i=A.groupSizes[e],s=BigInt(A.groupBases[e]);(i===0||s===0n)&&(i=Math.floor(Math.log(67108863)/Math.log(e)),i===0&&(i=1),s=n**BigInt(i));let a=0;const o=t.length;let c=o%i;if(c===0&&o>0&&(c=i),c>0){const f=t.substring(a,a+c);this._magnitude=BigInt(this._parseBaseWord(f,e)),a+=c}for(;a<o;){const f=t.substring(a,a+i),u=BigInt(this._parseBaseWord(f,e));this._magnitude=this._magnitude*s+u,a+=i}this._finishInitialization()}_parseBaseWord(t,e){let n=0;for(let i=0;i<t.length;i++){const s=t.charCodeAt(i);let a;if(s>=48&&s<=57)a=s-48;else if(s>=65&&s<=90)a=s-65+10;else if(s>=97&&s<=122)a=s-97+10;else throw new Error("Invalid character: "+t[i]);if(a>=e)throw new Error("Invalid character");n=n*e+a}return n}_initializeState(t,e){this._magnitude=t,this._sign=t===0n?0:e,this._finishInitialization()}_finishInitialization(){if(this._magnitude===0n)this._nominalWordLength=1,this._sign=0;else{const t=this._magnitude.toString(2).length;this._nominalWordLength=Math.max(1,Math.ceil(t/A.wordSize))}}assert(t,e="Assertion failed"){if(!t)throw new Error(e)}initNumber(t,e="be"){if(this.assert(BigInt(Math.abs(t))<=A.MAX_NUMBER_CONSTRUCTOR_MAG_BIGINT,"The number is larger than 2 ^ 53 (unsafe)"),this.assert(t%1===0,"Number must be an integer for BigNumber conversion"),this._initializeState(BigInt(Math.abs(t)),t<0?1:0),e==="le"){const n=this._sign,i=this.toArray("be");this.initArray(i,"le"),this._sign=n,this.normSign()}return this}initArray(t,e){if(t.length===0)return this._initializeState(0n,0),this;let n=0n;if(e==="be")for(let i=0;i<t.length;i++)n=n<<8n|BigInt(t[i]&255);else for(let i=t.length-1;i>=0;i--)n=n<<8n|BigInt(t[i]&255);return this._initializeState(n,0),this}copy(t){t._magnitude=this._magnitude,t._sign=this._sign,t._nominalWordLength=this._nominalWordLength,t.red=this.red}static move(t,e){t._magnitude=e._magnitude,t._sign=e._sign,t._nominalWordLength=e._nominalWordLength,t.red=e.red}clone(){const t=new A(0n);return this.copy(t),t}expand(t){return this.assert(t>=0,"Expand size must be non-negative"),this._nominalWordLength=Math.max(this._nominalWordLength,t,1),this}strip(){return this._finishInitialization(),this.normSign()}normSign(){return this._magnitude===0n&&(this._sign=0),this}inspect(){return(this.red!==null?"<BN-R: ":"<BN: ")+this.toString(16)+">"}_getMinimalHex(){return this._magnitude===0n?"0":this._magnitude.toString(16)}toString(t=10,e=1){if(t===16||t==="hex"){let n=this._getMinimalHex();if(e>1)for(n!=="0"&&n.length%2!==0&&(n="0"+n);n.length%e!==0;)n="0"+n;return(this.isNeg()?"-":"")+n}if(typeof t!="number"||t<2||t>36||t%1!==0)throw new Error("Base should be an integer between 2 and 36");return this.toBaseString(t,e)}toBaseString(t,e){if(this._magnitude===0n){let o="0";if(e>1)for(;o.length<e;)o="0"+o;return o}let n=A.groupSizes[t],i=BigInt(A.groupBases[t]);(n===0||i===0n)&&(n=Math.floor(Math.log(Number.MAX_SAFE_INTEGER)/Math.log(t)),n===0&&(n=1),i=BigInt(t)**BigInt(n));let s="",a=this._magnitude;for(;a>0n;){const o=a%i;a/=i;const c=this._bigIntToStringInBase(o,t);if(a>0n){const f=n-c.length;f>0&&f<A.zeros.length?s=A.zeros[f]+c+s:f>0?s="0".repeat(f)+c+s:s=c+s}else s=c+s}if(e>0)for(;s.length<e;)s="0"+s;return(this._sign===1?"-":"")+s}toNumber(){const t=this._getSignedValue();if(t>A.MAX_SAFE_INTEGER_BIGINT||t<A.MIN_SAFE_INTEGER_BIGINT)throw new Error("Number can only safely store up to 53 bits");return Number(t)}toBigInt(){return this._getSignedValue()}toJSON(){const t=this._getMinimalHex();return(this.isNeg()?"-":"")+t}toArrayLikeGeneric(t,e){let n=this._magnitude,i=e?0:t.length-1;const s=e?1:-1;for(let a=0;a<t.length;++a){if(n===0n&&i>=0&&i<t.length)t[i]=0;else if(i>=0&&i<t.length)t[i]=Number(n&0xffn);else break;n>>=8n,i+=s}}toArray(t="be",e){this.strip();const n=this.byteLength(),i=e??Math.max(1,n);this.assert(n<=i,"byte array longer than desired length"),this.assert(i>0,"Requested array length <= 0");const s=new Array(i).fill(0);return this._magnitude===0n&&i>0?s:this._magnitude===0n&&i===0?[]:(this.toArrayLikeGeneric(s,t==="le"),s)}bitLength(){return this._magnitude===0n?0:this._magnitude.toString(2).length}static toBitArray(t){const e=t.bitLength();if(e===0)return[];const n=new Array(e),i=t._magnitude;for(let s=0;s<e;s++)n[s]=(i>>BigInt(s)&1n)!==0n?1:0;return n}toBitArray(){return A.toBitArray(this)}zeroBits(){if(this._magnitude===0n)return 0;let t=0,e=this._magnitude;for(;(e&1n)===0n&&e!==0n;)t++,e>>=1n;return t}byteLength(){return this._magnitude===0n?0:Math.ceil(this.bitLength()/8)}_getSignedValue(){return this._sign===1?-this._magnitude:this._magnitude}_setValueFromSigned(t){t<0n?(this._magnitude=-t,this._sign=1):(this._magnitude=t,this._sign=0),this._finishInitialization(),this.normSign()}toTwos(t){this.assert(t>=0);const e=BigInt(t);let n=this._getSignedValue();this._sign===1&&this._magnitude!==0n&&(n=(1n<<e)+n);const i=(1n<<e)-1n;n&=i;const s=new A(0n);return s._initializeState(n,0),s}fromTwos(t){this.assert(t>=0);const e=BigInt(t),n=this._magnitude;if(t>0&&(n>>e-1n&1n)!==0n&&this._sign===0){const i=n-(1n<<e),s=new A(0n);return s._setValueFromSigned(i),s}return this.clone()}isNeg(){return this._sign===1&&this._magnitude!==0n}neg(){return this.clone().ineg()}ineg(){return this._magnitude!==0n&&(this._sign=this._sign===1?0:1),this}_iuop(t,e){const n=e(this._magnitude,t._magnitude),i=e===((a,o)=>a^o);let s=this._nominalWordLength;return i&&(s=Math.max(this.length,t.length)),this._magnitude=n,this._finishInitialization(),i&&(this._nominalWordLength=Math.max(this._nominalWordLength,s)),this.strip()}iuor(t){return this._iuop(t,(e,n)=>e|n)}iuand(t){return this._iuop(t,(e,n)=>e&n)}iuxor(t){return this._iuop(t,(e,n)=>e^n)}_iop(t,e){return this.assert(this._sign===0&&t._sign===0),this._iuop(t,e)}ior(t){return this._iop(t,(e,n)=>e|n)}iand(t){return this._iop(t,(e,n)=>e&n)}ixor(t){return this._iop(t,(e,n)=>e^n)}_uop_new(t,e){return this.length>=t.length?this.clone()[e](t):t.clone()[e](this)}or(t){return this.assert(this._sign===0&&t._sign===0),this._uop_new(t,"iuor")}uor(t){return this._uop_new(t,"iuor")}and(t){return this.assert(this._sign===0&&t._sign===0),this._uop_new(t,"iuand")}uand(t){return this._uop_new(t,"iuand")}xor(t){return this.assert(this._sign===0&&t._sign===0),this._uop_new(t,"iuxor")}uxor(t){return this._uop_new(t,"iuxor")}inotn(t){this.assert(typeof t=="number"&&t>=0);const n=(1n<<BigInt(t))-1n;this._magnitude=~this._magnitude&n;const i=t===0?1:Math.ceil(t/A.wordSize);return this._nominalWordLength=Math.max(1,i),this.strip(),this._nominalWordLength=Math.max(this._nominalWordLength,Math.max(1,i)),this}notn(t){return this.clone().inotn(t)}setn(t,e){this.assert(typeof t=="number"&&t>=0);const n=BigInt(t);e===1||e===!0?this._magnitude|=1n<<n:this._magnitude&=~(1n<<n);const i=Math.floor(t/A.wordSize)+1;return this._nominalWordLength=Math.max(this._nominalWordLength,i),this._finishInitialization(),this.strip()}iadd(t){return this._setValueFromSigned(this._getSignedValue()+t._getSignedValue()),this}add(t){const e=new A(0n);return e._setValueFromSigned(this._getSignedValue()+t._getSignedValue()),e}isub(t){return this._setValueFromSigned(this._getSignedValue()-t._getSignedValue()),this}sub(t){const e=new A(0n);return e._setValueFromSigned(this._getSignedValue()-t._getSignedValue()),e}mul(t){const e=new A(0n);return e._magnitude=this._magnitude*t._magnitude,e._sign=e._magnitude===0n?0:this._sign^t._sign,e._nominalWordLength=this.length+t.length,e.red=null,e.normSign()}imul(t){return this._magnitude*=t._magnitude,this._sign=this._magnitude===0n?0:this._sign^t._sign,this._nominalWordLength=this.length+t.length,this.red=null,this.normSign()}imuln(t){return this.assert(typeof t=="number","Assertion failed"),this.assert(Math.abs(t)<=A.MAX_IMULN_ARG,"Assertion failed"),this._setValueFromSigned(this._getSignedValue()*BigInt(t)),this}muln(t){return this.clone().imuln(t)}sqr(){const t=new A(0n);return t._magnitude=this._magnitude*this._magnitude,t._sign=0,t._nominalWordLength=this.length*2,t.red=null,t}isqr(){return this._magnitude*=this._magnitude,this._sign=0,this._nominalWordLength=this.length*2,this.red=null,this}pow(t){if(this.assert(t._sign===0,"Exponent for pow must be non-negative"),t.isZero())return new A(1n);const e=new A(1n),n=this.clone(),i=t.clone(),s=n.isNeg(),a=i.isOdd();for(s&&n.ineg();!i.isZero();)i.isOdd()&&e.imul(n),n.isqr(),i.iushrn(1);return s&&a&&e.ineg(),e}static normalizeNonNegativeBigInt(t,e){if(typeof t=="number"){if(!Number.isFinite(t)||!Number.isInteger(t)||t<0)throw new Error(`${e} must be a non-negative integer`);return BigInt(t)}if(t<0n)throw new Error(`${e} must be a non-negative integer`);return t}iushln(t){const e=A.normalizeNonNegativeBigInt(t,"Shift bits");return e===0n?this:(this._magnitude<<=e,this._finishInitialization(),this.strip())}ishln(t){return this.assert(this._sign===0,"ishln requires positive number"),this.iushln(t)}iushrn(t,e,n){const i=A.normalizeNonNegativeBigInt(t,"Shift bits");if(i===0n)return n!=null&&n._initializeState(0n,0),this;if(n!=null){const s=(1n<<i)-1n,a=this._magnitude&s;n._initializeState(a,0)}return this._magnitude>>=i,this._finishInitialization(),this.strip()}ishrn(t,e,n){return this.assert(this._sign===0,"ishrn requires positive number"),this.iushrn(t,e,n)}shln(t){return this.clone().ishln(t)}ushln(t){return this.clone().iushln(t)}shrn(t){return this.clone().ishrn(t)}ushrn(t){return this.clone().iushrn(t)}testn(t){return this.assert(typeof t=="number"&&t>=0),(this._magnitude>>BigInt(t)&1n)!==0n}imaskn(t){this.assert(typeof t=="number"&&t>=0),this.assert(this._sign===0,"imaskn works only with positive numbers");const e=BigInt(t),n=e===0n?0n:(1n<<e)-1n;this._magnitude&=n;const i=t===0?1:Math.max(1,Math.ceil(t/A.wordSize));return this._nominalWordLength=i,this._finishInitialization(),this._nominalWordLength=Math.max(this._nominalWordLength,i),this.strip()}maskn(t){return this.clone().imaskn(t)}iaddn(t){return this.assert(typeof t=="number"),this.assert(Math.abs(t)<=A.MAX_IMULN_ARG,"num is too large"),this._setValueFromSigned(this._getSignedValue()+BigInt(t)),this}_iaddn(t){return this.iaddn(t)}isubn(t){return this.assert(typeof t=="number"),this.assert(Math.abs(t)<=A.MAX_IMULN_ARG,"Assertion failed"),this._setValueFromSigned(this._getSignedValue()-BigInt(t)),this}addn(t){return this.clone().iaddn(t)}subn(t){return this.clone().isubn(t)}iabs(){return this._sign=0,this}abs(){return this.clone().iabs()}divmod(t,e,n){if(this.assert(!t.isZero(),"Division by zero"),this.isZero()){const u=new A(0n);return{div:e!=="mod"?u:null,mod:e!=="div"?u:null}}const i=this._getSignedValue(),s=t._getSignedValue();let a=null,o=null;e!=="mod"&&(a=i/s),e!=="div"&&(o=i%s,n===!0&&o<0n&&(o+=s<0n?-s:s));const c=a!==null?new A(0n):null;c!==null&&a!==null&&c._setValueFromSigned(a);const f=o!==null?new A(0n):null;return f!==null&&o!==null&&f._setValueFromSigned(o),{div:c,mod:f}}div(t){return this.divmod(t,"div",!1).div}mod(t){return this.divmod(t,"mod",!1).mod}umod(t){return this.divmod(t,"mod",!0).mod}divRound(t){this.assert(!t.isZero());const e=this._getSignedValue(),n=t._getSignedValue();let i=e/n;const s=e%n;if(s===0n){const f=new A(0n);return f._setValueFromSigned(i),f}const a=s<0n?-s:s,o=n<0n?-n:n;a*2n>=o&&(e>0n&&n>0n||e<0n&&n<0n?i+=1n:i-=1n);const c=new A(0n);return c._setValueFromSigned(i),c}modrn(t){this.assert(t!==0,"Division by zero in modrn");const e=BigInt(Math.abs(t));if(e===0n)throw new Error("Division by zero in modrn");const n=this._magnitude%e;return t<0?Number(-n):Number(n)}idivn(t){return this.assert(t!==0),this.assert(Math.abs(t)<=A.MAX_IMULN_ARG,"num is too large"),this._setValueFromSigned(this._getSignedValue()/BigInt(t)),this}divn(t){return this.clone().idivn(t)}egcd(t){this.assert(t._sign===0,"p must not be negative"),this.assert(!t.isZero(),"p must not be zero");let e=this._getSignedValue(),n=t._magnitude,i=1n,s=0n,a=0n,o=1n;for(;n!==0n;){const h=e/n;let b=n;n=e%n,e=b,b=s,s=i-h*s,i=b,b=o,o=a-h*o,a=b}const c=new A(0n);c._setValueFromSigned(i);const f=new A(0n);f._setValueFromSigned(a);const u=new A(0n);return u._initializeState(e<0n?-e:e,0),{a:c,b:f,gcd:u}}gcd(t){let e=this._magnitude,n=t._magnitude;if(e===0n){const s=new A(0n);return s._setValueFromSigned(n),s.iabs()}if(n===0n){const s=new A(0n);return s._setValueFromSigned(e),s.iabs()}for(;n!==0n;){const s=e%n;e=n,n=s}const i=new A(0n);return i._initializeState(e,0),i}invm(t){this.assert(!t.isZero()&&t._sign===0,"Modulus for invm must be positive and non-zero");const e=this.egcd(t);if(!e.gcd.eqn(1))throw new Error("Inverse does not exist (numbers are not coprime).");return e.a.umod(t)}isEven(){return this._magnitude%2n===0n}isOdd(){return this._magnitude%2n===1n}andln(t){return this.assert(t>=0),Number(this._magnitude&BigInt(t))}bincn(t){this.assert(typeof t=="number"&&t>=0);const e=1n<<BigInt(t);return this._setValueFromSigned(this._getSignedValue()+e),this}isZero(){return this._magnitude===0n}cmpn(t){this.assert(Math.abs(t)<=A.MAX_IMULN_ARG,"Number is too big");const e=this._getSignedValue(),n=BigInt(t);return e<n?-1:e>n?1:0}cmp(t){const e=this._getSignedValue(),n=t._getSignedValue();return e<n?-1:e>n?1:0}ucmp(t){return this._magnitude<t._magnitude?-1:this._magnitude>t._magnitude?1:0}gtn(t){return this.cmpn(t)===1}gt(t){return this.cmp(t)===1}gten(t){return this.cmpn(t)>=0}gte(t){return this.cmp(t)>=0}ltn(t){return this.cmpn(t)===-1}lt(t){return this.cmp(t)===-1}lten(t){return this.cmpn(t)<=0}lte(t){return this.cmp(t)<=0}eqn(t){return this.cmpn(t)===0}eq(t){return this.cmp(t)===0}toRed(t){return this.assert(this.red==null,"Already a number in reduction context"),this.assert(this._sign===0,"toRed works only with positives"),t.convertTo(this).forceRed(t)}fromRed(){return this.assert(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)}forceRed(t){return this.red=t,this}redAdd(t){return this.assert(this.red,"redAdd works only with red numbers"),this.red.add(this,t)}redIAdd(t){return this.assert(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)}redSub(t){return this.assert(this.red,"redSub works only with red numbers"),this.red.sub(this,t)}redISub(t){return this.assert(this.red,"redISub works only with red numbers"),this.red.isub(this,t)}redShl(t){return this.assert(this.red,"redShl works only with red numbers"),this.red.shl(this,t)}redMul(t){return this.assert(this.red,"redMul works only with red numbers"),this.red.verify2(this,t),this.red.mul(this,t)}redIMul(t){return this.assert(this.red,"redIMul works only with red numbers"),this.red.verify2(this,t),this.red.imul(this,t)}redSqr(){return this.assert(this.red,"redSqr works only with red numbers"),this.red.verify1(this),this.red.sqr(this)}redISqr(){return this.assert(this.red,"redISqr works only with red numbers"),this.red.verify1(this),this.red.isqr(this)}redSqrt(){return this.assert(this.red,"redSqrt works only with red numbers"),this.red.verify1(this),this.red.sqrt(this)}redInvm(){return this.assert(this.red,"redInvm works only with red numbers"),this.red.verify1(this),this.red.invm(this)}redNeg(){return this.assert(this.red,"redNeg works only with red numbers"),this.red.verify1(this),this.red.neg(this)}redPow(t){return this.assert(this.red!=null&&t.red==null,"redPow(normalNum)"),this.red.verify1(this),this.red.pow(this,t)}static fromHex(t,e){let n="be";return(e==="little"||e==="le")&&(n="le"),new A(t,16,n)}toHex(t=0){if(this.isZero()&&t===0)return"";let e=this._getMinimalHex();e!=="0"&&e.length%2!==0&&(e="0"+e);const n=t*2;for(;e.length<n;)e="0"+e;return(this.isNeg()?"-":"")+e}static fromJSON(t){return new A(t,16)}static fromNumber(t){return new A(t)}static fromString(t,e){return new A(t,e)}static fromSm(t,e="big"){if(t.length===0)return new A(0n);const n=t.slice();e==="little"&&n.reverse();let i=0;n.length>0&&(n[0]&128)!==0&&(i=1,n[0]&=127);let s=0n;if(Pi){const o=De.from(n).toString("hex");s=o.length===0?0n:BigInt("0x"+o)}else{let o="";for(const c of n)o+=c<16?"0"+c.toString(16):c.toString(16);s=o.length===0?0n:BigInt("0x"+o)}const a=new A(0n);return a._initializeState(s,i),a}toSm(t="big"){if(this._magnitude===0n)return this._sign===1?[128]:[];let e=this._getMinimalHex();e.length%2!==0&&(e="0"+e);const n=e.length/2,i=new Array(n);for(let a=0,o=0;a<e.length;a+=2){const c=ne[e.charCodeAt(a)],f=ne[e.charCodeAt(a+1)];i[o++]=(c&15)<<4|f&15}let s;return this._sign===1?(i[0]&128)!==0?s=[128,...i]:(s=i.slice(),s[0]|=128):(i[0]&128)!==0?s=[0,...i]:s=i.slice(),t==="little"?s.reverse():s}static fromBits(t,e=!1){const n=t>>>24,i=t&8388607,s=(t&8388608)!==0;if(e&&s)throw new Error("negative bit set");if(n===0&&i===0){if(s&&e)throw new Error("negative bit set for zero value");return new A(0n)}const a=new A(i);return n<=3?a.iushrn((3-n)*8):a.iushln((n-3)*8),s&&a.ineg(),a}toBits(){if(this.strip(),this.isZero()&&!this.isNeg())return 0;const t=this.isNeg(),e=this.abs();let n=e.toArray("be"),i=0;for(;i<n.length-1&&n[i]===0;)i++;n=n.slice(i);let s=n.length;s===0&&!e.isZero()&&(n=[0],s=1),e.isZero()&&(s=0,n=[]);let a;if(s===0)a=0;else if(s<=3){a=0;for(let c=0;c<s;c++)a=a<<8|n[c]}else a=n[0]<<16|n[1]<<8|n[2];(a&8388608)!==0&&s<=255&&(a>>>=8,s++);let o=s<<24|a;return t&&(o|=8388608),o>>>0}static fromScriptNum(t,e=!1,n){if(n!==void 0&&t.length>n)throw new Error("script number overflow");if(t.length===0)return new A(0n);if(e&&(t[t.length-1]&127)===0&&(t.length<=1||(t[t.length-2]&128)===0))throw new Error("non-minimally encoded script number");return A.fromSm(t,"little")}toScriptNum(){return this.toSm("little")}_invmp(t){this.assert(t._sign===0,"p must not be negative for _invmp"),this.assert(!t.isZero(),"p must not be zero for _invmp");const e=this.umod(t),n=t.subn(2);if(e.red!==null)return e.redPow(n);let i=new A(1n),s=e.clone();const a=n.clone();for(;!a.isZero();)a.isOdd()&&(i=i.mul(s).umod(t)),s=s.sqr().umod(t),a.iushrn(1);return i}mulTo(t,e){return e._magnitude=this._magnitude*t._magnitude,e._sign=e._magnitude===0n?0:this._sign^t._sign,e._nominalWordLength=this.length+t.length,e.red=null,e.normSign(),e}};l(A,"zeros",["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"]),l(A,"groupSizes",[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5]),l(A,"groupBases",[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176]),l(A,"wordSize",26),l(A,"WORD_SIZE_BIGINT",BigInt(A.wordSize)),l(A,"WORD_MASK",(1n<<A.WORD_SIZE_BIGINT)-1n),l(A,"MAX_SAFE_INTEGER_BIGINT",BigInt(Number.MAX_SAFE_INTEGER)),l(A,"MIN_SAFE_INTEGER_BIGINT",BigInt(Number.MIN_SAFE_INTEGER)),l(A,"MAX_IMULN_ARG",67108863),l(A,"MAX_NUMBER_CONSTRUCTOR_MAG_BIGINT",(1n<<53n)-1n);let w=A;class Ni{constructor(t,e){l(this,"name");l(this,"p");l(this,"k");l(this,"n");l(this,"tmp");this.name=t,this.p=new w(e,16),this.n=this.p.bitLength(),this.k=new w(BigInt(1)).iushln(this.n).isub(this.p),this.tmp=this._tmp()}_tmp(){const t=new w(BigInt(0)),e=Math.ceil(this.n/w.wordSize);return t.expand(Math.max(1,e)),t}ireduce(t){const e=t;let n;do this.split(e,this.tmp),this.imulK(e),e.iadd(this.tmp),n=e.bitLength();while(n>this.n);const i=n<this.n?-1:e.ucmp(this.p);return i===0?e.words=[0]:i>0&&e.isub(this.p),e.strip(),e}split(t,e){t.iushrn(this.n,0,e)}imulK(t){return t.imul(this.k)}}let _i=class extends Ni{constructor(){super("k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}split(t,e){const i=t.words,s=t.length,a=Math.min(s,9),o=new Array(a+(s>9?1:0)).fill(0);for(let p=0;p<a;p++)o[p]=i[p];let c=a;if(s<=9){const p=new Array(c);for(let m=0;m<c;++m)p[m]=o[m];e.words=p,t.words=[0];return}let f=i[9];o[c++]=f&4194303;const u=new Array(c);for(let p=0;p<c;++p)u[p]=o[p];e.words=u;const h=new Array(Math.max(1,s-9)).fill(0);let b=0;for(let p=10;p<s;p++){const m=i[p]|0;b<h.length&&(h[b++]=(m&4194303)<<4|f>>>22),f=m}f>>>=22,b<h.length?h[b++]=f:f!==0&&h.length>0;const g=new Array(b);for(let p=0;p<b;++p)g[p]=h[p];t.words=g}imulK(t){const e=t.words,n=t.length,i=n+2,s=new Array(i).fill(0);for(let o=0;o<n;o++)s[o]=e[o];let a=0;for(let o=0;o<i;o++){const c=s[o]|0;a+=c*977,s[o]=a&67108863,a=c*64+(a/67108864|0)}return t.words=s,t}};class $n{constructor(t){l(this,"prime");l(this,"m");if(t==="k256"){const e=new _i;this.m=e.p,this.prime=e}else this.assert(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}assert(t,e="Assertion failed"){if(!t)throw new Error(e)}verify1(t){this.assert(t.negative===0,"red works only with positives"),this.assert(t.red,"red works only with red numbers")}verify2(t,e){this.assert((t.negative|e.negative)===0,"red works only with positives"),this.assert(t.red!=null&&t.red===e.red,"red works only with red numbers")}imod(t){return this.prime!=null?this.prime.ireduce(t).forceRed(this):(w.move(t,t.umod(this.m).forceRed(this)),t)}neg(t){return t.isZero()?t.clone():this.m.sub(t).forceRed(this)}add(t,e){this.verify2(t,e);const n=t.clone();return n.iadd(e),n.isub(this.m),n.isNeg()&&n.iadd(this.m),n}iadd(t,e){return this.verify2(t,e),t.iadd(e),t.isub(this.m),t.isNeg()&&t.iadd(this.m),t}sub(t,e){this.verify2(t,e);const n=t.sub(e);return n.cmpn(0)<0&&n.iadd(this.m),n.forceRed(this)}isub(t,e){this.verify2(t,e);const n=t.isub(e);return n.cmpn(0)<0&&n.iadd(this.m),n}shl(t,e){return this.verify1(t),this.imod(t.ushln(e))}imul(t,e){return this.verify2(t,e),this.imod(t.imul(e))}mul(t,e){return this.verify2(t,e),this.imod(t.mul(e))}isqr(t){return this.imul(t,t.clone())}sqr(t){return this.mul(t,t)}sqrt(t){if(t.isZero())return t.clone();const e=this.m.andln(3);if(this.assert(e%2===1),e===3){const p=this.m.add(new w(1)).iushrn(2);return this.pow(t,p)}const n=this.m.subn(1);let i=0;for(;!n.isZero()&&n.andln(1)===0;)i++,n.iushrn(1);this.assert(!n.isZero());const s=new w(1).toRed(this),a=s.redNeg(),o=this.m.subn(1).iushrn(1),c=this.m.bitLength(),f=new w(2*c*c).toRed(this);for(;this.pow(f,o).cmp(a)!==0;)f.redIAdd(a);let u=this.pow(f,n),h=this.pow(t,n.addn(1).iushrn(1)),b=this.pow(t,n),g=i;for(;b.cmp(s)!==0;){let p=b,m=0;for(;p.cmp(s)!==0;m++)p=p.redSqr();this.assert(m<g);const y=this.pow(u,new w(1).iushln(g-m-1));h=h.redMul(y),u=y.redSqr(),b=b.redMul(u),g=m}return h}invm(t){const e=t._invmp(this.m);return e.negative!==0?(e.negative=0,this.imod(e).redNeg()):this.imod(e)}pow(t,e){if(this.verify1(t),e.isZero())return new w(1).toRed(this);let n=new w(1).toRed(this);const i=t.clone(),s=e.bitLength();for(let a=s-1;a>=0;a--)n=this.sqr(n),e.testn(a)&&(n=this.mul(n,i));return n}convertTo(t){const e=t.umod(this.m);return e===t?e.clone():e}convertFrom(t){const e=t.clone();return e.red=null,e}}class Ti extends $n{constructor(e){super(e);l(this,"shift");l(this,"r");l(this,"r2");l(this,"rinv");l(this,"minv");this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new w(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}convertTo(e){return this.imod(e.ushln(this.shift))}convertFrom(e){const n=this.imod(e.mul(this.rinv));return n.red=null,n}imul(e,n){if(e.isZero()||n.isZero())return e.words[0]=0,e.length=1,e;const i=e.imul(n),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),a=i.isub(s).iushrn(this.shift);let o=a;return a.cmp(this.m)>=0?o=a.isub(this.m):a.cmpn(0)<0&&(o=a.iadd(this.m)),o.forceRed(this)}mul(e,n){if(e.isZero()||n.isZero())return new w(0).forceRed(this);const i=e.mul(n),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),a=i.isub(s).iushrn(this.shift);let o=a;return a.cmp(this.m)>=0?o=a.isub(this.m):a.cmpn(0)<0&&(o=a.iadd(this.m)),o.forceRed(this)}invm(e){return this.imod(e._invmp(this.m).mul(this.r2)).forceRed(this)}}class Xn{constructor(t){l(this,"curve");l(this,"type");l(this,"precomputed");this.curve=new Z,this.type=t,this.precomputed=null}}class ot extends Xn{constructor(e,n,i){super("jacobian");l(this,"x");l(this,"y");l(this,"z");l(this,"zOne");e===null&&n===null&&i===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new w(0)):(w.isBN(e)||(e=new w(e,16)),this.x=e,w.isBN(n)||(n=new w(n,16)),this.y=n,w.isBN(i)||(i=new w(i,16)),this.z=i),this.x.red==null&&(this.x=this.x.toRed(this.curve.red)),this.y.red==null&&(this.y=this.y.toRed(this.curve.red)),this.z.red==null&&(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.isInfinity()&&(this.x=this.curve.one,this.y=this.curve.one,this.z=new w(0).toRed(this.curve.red),this.zOne=!1)}toP(){if(this.isInfinity())return new C(null,null);const e=this.z.redInvm(),n=e.redSqr(),i=this.x.redMul(n),s=this.y.redMul(n).redMul(e);return new C(i,s)}neg(){return new ot(this.x,this.y.redNeg(),this.z)}add(e){if(this.isInfinity())return e;if(e.isInfinity())return this;const n=e.z.redSqr(),i=this.z.redSqr(),s=this.x.redMul(n),a=e.x.redMul(i),o=this.y.redMul(n.redMul(e.z)),c=e.y.redMul(i.redMul(this.z)),f=s.redSub(a),u=o.redSub(c);if(f.cmpn(0)===0)return u.cmpn(0)!==0?new ot(null,null,null):this.dbl();const h=f.redSqr(),b=h.redMul(f),g=s.redMul(h),p=u.redSqr().redIAdd(b).redISub(g).redISub(g),m=u.redMul(g.redISub(p)).redISub(o.redMul(b)),y=this.z.redMul(e.z).redMul(f);return new ot(p,m,y)}mixedAdd(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;if(e.x===null||e.y===null)throw new Error("Point coordinates cannot be null");const n=this.z.redSqr(),i=this.x,s=e.x.redMul(n),a=this.y,o=e.y.redMul(n).redMul(this.z),c=i.redSub(s),f=a.redSub(o);if(c.cmpn(0)===0)return f.cmpn(0)!==0?new ot(null,null,null):this.dbl();const u=c.redSqr(),h=u.redMul(c),b=i.redMul(u),g=f.redSqr().redIAdd(h).redISub(b).redISub(b),p=f.redMul(b.redISub(g)).redISub(a.redMul(h)),m=this.z.redMul(c);return new ot(g,p,m)}dblp(e){if(e===0)return this;if(this.isInfinity())return this;if(typeof e>"u")return this.dbl();let n=this;for(let i=0;i<e;i++)n=n.dbl();return n}dbl(){if(this.isInfinity())return this;let e,n,i;if(this.zOne){const s=this.x.redSqr(),a=this.y.redSqr(),o=a.redSqr();let c=this.x.redAdd(a).redSqr().redISub(s).redISub(o);c=c.redIAdd(c);const f=s.redAdd(s).redIAdd(s),u=f.redSqr().redISub(c).redISub(c);let h=o.redIAdd(o);h=h.redIAdd(h),h=h.redIAdd(h),e=u,n=f.redMul(c.redISub(u)).redISub(h),i=this.y.redAdd(this.y)}else{const s=this.x.redSqr(),a=this.y.redSqr(),o=a.redSqr();let c=this.x.redAdd(a).redSqr().redISub(s).redISub(o);c=c.redIAdd(c);const f=s.redAdd(s).redIAdd(s),u=f.redSqr();let h=o.redIAdd(o);h=h.redIAdd(h),h=h.redIAdd(h),e=u.redISub(c).redISub(c),n=f.redMul(c.redISub(e)).redISub(h),i=this.y.redMul(this.z),i=i.redIAdd(i)}return new ot(e,n,i)}eq(e){if(e.type==="affine")return this.eq(e.toJ());if(this===e||(e=e,this.isInfinity()&&e.isInfinity()))return!0;if(this.isInfinity()!==e.isInfinity())return!1;const n=this.z.redSqr(),i=e.z.redSqr();if(this.x.redMul(i).redISub(e.x.redMul(n)).cmpn(0)!==0)return!1;const s=n.redMul(this.z),a=i.redMul(e.z);return this.y.redMul(a).redISub(e.y.redMul(s)).cmpn(0)===0}eqXToP(e){var o;const n=this.z.redSqr(),i=e.toRed((o=this.curve)==null?void 0:o.red).redMul(n);if(this.x.cmp(i)===0)return!0;const s=e.clone();if(this.curve===null||this.curve.redN==null)throw new Error("Curve or redN is not initialized.");const a=this.curve.redN.redMul(n);for(;s.cmp(this.curve.p)<0;){if(s.iadd(this.curve.n),s.cmp(this.curve.p)>=0)return!1;if(i.redIAdd(a),this.x.cmp(i)===0)return!0}return!1}inspect(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"}isInfinity(){return this.z.cmpn(0)===0}}const Bi=/^[0-9a-fA-F]*$/;function tn(r){if(typeof r!="string")throw new TypeError("Invalid hex string");if(r.length!==0&&!Bi.test(r))throw new Error("Invalid hex string")}function Ci(r){if(tn(r),r.length===0)return"";let t=r.toLowerCase();return t.length%2!==0&&(t="0"+t),t}const Me=(r,t="Hash assertion failed")=>{if(!r)throw new Error(t)};class jn{constructor(t,e,n,i){l(this,"pending");l(this,"pendingTotal");l(this,"blockSize");l(this,"outSize");l(this,"endian");l(this,"_delta8");l(this,"_delta32");l(this,"padLength");l(this,"hmacStrength");this.pending=null,this.pendingTotal=0,this.blockSize=t,this.outSize=e,this.hmacStrength=n,this.padLength=i/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}_update(t,e){throw new Error("Not implemented")}_digest(){throw new Error("Not implemented")}_digestHex(){throw new Error("Not implemented")}update(t,e){if(t=Xt(t,e),this.pending==null?this.pending=t:this.pending=this.pending.concat(t),this.pendingTotal+=t.length,this.pending.length>=this._delta8){t=this.pending;const n=t.length%this._delta8;this.pending=t.slice(t.length-n,t.length),this.pending.length===0&&(this.pending=null),t=Vi(t,0,t.length-n,this.endian);for(let i=0;i<t.length;i+=this._delta32)this._update(t,i)}return this}digest(){return this.update(this._pad()),Me(this.pending===null),this._digest()}digestHex(){return this.update(this._pad()),Me(this.pending===null),this._digestHex()}_pad(){const t=this.pendingTotal;if(!Number.isSafeInteger(t)||t<0)throw new Error("Message too long for this hash function");const e=this._delta8,n=e-(t+this.padLength)%e,i=new Array(n+this.padLength);i[0]=128;let s;for(s=1;s<n;s++)i[s]=0;const a=this.padLength,o=1n<<BigInt(a*8);let c=BigInt(t)*8n;if(c>=o)throw new Error("Message too long for this hash function");if(this.endian==="big"){const f=new Array(a);for(let u=a-1;u>=0;u--)f[u]=Number(c&0xffn),c>>=8n;for(let u=0;u<a;u++)i[s++]=f[u]}else for(let f=0;f<a;f++)i[s++]=Number(c&0xffn),c>>=8n;return i}}function Ri(r,t){return(r.charCodeAt(t)&64512)!==55296||t<0||t+1>=r.length?!1:(r.charCodeAt(t+1)&64512)===56320}function Xt(r,t){if(Array.isArray(r))return r.slice();if(!r)return[];const e=[];if(typeof r=="string")if(t!=="hex"){let n=0;for(let i=0;i<r.length;i++){let s=r.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):Ri(r,i)?(s=65536+((s&1023)<<10)+(r.charCodeAt(++i)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}}else{tn(r),r=Ci(r);for(let n=0;n<r.length;n+=2)e.push(parseInt(r[n]+r[n+1],16))}else{r=r;for(let n=0;n<r.length;n++)e[n]=r[n]|0}return e}function Li(r){return xr(r)}function Gn(r,t){let e="";for(let n=0;n<r.length;n++){let i=r[n];t==="little"&&(i=Li(i)),e+=Ui(i.toString(16))}return e}function Ui(r){return r.length===7?"0"+r:r.length===6?"00"+r:r.length===5?"000"+r:r.length===4?"0000"+r:r.length===3?"00000"+r:r.length===2?"000000"+r:r.length===1?"0000000"+r:r}function en(r){let t="";for(const e of r)t+=e.toString(16).padStart(2,"0");return t}function Vi(r,t,e,n){const i=e-t;Me(i%4===0);const s=new Array(i/4);for(let a=0,o=t;a<s.length;a++,o+=4){let c;n==="big"?c=r[o]<<24|r[o+1]<<16|r[o+2]<<8|r[o+3]:c=r[o+3]<<24|r[o+2]<<16|r[o+1]<<8|r[o],s[a]=c>>>0}return s}function Yn(r,t){const e=new Array(r.length*4);for(let n=0,i=0;n<r.length;n++,i+=4){const s=r[n];t==="big"?(e[i]=s>>>24,e[i+1]=s>>>16&255,e[i+2]=s>>>8&255,e[i+3]=s&255):(e[i+3]=s>>>24,e[i+2]=s>>>16&255,e[i+1]=s>>>8&255,e[i]=s&255)}return e}function mt(r,t){return r>>>t|r<<32-t}function Rt(r,t){return r<<t|r>>>32-t}function q(r,t){return r+t>>>0}function Zt(r,t,e){return r+t+e>>>0}function bn(r,t,e,n){return r+t+e+n>>>0}function Zn(r,t,e,n,i){return r+t+e+n+i>>>0}function Hi(r,t,e,n){return r===0?Qn(t,e,n):r===1||r===3?Di(t,e,n):r===2?Jn(t,e,n):0}function Qn(r,t,e){return r&t^~r&e}function Jn(r,t,e){return r&t^r&e^t&e}function Di(r,t,e){return r^t^e}function Mi(r){return mt(r,2)^mt(r,13)^mt(r,22)}function Fi(r){return mt(r,6)^mt(r,11)^mt(r,25)}function qi(r){return mt(r,7)^mt(r,18)^r>>>3}function Ki(r){return mt(r,17)^mt(r,19)^r>>>10}const Wi=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],zi=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],$i=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],Xi=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];function pn(r,t,e,n){return r<=15?t^e^n:r<=31?t&e|~t&n:r<=47?(t|~e)^n:r<=63?t&n|e&~n:t^(e|~n)}function ji(r){return r<=15?0:r<=31?1518500249:r<=47?1859775393:r<=63?2400959708:2840853838}function Gi(r){return r<=15?1352829926:r<=31?1548603684:r<=47?1836072691:r<=63?2053994217:0}class ti extends jn{constructor(){super(512,160,192,64);l(this,"h");this.endian="little",this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}_update(e,n){let i=this.h[0],s=this.h[1],a=this.h[2],o=this.h[3],c=this.h[4],f=i,u=s,h=a,b=o,g=c,p;for(let m=0;m<80;m++)p=q(Rt(bn(i,pn(m,s,a,o),e[Wi[m]+n],ji(m)),$i[m]),c),i=c,c=o,o=Rt(a,10),a=s,s=p,p=q(Rt(bn(f,pn(79-m,u,h,b),e[zi[m]+n],Gi(m)),Xi[m]),g),f=g,g=b,b=Rt(h,10),h=u,u=p;p=Zt(this.h[1],a,b),this.h[1]=Zt(this.h[2],o,g),this.h[2]=Zt(this.h[3],c,f),this.h[3]=Zt(this.h[4],i,u),this.h[4]=Zt(this.h[0],s,h),this.h[0]=p}_digest(){return Yn(this.h,"little")}_digestHex(){return Gn(this.h,"little")}}class xe{constructor(){l(this,"h");this.h=new ai}update(t,e){const n=t instanceof Uint8Array?t:Uint8Array.from(Xt(t,e));return this.h.update(n),this}digest(){return Array.from(this.h.digest())}digestHex(){return en(this.h.digest())}}class Yi extends jn{constructor(){super(512,160,80,64);l(this,"h");l(this,"W");l(this,"k");this.k=[1518500249,1859775393,2400959708,3395469782],this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}_update(e,n){const i=this.W;n===void 0&&(n=0);let s;for(s=0;s<16;s++)i[s]=e[n+s];for(;s<i.length;s++)i[s]=Rt(i[s-3]^i[s-8]^i[s-14]^i[s-16],1);let a=this.h[0],o=this.h[1],c=this.h[2],f=this.h[3],u=this.h[4];for(s=0;s<i.length;s++){const h=~~(s/20),b=Zn(Rt(a,5),Hi(h,o,c,f),u,i[s],this.k[h]);u=f,f=c,c=Rt(o,30),o=a,a=b}this.h[0]=q(this.h[0],a),this.h[1]=q(this.h[1],o),this.h[2]=q(this.h[2],c),this.h[3]=q(this.h[3],f),this.h[4]=q(this.h[4],u)}_digest(){return Yn(this.h,"big")}_digestHex(){return Gn(this.h,"big")}}class ei{constructor(t){l(this,"h");l(this,"blockSize",64);l(this,"outSize",32);const e=t instanceof Uint8Array?t:Uint8Array.from(Xt(t,typeof t=="string"?"hex":void 0));this.h=new ci(pr,e)}update(t,e){const n=t instanceof Uint8Array?t:Uint8Array.from(Xt(t,e));return this.h.update(n),this}digest(){return Array.from(this.h.digest())}digestHex(){return en(this.h.digest())}}class Zi{constructor(t){l(this,"h");l(this,"blockSize",128);l(this,"outSize",32);const e=t instanceof Uint8Array?t:Uint8Array.from(Xt(t,typeof t=="string"?"hex":void 0));this.h=new ci(yr,e)}update(t,e){const n=t instanceof Uint8Array?t:Uint8Array.from(Xt(t,e));return this.h.update(n),this}digest(){return Array.from(this.h.digest())}digestHex(){return en(this.h.digest())}}const Qi=(r,t)=>new ti().update(r,t).digest(),Ji=(r,t)=>new Yi().update(r,t).digest(),Et=(r,t)=>new xe().update(r,t).digest(),ct=(r,t)=>{const e=new xe().update(r,t).digest();return new xe().update(e).digest()},ni=(r,t)=>{const e=new xe().update(r,t).digest();return new ti().update(e).digest()},ie=(r,t,e)=>new ei(r).update(t,e).digest(),tr=(r,t,e)=>new Zi(r).update(t,e).digest();function er(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function gn(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`positive integer expected, got ${r}`)}function Te(r,...t){if(!er(r))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(r.length)){const e=t.join(",");throw new Error(`Uint8Array expected of length ${e}, got length=${r.length}`)}}function nr(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");gn(r.outputLen),gn(r.blockLen)}function Ie(r,t=!0){if(r.destroyed===!0)throw new Error("Hash instance has been destroyed");if(t&&r.finished===!0)throw new Error("Hash#digest() has already been called")}function ir(r,t){Te(r);const e=t.outputLen;if(r.length<e)throw new Error(`digestInto() expects output buffer of length at least ${e}`)}function jt(...r){for(let t=0;t<r.length;t++)r[t].fill(0)}function Re(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function nn(r){return typeof r=="string"&&(r=rr(r)),Te(r),r}function rr(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}class ii{}function ri(r){const t=n=>r().update(nn(n)).digest(),e=r();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>r(),t}const le=BigInt(2**32-1),wn=BigInt(32);function sr(r,t=!1){return t?{h:Number(r&le),l:Number(r>>wn&le)}:{h:Number(r>>wn&le)|0,l:Number(r&le)|0}}function ar(r,t=!1){const e=r.length,n=new Uint32Array(e),i=new Uint32Array(e);for(let s=0;s<e;s++){const{h:a,l:o}=sr(r[s],t);n[s]=a,i[s]=o}return[n,i]}const mn=(r,t,e)=>r>>>e,yn=(r,t,e)=>r<<32-e|t>>>e,Mt=(r,t,e)=>r>>>e|t<<32-e,Ft=(r,t,e)=>r<<32-e|t>>>e,be=(r,t,e)=>r<<64-e|t>>>e-32,pe=(r,t,e)=>r>>>e-32|t<<64-e;function It(r,t,e,n){const i=(t>>>0)+(n>>>0);return{h:r+e+(i/2**32|0)|0,l:i|0}}const or=(r,t,e)=>(r>>>0)+(t>>>0)+(e>>>0),cr=(r,t,e,n)=>t+e+n+(r/2**32|0)|0,fr=(r,t,e,n)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0),ur=(r,t,e,n,i)=>t+e+n+i+(r/2**32|0)|0,hr=(r,t,e,n,i)=>(r>>>0)+(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0),dr=(r,t,e,n,i,s)=>t+e+n+i+s+(r/2**32|0)|0;class si extends ii{constructor(e,n,i,s){super();l(this,"blockLen");l(this,"outputLen");l(this,"padOffset");l(this,"isLE");l(this,"buffer");l(this,"view");l(this,"finished",!1);l(this,"length",0);l(this,"pos",0);l(this,"destroyed",!1);this.blockLen=e,this.outputLen=n,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Re(this.buffer)}update(e){Ie(this),e=nn(e),Te(e);const{view:n,buffer:i,blockLen:s}=this,a=e.length;for(let o=0;o<a;){const c=Math.min(s-this.pos,a-o);if(c===s){const f=Re(e);for(;s<=a-o;o+=s)this.process(f,o);continue}i.set(e.subarray(o,o+c),this.pos),this.pos+=c,o+=c,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ie(this),ir(e,this),this.finished=!0;const{buffer:n,view:i,blockLen:s,isLE:a}=this;let{pos:o}=this;n[o++]=128,jt(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let b=o;b<s;b++)n[b]=0;lr(i,s-8,BigInt(this.length*8),a),this.process(i,0);const c=Re(e),f=this.outputLen;if(f%4!==0)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=f/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let b=0;b<u;b++)c.setUint32(4*b,h[b],a)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:i,length:s,finished:a,destroyed:o,pos:c}=this;return e.destroyed=o,e.finished=a,e.length=s,e.pos=c,s%n!==0&&e.buffer.set(i),e}clone(){return this._cloneInto()}}function lr(r,t,e,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(t,e,n);const i=BigInt(32),s=BigInt(4294967295),a=Number(e>>i&s),o=Number(e&s),c=n?4:0,f=n?0:4;r.setUint32(t+c,a,n),r.setUint32(t+f,o,n)}const Pt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),br=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Nt=new Uint32Array(64);class ai extends si{constructor(e=32){super(64,e,8,!1);l(this,"A",Pt[0]|0);l(this,"B",Pt[1]|0);l(this,"C",Pt[2]|0);l(this,"D",Pt[3]|0);l(this,"E",Pt[4]|0);l(this,"F",Pt[5]|0);l(this,"G",Pt[6]|0);l(this,"H",Pt[7]|0)}get(){const{A:e,B:n,C:i,D:s,E:a,F:o,G:c,H:f}=this;return[e,n,i,s,a,o,c,f]}set(e,n,i,s,a,o,c,f){this.A=e|0,this.B=n|0,this.C=i|0,this.D=s|0,this.E=a|0,this.F=o|0,this.G=c|0,this.H=f|0}process(e,n){for(let b=0;b<16;b++,n+=4)Nt[b]=e.getUint32(n);for(let b=16;b<64;b++){const g=Nt[b-15],p=Nt[b-2],m=qi(g),y=Ki(p);Nt[b]=q(q(m,Nt[b-7]),q(y,Nt[b-16]))}let{A:i,B:s,C:a,D:o,E:c,F:f,G:u,H:h}=this;for(let b=0;b<64;b++){const g=Zn(h,Fi(c),Qn(c,f,u),br[b],Nt[b]),p=q(Mi(i),Jn(i,s,a));h=u,u=f,f=c,c=q(o,g),o=a,a=s,s=i,i=q(g,p)}this.A=q(this.A,i),this.B=q(this.B,s),this.C=q(this.C,a),this.D=q(this.D,o),this.E=q(this.E,c),this.F=q(this.F,f),this.G=q(this.G,u),this.H=q(this.H,h)}roundClean(){jt(Nt)}destroy(){jt(this.buffer),this.set(0,0,0,0,0,0,0,0)}}const pr=ri(()=>new ai),Y=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),oi=ar(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),gr=oi[0],wr=oi[1],_t=new Uint32Array(80),Tt=new Uint32Array(80);class mr extends si{constructor(e=64){super(128,e,16,!1);l(this,"Ah",Y[0]|0);l(this,"Al",Y[1]|0);l(this,"Bh",Y[2]|0);l(this,"Bl",Y[3]|0);l(this,"Ch",Y[4]|0);l(this,"Cl",Y[5]|0);l(this,"Dh",Y[6]|0);l(this,"Dl",Y[7]|0);l(this,"Eh",Y[8]|0);l(this,"El",Y[9]|0);l(this,"Fh",Y[10]|0);l(this,"Fl",Y[11]|0);l(this,"Gh",Y[12]|0);l(this,"Gl",Y[13]|0);l(this,"Hh",Y[14]|0);l(this,"Hl",Y[15]|0)}get(){const{Ah:e,Al:n,Bh:i,Bl:s,Ch:a,Cl:o,Dh:c,Dl:f,Eh:u,El:h,Fh:b,Fl:g,Gh:p,Gl:m,Hh:y,Hl:k}=this;return[e,n,i,s,a,o,c,f,u,h,b,g,p,m,y,k]}set(e,n,i,s,a,o,c,f,u,h,b,g,p,m,y,k){this.Ah=e|0,this.Al=n|0,this.Bh=i|0,this.Bl=s|0,this.Ch=a|0,this.Cl=o|0,this.Dh=c|0,this.Dl=f|0,this.Eh=u|0,this.El=h|0,this.Fh=b|0,this.Fl=g|0,this.Gh=p|0,this.Gl=m|0,this.Hh=y|0,this.Hl=k|0}process(e,n){for(let E=0;E<16;E++,n+=4)_t[E]=e.getUint32(n),Tt[E]=e.getUint32(n+=4);for(let E=16;E<80;E++){const _=_t[E-15]|0,V=Tt[E-15]|0,U=Mt(_,V,1)^Mt(_,V,8)^mn(_,V,7),K=Ft(_,V,1)^Ft(_,V,8)^yn(_,V,7),L=_t[E-2]|0,W=Tt[E-2]|0,Q=Mt(L,W,19)^be(L,W,61)^mn(L,W,6),G=Ft(L,W,19)^pe(L,W,61)^yn(L,W,6),$=fr(K,G,Tt[E-7],Tt[E-16]),at=ur($,U,Q,_t[E-7],_t[E-16]);_t[E]=at|0,Tt[E]=$|0}let{Ah:i,Al:s,Bh:a,Bl:o,Ch:c,Cl:f,Dh:u,Dl:h,Eh:b,El:g,Fh:p,Fl:m,Gh:y,Gl:k,Hh:I,Hl:v}=this;for(let E=0;E<80;E++){const _=Mt(b,g,14)^Mt(b,g,18)^be(b,g,41),V=Ft(b,g,14)^Ft(b,g,18)^pe(b,g,41),U=b&p^~b&y,K=g&m^~g&k,L=hr(v,V,K,wr[E],Tt[E]),W=dr(L,I,_,U,gr[E],_t[E]),Q=L|0,G=Mt(i,s,28)^be(i,s,34)^be(i,s,39),$=Ft(i,s,28)^pe(i,s,34)^pe(i,s,39),at=i&a^i&c^a&c,O=s&o^s&f^o&f;I=y|0,v=k|0,y=p|0,k=m|0,p=b|0,m=g|0,{h:b,l:g}=It(u|0,h|0,W|0,Q|0),u=c|0,h=f|0,c=a|0,f=o|0,a=i|0,o=s|0;const S=or($,O,Q);i=cr(S,G,at,W),s=S|0}({h:i,l:s}=It(i,s,this.Ah,this.Al)),{h:a,l:o}=It(a,o,this.Bh,this.Bl),{h:c,l:f}=It(c,f,this.Ch,this.Cl),{h:u,l:h}=It(u,h,this.Dh,this.Dl),{h:b,l:g}=It(b,g,this.Eh,this.El),{h:p,l:m}=It(p,m,this.Fh,this.Fl),{h:y,l:k}=It(y,k,this.Gh,this.Gl),{h:I,l:v}=It(I,v,this.Hh,this.Hl),this.set(i,s,a,o,c,f,u,h,b,g,p,m,y,k,I,v)}roundClean(){jt(_t,Tt)}destroy(){jt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const yr=ri(()=>new mr);class ci extends ii{constructor(e,n){super();l(this,"oHash");l(this,"iHash");l(this,"blockLen");l(this,"outputLen");l(this,"finished",!1);l(this,"destroyed",!1);nr(e);const i=nn(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,a=new Uint8Array(s);a.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<a.length;o++)a[o]^=54;this.iHash.update(a),this.oHash=e.create();for(let o=0;o<a.length;o++)a[o]^=106;this.oHash.update(a),jt(a)}update(e){return Ie(this),this.iHash.update(e),this}digestInto(e){Ie(this),Te(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:i,finished:s,destroyed:a,blockLen:o,outputLen:c}=this;return e=e,e.finished=s,e.destroyed=a,e.blockLen=o,e.outputLen=c,e.oHash=n._cloneInto(e.oHash??void 0),e.iHash=i._cloneInto(e.iHash??void 0),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}function xr(r){return(r>>>24|r>>>8&65280|r<<8&16711680|(r&255)<<24)>>>0}(()=>{const r=new ArrayBuffer(4),t=new Uint32Array(r),e=new Uint8Array(r);return t[0]=16909060,e[0]===4})();class Lt{constructor(t,e=256){l(this,"buffer");l(this,"pos");l(this,"capacity");if(t!=null&&t.length>0){const n=t.reduce((i,s)=>i+s.length,0);e=Math.max(e,n)}if(this.buffer=new Uint8Array(e),this.pos=0,this.capacity=e,t!=null)for(const n of t)this.write(n)}getLength(){return this.pos}toUint8Array(){return this.buffer.slice(0,this.pos)}toArray(){return Array.from(this.toUint8Array())}toUint8ArrayZeroCopy(){return this.buffer.subarray(0,this.pos)}ensureCapacity(t){if(this.pos+t>this.capacity){let e=this.capacity*2;for(;this.pos+t>e;)e*=2;const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n,this.capacity=e}}write(t){const e=t instanceof Uint8Array?t:new Uint8Array(t);return this.ensureCapacity(e.length),this.buffer.set(e,this.pos),this.pos+=e.length,this}writeReverse(t){const e=t instanceof Uint8Array?t:new Uint8Array(t);this.ensureCapacity(e.length);for(let n=e.length-1;n>=0;n--)this.buffer[this.pos]=e[n],this.pos+=1;return this}writeUInt8(t){return this.ensureCapacity(1),this.buffer[this.pos]=t&255,this.pos+=1,this}writeInt8(t){return this.writeUInt8(t),this}writeUInt16LE(t){return this.ensureCapacity(2),this.buffer[this.pos]=t&255,this.buffer[this.pos+1]=t>>8&255,this.pos+=2,this}writeUInt16BE(t){return this.ensureCapacity(2),this.buffer[this.pos]=t>>8&255,this.buffer[this.pos+1]=t&255,this.pos+=2,this}writeInt16LE(t){return this.writeUInt16LE(t&65535),this}writeInt16BE(t){return this.writeUInt16BE(t&65535),this}writeUInt32LE(t){return this.ensureCapacity(4),this.buffer[this.pos]=t&255,this.buffer[this.pos+1]=t>>8&255,this.buffer[this.pos+2]=t>>16&255,this.buffer[this.pos+3]=t>>24&255,this.pos+=4,this}writeUInt32BE(t){return this.ensureCapacity(4),this.buffer[this.pos]=t>>24&255,this.buffer[this.pos+1]=t>>16&255,this.buffer[this.pos+2]=t>>8&255,this.buffer[this.pos+3]=t&255,this.pos+=4,this}writeInt32LE(t){return this.writeUInt32LE(t>>>0),this}writeInt32BE(t){return this.writeUInt32BE(t>>>0),this}writeUInt64BEBn(t){const e=t.toArray("be",8);return this.write(e),this}writeUInt64LEBn(t){const e=t.toArray("be",8);return this.writeReverse(e),this}writeUInt64LE(t){const e=new w(t).toArray("be",8);return this.writeReverse(e),this}writeVarIntNum(t){const e=B.varIntNum(t);return this.write(e),this}writeVarIntBn(t){const e=B.varIntBn(t);return this.write(e),this}reset(){this.pos=0}}class vt{constructor(t=new Uint8Array(0),e=0){l(this,"bin");l(this,"pos");l(this,"length");if(t instanceof Uint8Array)this.bin=t;else if(Array.isArray(t))this.bin=new Uint8Array(t);else throw new Error("ReaderUint8Array constructor: bin must be Uint8Array or number[]");this.pos=e,this.length=this.bin.length}static makeReader(t,e=0){if(t instanceof Uint8Array)return new vt(t,e);if(Array.isArray(t))return new tt(t,e);throw new Error("ReaderUint8Array.makeReader: bin must be Uint8Array or number[]")}eof(){return this.pos>=this.length}read(t=this.length){const e=this.pos,n=this.pos+t;return this.pos=n,this.bin.slice(e,n)}readReverse(t=this.length){const e=new Uint8Array(t);for(let n=0;n<t;n++)e[n]=this.bin[this.pos+t-1-n];return this.pos+=t,e}readUInt8(){const t=this.bin[this.pos];return this.pos+=1,t}readInt8(){const t=this.bin[this.pos];return this.pos+=1,(t&128)!==0?t-256:t}readUInt16BE(){const t=this.bin[this.pos]<<8|this.bin[this.pos+1];return this.pos+=2,t}readInt16BE(){const t=this.readUInt16BE();return(t&32768)!==0?t-65536:t}readUInt16LE(){const t=this.bin[this.pos]|this.bin[this.pos+1]<<8;return this.pos+=2,t}readInt16LE(){const t=this.readUInt16LE();return(t&32768)!==0?t-65536:t}readUInt32BE(){const t=this.bin[this.pos]*16777216+(this.bin[this.pos+1]<<16|this.bin[this.pos+2]<<8|this.bin[this.pos+3]);return this.pos+=4,t}readInt32BE(){const t=this.readUInt32BE();return(t&2147483648)!==0?t-4294967296:t}readUInt32LE(){const t=(this.bin[this.pos]|this.bin[this.pos+1]<<8|this.bin[this.pos+2]<<16|this.bin[this.pos+3]<<24)>>>0;return this.pos+=4,t}readInt32LE(){const t=this.readUInt32LE();return(t&2147483648)!==0?t-4294967296:t}readUInt64BEBn(){const t=Array.from(this.bin.slice(this.pos,this.pos+8)),e=new w(t);return this.pos=this.pos+8,e}readUInt64LEBn(){const t=Array.from(this.readReverse(8));return new w(t)}readInt64LEBn(){const t=new w(2).pow(new w(63)),e=new w(2).pow(new w(64)),n=Array.from(this.readReverse(8));let i=new w(n);return i.gte(t)&&(i=i.sub(e)),i}readVarIntNum(t=!0){const e=this.readUInt8();let n;switch(e){case 253:return this.readUInt16LE();case 254:return this.readUInt32LE();case 255:if(n=t?this.readInt64LEBn():this.readUInt64LEBn(),n.lte(new w(2).pow(new w(53))))return n.toNumber();throw new Error("number too large to retain precision - use readVarIntBn");default:return e}}readVarInt(){switch(this.bin[this.pos]){case 253:return this.read(3);case 254:return this.read(5);case 255:return this.read(9);default:return this.read(1)}}readVarIntBn(){const t=this.readUInt8();switch(t){case 253:return new w(this.readUInt16LE());case 254:return new w(this.readUInt32LE());case 255:return this.readUInt64LEBn();default:return new w(t)}}}const Se=typeof globalThis<"u"?globalThis.Buffer:void 0,fi=Se!=null&&typeof Se.from=="function",xn="0123456789abcdef",ui=new Array(256);for(let r=0;r<256;r++)ui[r]=xn[r>>4&15]+xn[r&15];const N=r=>{if(fi)return Se.from(r).toString("hex");if(r.length===0)return"";const t=new Array(r.length);for(let e=0;e<r.length;e++)t[e]=ui[r[e]&255];return t.join("")},Fe=(r,t)=>r instanceof Uint8Array?r:new Uint8Array(x(r,t)),x=(r,t)=>{if(Array.isArray(r))return r.slice();if(r===void 0)return[];if(typeof r!="string")return Array.from(r,e=>e|0);switch(t){case"hex":return Ir(r);case"base64":return Sr(r);default:return kr(r)}},re=new Int8Array(256).fill(-1);for(let r=0;r<10;r++)re[48+r]=r;for(let r=0;r<6;r++)re[65+r]=10+r,re[97+r]=10+r;const Ir=r=>{tn(r);const t=r.length%2===0?r:"0"+r;if(fi)return Array.from(Se.from(t,"hex"));const e=new Array(t.length/2);let n=0;for(let i=0;i<t.length;i+=2){const s=re[t.charCodeAt(i)],a=re[t.charCodeAt(i+1)];e[n++]=s<<4|a}return e};function Sr(r){if(typeof r!="string")throw new TypeError("msg must be a string");let t=r.trim().replace(/[\r\n\t\f\v ]+/g,"");t=t.replace(/-/g,"+").replace(/_/g,"/");const e=t.indexOf("=");if(e!==-1){const a=t.slice(e);if(!/^={1,2}$/.test(a))throw new Error("Invalid base64 padding");if(t.slice(0,e).includes("="))throw new Error("Invalid base64 padding");t=t.slice(0,e)}const n=[];let i=0,s=0;for(let a=0;a<t.length;a++){const o=t.charCodeAt(a);let c=-1;if(o>=65&&o<=90)c=o-65;else if(o>=97&&o<=122)c=o-97+26;else if(o>=48&&o<=57)c=o-48+52;else if(o===43)c=62;else if(o===47)c=63;else throw new Error(`Invalid base64 character at index ${a}`);for(i=i<<6|c,s+=6;s>=8;)s-=8,n.push(i>>s&255),i&=(1<<s)-1}return n}function kr(r){return Array.from(new TextEncoder().encode(r))}const H=r=>new TextDecoder().decode(new Uint8Array(r)),ke=(r,t)=>{switch(t){case"hex":return N(r);case"utf8":return H(r);default:return r}};function Ot(r){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";let e="",n;for(n=0;n<r.length;n+=3){const i=r[n],s=n+1<r.length?r[n+1]:0,a=n+2<r.length?r[n+2]:0,o=i>>2,c=(i&3)<<4|s>>4,f=(s&15)<<2|a>>6,u=a&63;e+=t.charAt(o)+t.charAt(c),e+=n+1<r.length?t.charAt(f):"=",e+=n+2<r.length?t.charAt(u):"="}return e}const Qt="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",qe=r=>{if(r===""||typeof r!="string")throw new Error(`Expected base58 string but got ${r}`);const t=r.match(/[IOl0]/gmu);if(t!==null)throw new Error(`Invalid base58 character ${t.join("")}`);const e=r.match(/^1+/gmu),n=e!==null?e[0].length:0,i=(r.length-n)*(Math.log(58)/Math.log(256))+1>>>0;return[...new Uint8Array([...new Uint8Array(n),...(r.match(/./gmu)??[]).map(a=>Qt.indexOf(a)).reduce((a,o)=>(a=a.map(c=>{const f=c*58+o;return o=f>>8,f}),a),new Uint8Array(i)).reverse().filter((a=>o=>a=a||o)(!1))])]},Ke=r=>{const t=Array(256).fill(-1);for(let n=0;n<Qt.length;++n)t[Qt.charCodeAt(n)]=n;const e=[];for(const n of r){let i=n;for(let s=0;s<e.length;++s){const a=(t[e[s]]<<8)+i;e[s]=Qt.charCodeAt(a%58),i=a/58|0}for(;i!==0;)e.push(Qt.charCodeAt(i%58)),i=i/58|0}for(const n of r){if(n!==0)break;e.push(49)}return e.reverse(),String.fromCharCode(...e)},hi=(r,t=[0])=>{let e=ct([...t,...r]);return e=[...t,...r,...e.slice(0,4)],Ke(e)},di=(r,t,e=1)=>{const n=qe(r);let i=n.slice(0,e),s=n.slice(e,-4),a=[...i,...s];return a=ct(a),n.slice(-4).forEach((o,c)=>{if(o!==a[c])throw new Error("Invalid checksum")}),{prefix:i,data:s}};class B{constructor(t){l(this,"bufs");l(this,"length");this.bufs=t!==void 0?t:[],this.length=0;for(const e of this.bufs)this.length+=e.length}getLength(){return this.length}toUint8Array(){const t=new Uint8Array(this.length);let e=0;for(const n of this.bufs)t.set(n,e),e+=n.length;return t}toArray(){const t=this.length,e=new Array(t);let n=0;for(const i of this.bufs)if(i instanceof Uint8Array)for(let s=0;s<i.length;s++)e[n++]=i[s];else{const s=i;for(let a=0;a<s.length;a++)e[n++]=s[a]}return e}toHex(){return this.toArray().map(t=>t.toString(16).padStart(2,"0")).join("")}write(t){return this.bufs.push(t),this.length+=t.length,this}writeReverse(t){const e=new Array(t.length);for(let n=0;n<e.length;n++)e[n]=t[t.length-1-n];return this.write(e)}writeUInt8(t){const e=new Array(1);return e[0]=t&255,this.write(e),this}writeInt8(t){const e=new Array(1);return e[0]=t&255,this.write(e),this}writeUInt16BE(t){const e=[t>>8&255,t&255];return this.write(e)}writeInt16BE(t){return this.writeUInt16BE(t&65535)}writeUInt16LE(t){const e=[t&255,t>>8&255];return this.write(e)}writeInt16LE(t){return this.writeUInt16LE(t&65535)}writeUInt32BE(t){const e=[t>>24&255,t>>16&255,t>>8&255,t&255];return this.write(e)}writeInt32BE(t){return this.writeUInt32BE(t>>>0)}writeUInt32LE(t){const e=[t&255,t>>8&255,t>>16&255,t>>24&255];return this.write(e)}writeInt32LE(t){return this.writeUInt32LE(t>>>0)}writeUInt64BEBn(t){const e=t.toArray("be",8);return this.write(e),this}writeUInt64LEBn(t){const e=t.toArray("be",8);return this.writeReverse(e),this}writeUInt64LE(t){if(t===-1)this.write(new Array(8).fill(255));else{const e=new w(t).toArray("be",8);this.writeReverse(e)}return this}writeVarIntNum(t){const e=B.varIntNum(t);return this.write(e),this}writeVarIntBn(t){const e=B.varIntBn(t);return this.write(e),this}static varIntNum(t){let e;if(t<0)return this.varIntBn(new w(t));if(t<253)e=[t];else if(t<65536)e=[253,t&255,t>>8&255];else if(t<4294967296)e=[254,t&255,t>>8&255,t>>16&255,t>>24&255];else{const n=t&4294967295,i=Math.floor(t/4294967296)&4294967295;e=[255,n&255,n>>8&255,n>>16&255,n>>24&255,i&255,i>>8&255,i>>16&255,i>>24&255]}return e}static varIntBn(t){let e;if(t.isNeg()&&(t=t.add(li)),t.ltn(253))e=[t.toNumber()];else if(t.ltn(65536)){const n=t.toNumber();e=[253,n&255,n>>8&255]}else if(t.lt(new w(4294967296))){const n=t.toNumber();e=[254,n&255,n>>8&255,n>>16&255,n>>24&255]}else{const n=new B;n.writeUInt8(255),n.writeUInt64LEBn(t),e=n.toArray()}return e}}class tt{constructor(t=[],e=0){l(this,"bin");l(this,"pos");l(this,"length");this.bin=t,this.pos=e,this.length=t.length}eof(){return this.pos>=this.length}read(t=this.length){const e=this.pos,n=this.pos+t;return this.pos=n,this.bin.slice(e,n)}readReverse(t=this.length){const e=new Array(t);for(let n=0;n<t;n++)e[n]=this.bin[this.pos+t-1-n];return this.pos+=t,e}readUInt8(){const t=this.bin[this.pos];return this.pos+=1,t}readInt8(){const t=this.bin[this.pos];return this.pos+=1,(t&128)!==0?t-256:t}readUInt16BE(){const t=this.bin[this.pos]<<8|this.bin[this.pos+1];return this.pos+=2,t}readInt16BE(){const t=this.readUInt16BE();return(t&32768)!==0?t-65536:t}readUInt16LE(){const t=this.bin[this.pos]|this.bin[this.pos+1]<<8;return this.pos+=2,t}readInt16LE(){const t=this.readUInt16LE();return(t&32768)!==0?t-65536:t}readUInt32BE(){const t=this.bin[this.pos]*16777216+(this.bin[this.pos+1]<<16|this.bin[this.pos+2]<<8|this.bin[this.pos+3]);return this.pos+=4,t}readInt32BE(){const t=this.readUInt32BE();return(t&2147483648)!==0?t-4294967296:t}readUInt32LE(){const t=(this.bin[this.pos]|this.bin[this.pos+1]<<8|this.bin[this.pos+2]<<16|this.bin[this.pos+3]<<24)>>>0;return this.pos+=4,t}readInt32LE(){const t=this.readUInt32LE();return(t&2147483648)!==0?t-4294967296:t}readUInt64BEBn(){const t=this.bin.slice(this.pos,this.pos+8),e=new w(t);return this.pos=this.pos+8,e}readUInt64LEBn(){const t=this.readReverse(8);return new w(t)}readInt64LEBn(){const t=this.readReverse(8);let e=new w(t);return e.gte(vr)&&(e=e.sub(li)),e}readVarIntNum(t=!0){const e=this.readUInt8();let n;switch(e){case 253:return this.readUInt16LE();case 254:return this.readUInt32LE();case 255:if(n=t?this.readInt64LEBn():this.readUInt64LEBn(),n.lte(new w(2).pow(new w(53))))return n.toNumber();throw new Error("number too large to retain precision - use readVarIntBn");default:return e}}readVarInt(){switch(this.bin[this.pos]){case 253:return this.read(3);case 254:return this.read(5);case 255:return this.read(9);default:return this.read(1)}}readVarIntBn(){const t=this.readUInt8();switch(t){case 253:return new w(this.readUInt16LE());case 254:return new w(this.readUInt32LE());case 255:return this.readUInt64LEBn();default:return new w(t)}}}const In=r=>{if(r.length===0)return r;const t=r[r.length-1];if((t&127)!==0)return r;if(r.length===1)return[];if((r[r.length-2]&128)!==0)return r;for(let e=r.length-1;e>0;e--)if(r[e-1]!==0)return(r[e-1]&128)!==0?(r[e]=t,r.slice(0,e+1)):(r[e-1]|=t,r.slice(0,e));return[]},vr=new w(2).pow(new w(63)),li=new w(2).pow(new w(64));function ve(r,t="Expected a valid value, but got undefined or null."){if(r==null)throw new Error(t);return r}function Or(r,t){if(r.length!==t.length)return!1;let e=0;for(let n=0;n<r.length;n++)e|=r[n]^t[n];return e===0}function Sn(r,t,e){const n=-r,i=(t.X^e.X)&n,s=(t.Y^e.Y)&n,a=(t.Z^e.Z)&n;t.X^=i,e.X^=i,t.Y^=s,e.Y^=s,t.Z^=a,e.Z^=a}const F=0n,nt=1n,We=2n,Er=3n,Ar=4n,Pr=8n,yt=0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2fn,Ht=0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141n,kn=(1n<<256n)-1n;function rn(r){let t=r>>256n;return r=(r&kn)+(t<<32n)+t*977n,t=r>>256n,r=(r&kn)+(t<<32n)+t*977n,r>=yt&&(r-=yt),r}const Ut=r=>rn((r%yt+yt)%yt),pt=(r,t)=>r>=t?r-t:yt-(t-r),P=(r,t)=>rn(r*t),vn=(r,t)=>rn(r+t),Jt=r=>{let t=nt,e=F,n=Ut(r),i=yt;for(;n>nt;){const s=i/n;[t,e]=[e-t*s,t],[n,i]=[i-n*s,n]}return Ut(t)},Nr=r=>P(r,r),_r=(r,t)=>{let e=1n;for(r=Ut(r);t>0n;)(t&1n)!==0n&&(e=P(e,r)),r=P(r,r),t>>=1n;return e},Tr=yt+1n>>2n,Br=r=>{const t=_r(r,Tr);return P(t,t)!==Ut(r)?null:t},Cr=r=>w.isBN(r)?BigInt("0x"+r.toString(16)):typeof r=="string"?BigInt("0x"+r):Array.isArray(r)?BigInt("0x"+N(r)):BigInt(r),ze=BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),$e=BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"),On=new Map,se=r=>{const{X:t,Y:e,Z:n}=r;if(e===F)return{X:F,Y:nt,Z:F};const i=P(e,e),s=P(Ar,P(t,i)),a=P(Er,P(t,t)),o=pt(P(a,a),P(We,s)),c=pt(P(a,pt(s,o)),P(Pr,P(i,i))),f=P(We,P(e,n));return{X:o,Y:c,Z:f}},ae=(r,t)=>{if(r.Z===F)return t;if(t.Z===F)return r;const e=P(r.Z,r.Z),n=P(t.Z,t.Z),i=P(r.X,n),s=P(t.X,e),a=P(r.Y,P(n,t.Z)),o=P(t.Y,P(e,r.Z)),c=pt(s,i),f=pt(o,a);if(c===F)return f===F?se(r):{X:F,Y:nt,Z:F};const u=P(c,c),h=P(c,u),b=P(i,u),g=pt(pt(P(f,f),h),P(We,b)),p=pt(P(f,pt(b,g)),P(a,h)),m=P(c,P(r.Z,t.Z));return{X:g,Y:p,Z:m}},Rr=r=>r.Z===F?r:{X:r.X,Y:yt-r.Y,Z:r.Z},Xe=(r,t,e=5)=>{const n=`${e}:${t.x.toString(16)}:${t.y.toString(16)}`;let i=On.get(n),s;if(i===void 0){const h=1<<e-1;i=new Array(h),s={X:t.x,Y:t.y,Z:nt},i[0]=s;const b=se(s);for(let g=1;g<h;g++)i[g]=ae(i[g-1],b);On.set(n,i)}else s=i[0];const a=[],o=1n<<BigInt(e),c=o>>1n;let f=r;for(;f>0n;)if((f&nt)===F)a.push(0),f>>=nt;else{let h=f&o-1n;h>c&&(h-=o),a.push(Number(h)),f-=h,f>>=nt}let u={X:F,Y:nt,Z:F};for(let h=a.length-1;h>=0;h--){u=se(u);const b=a[h];if(b!==0){const g=Math.abs(b)>>1,p=b>0?i[g]:Rr(i[g]);u=ae(u,p)}}return u},Gt=r=>{let t=r%Ht;return t<0n&&(t+=Ht),t},Oe=(r,t)=>Gt(r*t),bi=r=>{let t=1n,e=0n,n=Gt(r),i=Ht;for(;n>1n;){const s=i/n;[t,e]=[e-t*s,t],[n,i]=[i-n*s,n]}return Gt(t)};class C extends Xn{constructor(e,n,i=!0){super("affine");l(this,"x");l(this,"y");l(this,"inf");this.precomputed=null,e===null&&n===null?(this.x=null,this.y=null,this.inf=!0):(w.isBN(e)||(e=new w(e,16)),this.x=e,w.isBN(n)||(n=new w(n,16)),this.y=n,i&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red===null&&(this.x=this.x.toRed(this.curve.red)),this.y.red===null&&(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}static _assertOnCurve(e){if(!e.validate())throw new Error("Invalid point");return e}static fromDER(e){if((e[0]===4||e[0]===6||e[0]===7)&&e.length-1===64){if(e[0]===6){if(e[e.length-1]%2!==0)throw new Error("Point string value is wrong length")}else if(e[0]===7&&e[e.length-1]%2!==1)throw new Error("Point string value is wrong length");const i=new C(e.slice(1,33),e.slice(33,65));return C._assertOnCurve(i)}else if((e[0]===2||e[0]===3)&&e.length-1===32)return C._assertOnCurve(C.fromX(e.slice(1,33),e[0]===3));throw new Error("Unknown point format")}static fromString(e){const n=x(e,"hex");return C._assertOnCurve(C.fromDER(n))}static fromX(e,n){let i=Cr(e);i=Ut(i);const s=vn(P(Nr(i),i),7n),a=Br(s);if(a===null)throw new Error("Invalid point");let o=a;(o&nt)!==(n?nt:F)&&(o=pt(yt,o));const c=new w(i.toString(16),16),f=new w(o.toString(16),16);return C._assertOnCurve(new C(c,f))}static fromJSON(e,n){typeof e=="string"&&(e=JSON.parse(e));let i=new C(e[0],e[1],n);if(i=C._assertOnCurve(i),typeof e[2]!="object"||e[2]===null)return i;const s=e[2],a=o=>{const c=new C(o[0],o[1],n);return C._assertOnCurve(c)};return i.precomputed={beta:null,doubles:typeof s.doubles=="object"&&s.doubles!==null?{step:s.doubles.step,points:[i].concat(s.doubles.points.map(a))}:void 0,naf:typeof s.naf=="object"&&s.naf!==null?{wnd:s.naf.wnd,points:[i].concat(s.naf.points.map(a))}:void 0},i}validate(){if(this.inf||this.x==null||this.y==null)return!1;try{const e=BigInt("0x"+this.x.fromRed().toString(16)),n=BigInt("0x"+this.y.fromRed().toString(16)),i=P(n,n),s=vn(P(P(e,e),e),7n);return i===s}catch{return!1}}encode(e=!0,n){if(this.inf)return n==="hex"?"00":[0];const i=this.curve.p.byteLength(),s=this.getX().toArray("be",i);let a;return e?a=[this.getY().isEven()?2:3].concat(s):a=[4].concat(s,this.getY().toArray("be",i)),n!=="hex"?a:N(a)}toString(){return this.encode(!0,"hex")}toJSON(){return this.precomputed==null?[this.x,this.y]:[this.x,this.y,typeof this.precomputed=="object"&&this.precomputed!==null?{doubles:this.precomputed.doubles!=null?{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)}:void 0,naf:this.precomputed.naf!=null?{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}:void 0}:void 0]}inspect(){var e,n,i,s;return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+(((n=(e=this.x)==null?void 0:e.fromRed())==null?void 0:n.toString(16,2))??"undefined")+" y: "+(((s=(i=this.y)==null?void 0:i.fromRed())==null?void 0:s.toString(16,2))??"undefined")+">"}isInfinity(){return this.inf}add(e){var u;if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return new C(null,null);if(((u=this.x)==null?void 0:u.cmp(e.x??new w(0)))===0)return new C(null,null);const n={X:BigInt("0x"+this.x.fromRed().toString(16)),Y:BigInt("0x"+this.y.fromRed().toString(16)),Z:nt},i={X:BigInt("0x"+e.x.fromRed().toString(16)),Y:BigInt("0x"+e.y.fromRed().toString(16)),Z:nt},s=ae(n,i);if(s.Z===F)return new C(null,null);const a=Jt(s.Z),o=P(a,a),c=P(s.X,o),f=P(s.Y,P(o,a));return new C(c.toString(16),f.toString(16))}dbl(){if(this.inf)return this;if(this.x===null||this.y===null)throw new Error("Point coordinates cannot be null");const e=BigInt("0x"+this.x.fromRed().toString(16)),n=BigInt("0x"+this.y.fromRed().toString(16));if(n===F)return new C(null,null);const i=se({X:e,Y:n,Z:nt}),s=Jt(i.Z),a=P(s,s),o=P(i.X,a),c=P(i.Y,P(a,s));return new C(o.toString(16),c.toString(16))}getX(){return(this.x??new w(0)).fromRed()}getY(){return(this.y??new w(0)).fromRed()}mul(e){if(w.isBN(e)||(e=new w(e,16)),e=e,this.inf)return this;const n=e.isNeg(),i=n?e.neg():e;let s=BigInt("0x"+i.toString(16));if(s=Ut(s),s===F)return new C(null,null);if(s===F)return new C(null,null);if(this.x===null||this.y===null)throw new Error("Point coordinates cannot be null");let a,o;this===this.curve.g?(a=ze,o=$e):(a=BigInt("0x"+this.x.fromRed().toString(16)),o=BigInt("0x"+this.y.fromRed().toString(16)));const c=Xe(s,{x:a,y:o});if(c.Z===F)return new C(null,null);const f=Jt(c.Z),u=P(f,f),h=P(c.X,u),b=P(c.Y,P(u,f)),g=new w(h.toString(16),16),p=new w(b.toString(16),16),m=new C(g,p);return n?m.neg():m}mulCT(e){if(w.isBN(e)||(e=new w(e,16)),e=e,this.inf)return new C(null,null);const n=e.isNeg(),i=n?e.neg():e;let s=BigInt("0x"+i.toString(16));if(s=Ut(s),s===0n)return new C(null,null);const a=this===this.curve.g?ze:BigInt("0x"+this.getX().toString(16)),o=this===this.curve.g?$e:BigInt("0x"+this.getY().toString(16));let c={X:0n,Y:1n,Z:0n},f={X:a,Y:o,Z:1n};const u=s.toString(2);for(let y=0;y<u.length;y++){const k=u[y]==="1"?1n:0n;Sn(k,c,f),f=ae(c,f),c=se(c),Sn(k,c,f)}if(c.Z===0n)return new C(null,null);const h=Jt(c.Z),b=P(h,h),g=P(c.X,b),p=P(c.Y,P(b,h)),m=new C(g.toString(16),p.toString(16));return n?m.neg():m}mulAdd(e,n,i){const s=[this,n],a=[e,i];return this._endoWnafMulAdd(s,a)}jmulAdd(e,n,i){const s=[this,n],a=[e,i];return this._endoWnafMulAdd(s,a,!0)}eq(e){return this===e||this.inf===e.inf&&(this.inf||(this.x??new w(0)).cmp(e.x??new w(0))===0&&(this.y??new w(0)).cmp(e.y??new w(0))===0)}neg(e){if(this.inf)return this;const n=new C(this.x,(this.y??new w(0)).redNeg());if(e===!0&&this.precomputed!=null){const i=this.precomputed,s=a=>a.neg();n.precomputed={naf:i.naf!=null?{wnd:i.naf.wnd,points:i.naf.points.map(s)}:void 0,doubles:i.doubles!=null?{step:i.doubles.step,points:i.doubles.points.map(a=>a.neg())}:void 0,beta:void 0}}return n}dblp(e){let n=this;for(let i=0;i<e;i++)n=n.dbl();return n}toJ(){return this.inf?new ot(null,null,null):new ot(this.x,this.y,this.curve.one)}_getBeta(){if(typeof this.curve.endo!="object")return;const e=this.precomputed;if(typeof e=="object"&&e!==null&&typeof e.beta=="object"&&e.beta!==null)return e.beta;const n=new C((this.x??new w(0)).redMul(this.curve.endo.beta),this.y);if(e!=null){const i=this.curve,s=a=>{if(a.x===null)throw new Error("p.x is null");if(i.endo===void 0||i.endo===null)throw new Error("curve.endo is undefined");return new C(a.x.redMul(i.endo.beta),a.y)};e.beta=n,n.precomputed={beta:null,naf:e.naf!=null?{wnd:e.naf.wnd,points:e.naf.points.map(s)}:void 0,doubles:e.doubles!=null?{step:e.doubles.step,points:e.doubles.points.map(s)}:void 0}}return n}_fixedNafMul(e){if(typeof this.precomputed!="object"||this.precomputed===null)throw new Error("_fixedNafMul requires precomputed values for the point");const n=this._getDoubles(),i=this.curve.getNAF(e,1,this.curve._bitLength);let s=(1<<n.step+1)-(n.step%2===0?2:1);s/=3;const a=[];for(let f=0;f<i.length;f+=n.step){let u=0;for(let h=f+n.step-1;h>=f;h--)u=(u<<1)+i[h];a.push(u)}let o=new ot(null,null,null),c=new ot(null,null,null);for(let f=s;f>0;f--){for(let u=0;u<a.length;u++){const h=a[u];h===f?c=c.mixedAdd(n.points[u]):h===-f&&(c=c.mixedAdd(n.points[u].neg()))}o=o.add(c)}return o.toP()}_wnafMulAdd(e,n,i,s,a){const o=this.curve._wnafT1.map(g=>g.toNumber()),c=this.curve._wnafT2.map(()=>[]),f=this.curve._wnafT3.map(()=>[]);let u=0;for(let g=0;g<s;g++){const m=n[g]._getNAFPoints(e);o[g]=m.wnd,c[g]=m.points}for(let g=s-1;g>=1;g-=2){const p=g-1,m=g;if(o[p]!==1||o[m]!==1){f[p]=this.curve.getNAF(i[p],o[p],this.curve._bitLength),f[m]=this.curve.getNAF(i[m],o[m],this.curve._bitLength),u=Math.max(f[p].length,u),u=Math.max(f[m].length,u);continue}const y=[n[p],null,null,n[m]];(n[p].y??new w(0)).cmp(n[m].y??new w(0))===0?(y[1]=n[p].add(n[m]),y[2]=n[p].toJ().mixedAdd(n[m].neg())):(n[p].y??new w(0)).cmp((n[m].y??new w(0)).redNeg())===0?(y[1]=n[p].toJ().mixedAdd(n[m]),y[2]=n[p].add(n[m].neg())):(y[1]=n[p].toJ().mixedAdd(n[m]),y[2]=n[p].toJ().mixedAdd(n[m].neg()));const k=[-3,-1,-5,-7,0,7,5,1,3],I=this.curve.getJSF(i[p],i[m]);u=Math.max(I[0].length,u),f[p]=new Array(u),f[m]=new Array(u);for(let v=0;v<u;v++){const E=I[0][v]|0,_=I[1][v]|0;f[p][v]=k[(E+1)*3+(_+1)],f[m][v]=0,c[p]=y}}let h=new ot(null,null,null);const b=this.curve._wnafT4;for(let g=u;g>=0;g--){let p=0;for(;g>=0;){let k=!0;for(let I=0;I<s;I++)b[I]=new w(typeof f[I][g]=="number"?f[I][g]:0),b[I].isZero()||(k=!1);if(!k)break;p++,g--}if(g>=0&&p++,h=h.dblp(p),g<0)break;const m=new w(1),y=new w(2);for(let k=0;k<s;k++){const I=b[k];let v;I.cmpn(0)!==0&&(I.isNeg()?v=c[k][I.neg().sub(m).div(y).toNumber()].neg():v=c[k][I.sub(m).div(y).toNumber()],v.type==="affine"?h=h.mixedAdd(v):h=h.add(v))}}for(let g=0;g<s;g++)c[g]=[];return a===!0?h:h.toP()}_endoWnafMulAdd(e,n,i){const s=new Array(e.length*2),a=new Array(e.length*2);let o;for(o=0;o<e.length;o++){const f=this.curve._endoSplit(n[o]);let u=e[o],h=u._getBeta()??new C(null,null);f.k1.negative!==0&&(f.k1.ineg(),u=u.neg(!0)),f.k2.negative!==0&&(f.k2.ineg(),h=h.neg(!0)),s[o*2]=u,s[o*2+1]=h,a[o*2]=f.k1,a[o*2+1]=f.k2}const c=this._wnafMulAdd(1,s,a,o*2,i);for(let f=0;f<o*2;f++)s[f]=null,a[f]=null;return c}_hasDoubles(e){if(this.precomputed==null)return!1;const n=this.precomputed.doubles;return typeof n!="object"?!1:n.points.length>=Math.ceil((e.bitLength()+1)/n.step)}_getDoubles(e,n){if(typeof this.precomputed=="object"&&this.precomputed!==null&&typeof this.precomputed.doubles=="object"&&this.precomputed.doubles!==null)return this.precomputed.doubles;const i=[this];let s=this;for(let a=0;a<(n??0);a+=e??1){for(let o=0;o<(e??1);o++)s=s.dbl();i.push(s)}return{step:e??1,points:i}}_getNAFPoints(e){if(typeof this.precomputed=="object"&&this.precomputed!==null&&typeof this.precomputed.naf=="object"&&this.precomputed.naf!==null)return this.precomputed.naf;const n=[this],i=(1<<e)-1,s=i===1?null:this.dbl();for(let a=1;a<i;a++)s!==null&&(n[a]=n[a-1].add(s));return{wnd:e,points:n}}}let Le;class Z{constructor(){l(this,"p");l(this,"red");l(this,"redN");l(this,"zero");l(this,"one");l(this,"two");l(this,"g");l(this,"n");l(this,"a");l(this,"b");l(this,"tinv");l(this,"zeroA");l(this,"threeA");l(this,"endo");l(this,"_endoWnafT1");l(this,"_endoWnafT2");l(this,"_wnafT1");l(this,"_wnafT2");l(this,"_wnafT3");l(this,"_wnafT4");l(this,"_bitLength");if(typeof Le<"u")return Le;Le=this;const e={prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",{doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}]};this.p=new w(e.p,16),this.red=new $n(e.prime),this.zero=new w(0).toRed(this.red),this.one=new w(1).toRed(this.red),this.two=new w(2).toRed(this.red),this.n=new w(e.n,16),this.g=C.fromJSON(e.g,e.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n.bitLength(),this.redN=this.n.toRed(this.red),this.a=new w(e.a,16).toRed(this.red),this.b=new w(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}static assert(t,e="Elliptic curve assertion failed"){if(!t)throw new Error(e)}getNAF(t,e,n){const i=new Array(Math.max(t.bitLength(),n)+1);i.fill(0);const s=1<<e+1,a=t.clone();for(let o=0;o<i.length;o++){let c;const f=a.andln(s-1);a.isOdd()?(f>(s>>1)-1?c=(s>>1)-f:c=f,a.isubn(c)):c=0,i[o]=c,a.iushrn(1)}return i}getJSF(t,e){const n=[[],[]];t=t.clone(),e=e.clone();let i=0,s=0;for(;t.cmpn(-i)>0||e.cmpn(-s)>0;){let a=t.andln(3)+i&3,o=e.andln(3)+s&3;a===3&&(a=-1),o===3&&(o=-1);let c;if((a&1)===0)c=0;else{const u=t.andln(7)+i&7;(u===3||u===5)&&o===2?c=-a:c=a}n[0].push(c);let f;if((o&1)===0)f=0;else{const u=e.andln(7)+s&7;(u===3||u===5)&&a===2?f=-o:f=o}n[1].push(f),2*i===c+1&&(i=1-i),2*s===f+1&&(s=1-s),t.iushrn(1),e.iushrn(1)}return n}static cachedProperty(t,e,n){const i="_"+e;t.prototype[e]=function(){return this[i]!==void 0?this[i]:this[i]=n.call(this)}}static parseBytes(t){return typeof t=="string"?x(t,"hex"):t}static intFromLE(t){return new w(t,"hex","le")}_getEndomorphism(t){var s,a;if(!this.zeroA||this.p.modrn(3)!==1)return;let e,n;if(t.beta!==void 0)e=new w(t.beta,16).toRed(this.red);else{const o=this._getEndoRoots(this.p);if(o===null)throw new Error("Failed to get endomorphism roots for beta.");e=o[0].cmp(o[1])<0?o[0]:o[1],e=e.toRed(this.red)}if(t.lambda!==void 0)n=new w(t.lambda,16);else{const o=this._getEndoRoots(this.n);if(o===null)throw new Error("Failed to get endomorphism roots for lambda.");if(this.g==null)throw new Error("Curve generator point (g) is not defined.");const c=(s=this.g.mul(o[0]))==null?void 0:s.x,f=this.g.x!=null?this.g.x.redMul(e):void 0;if(c!=null&&f!=null&&c.cmp(f)===0)n=o[0];else{if(n=o[1],this.g==null)throw new Error("Curve generator point (g) is not defined.");const u=(a=this.g.mul(n))==null?void 0:a.x,h=this.g.x!=null?this.g.x.redMul(e):void 0;if(u==null||h==null)throw new Error("Lambda computation failed: g.mul(lambda).x or g.x.redMul(beta) is undefined.");Z.assert(u.cmp(h)===0,"Lambda selection does not match computed beta.")}}let i;return typeof t.basis=="object"&&t.basis!==null?i=t.basis.map(function(o){return{a:new w(o.a,16),b:new w(o.b,16)}}):i=this._getEndoBasis(n),{beta:e,lambda:n,basis:i}}_getEndoRoots(t){const e=t===this.p?this.red:new Ti(t),n=new w(2).toRed(e).redInvm(),i=n.redNeg(),s=new w(3).toRed(e).redNeg().redSqrt().redMul(n),a=i.redAdd(s).fromRed(),o=i.redSub(s).fromRed();return[a,o]}_getEndoBasis(t){const e=this.n.ushrn(Math.floor(this.n.bitLength()/2));let n=t,i=this.n.clone(),s=new w(1),a=new w(0),o=new w(0),c=new w(1),f,u,h,b,g,p,m=new w(0),y=0,k=new w(0),I=new w(0);for(;n.cmpn(0)!==0;){const _=i.div(n);k=i.sub(_.mul(n)),I=o.sub(_.mul(s));const V=c.sub(_.mul(a));if(h===void 0&&k.cmp(e)<0)f=m.neg(),u=s,h=k.neg(),b=I;else if(h!==void 0&&++y===2)break;m=k,i=n,n=k,o=s,s=I,c=a,a=V}if(f===void 0||u===void 0||h===void 0||b===void 0)throw new Error("Failed to compute Endo Basis values");g=k.neg(),p=I;const v=h.sqr().add(b.sqr());return g.sqr().add(p.sqr()).cmp(v)>=0&&(g=f,p=u),h.negative!==0&&(h=h.neg(),b=b.neg()),g.negative!==0&&(g=g.neg(),p=p.neg()),[{a:h,b},{a:g,b:p}]}_endoSplit(t){if(this.endo==null)throw new Error("Endomorphism is not defined.");const e=this.endo.basis,n=e[0],i=e[1],s=i.b.mul(t).divRound(this.n),a=n.b.neg().mul(t).divRound(this.n),o=s.mul(n.a),c=a.mul(i.a),f=s.mul(n.b),u=a.mul(i.b),h=t.sub(o).sub(c),b=f.add(u).neg();return{k1:h,k2:b}}validate(t){if(t.inf)return!0;const e=t.x,n=t.y;if(e===null||n===null)throw new Error("Point coordinates cannot be null");const i=this.a.redMul(e),s=e.redSqr().redMul(e).redIAdd(i).redIAdd(this.b);return n.redSqr().redISub(s).cmpn(0)===0}}class At{constructor(t,e){l(this,"r");l(this,"s");this.r=t,this.s=e}static fromDER(t,e){const n=(h,b)=>{const g=h[b.place++];if((g&128)===0)return g;throw new Error("Invalid DER entity length")};class i{constructor(){l(this,"place");this.place=0}}t=x(t,e);const s=new i;if(t[s.place++]!==48)throw new Error("Signature DER must start with 0x30");if(n(t,s)+s.place!==t.length)throw new Error("Signature DER invalid");if(t[s.place++]!==2)throw new Error("Signature DER invalid");const o=n(t,s);let c=t.slice(s.place,o+s.place);if(s.place+=o,t[s.place++]!==2)throw new Error("Signature DER invalid");const f=n(t,s);if(t.length!==f+s.place)throw new Error("Invalid R-length in signature DER");let u=t.slice(s.place,f+s.place);if(c[0]===0)if((c[1]&128)!==0)c=c.slice(1);else throw new Error("Invalid R-value in signature DER");if(u[0]===0)if((u[1]&128)!==0)u=u.slice(1);else throw new Error("Invalid S-value in signature DER");return new At(new w(c),new w(u))}static fromCompact(t,e){if(t=x(t,e),t.length!==65)throw new Error("Invalid Compact Signature");const n=t[0];if(n<27||n>=35)throw new Error("Invalid Compact Byte");return new At(new w(t.slice(1,33)),new w(t.slice(33,65)))}verify(t,e,n){const i=new w(Et(t,n),16);return ce(i,this,e)}toString(t){return this.toDER(t)}toDER(t){const e=(f,u)=>{if(u<128)f.push(u);else throw new Error("len must be < 0x80")},n=f=>{let u=0;const h=f.length-1;for(;f[u]===0&&(f[u+1]&128)===0&&u<h;)u++;return u===0?f:f.slice(u)};let i=this.r.toArray(),s=this.s.toArray();for((i[0]&128)!==0&&(i=[0].concat(i)),(s[0]&128)!==0&&(s=[0].concat(s)),i=n(i),s=n(s);s[0]===0&&(s[1]&128)===0;)s=s.slice(1);let a=[2];e(a,i.length),a=a.concat(i),a.push(2),e(a,s.length);const o=a.concat(s);let c=[48];return e(c,o.length),c=c.concat(o),t==="hex"?N(c):t==="base64"?Ot(c):c}toCompact(t,e,n){if(t<0||t>3)throw new Error("Invalid recovery param");if(typeof e!="boolean")throw new Error("Invalid compressed param");let i=27+t;e&&(i+=4);let s=[i];return s=s.concat(this.r.toArray("be",32)),s=s.concat(this.s.toArray("be",32)),n==="hex"?N(s):n==="base64"?Ot(s):s}RecoverPublicKey(t,e){const n=this.r,i=this.s,s=(t&1)!==0,a=t>>1,o=new Z,c=o.n,f=o.g,u=a!==0?n.add(c):n,h=C.fromX(u,s);if(!h.mul(c).isInfinity())throw new Error("nR is not at infinity");const g=e.neg().umod(c),p=n.invm(c),m=p.mul(i).umod(c),y=p.mul(g).umod(c),k=f.mul(y).add(h.mul(m)),I=new st(k);return I.validate(),I}CalculateRecoveryFactor(t,e){for(let n=0;n<4;n++){let i;try{i=this.RecoverPublicKey(n,e)}catch{continue}if(t.eq(i))return n}throw new Error("Unable to find valid recovery factor")}}class Lr{constructor(t,e){l(this,"K");l(this,"V");const n=x(t,"hex"),i=x(e,"hex");if(n.length!==32)throw new Error("Entropy must be exactly 32 bytes (256 bits)");if(i.length!==32)throw new Error("Nonce must be exactly 32 bytes (256 bits)");const s=n.concat(i);this.K=new Array(32),this.V=new Array(32);for(let a=0;a<32;a++)this.K[a]=0,this.V[a]=1;this.update(s)}hmac(){return new ei(this.K)}update(t){let e=this.hmac().update(this.V).update([0]);t!==void 0&&(e=e.update(t)),this.K=e.digest(),this.V=this.hmac().update(this.V).digest(),t!==void 0&&(this.K=this.hmac().update(this.V).update([1]).update(t).digest(),this.V=this.hmac().update(this.V).digest())}generate(t){let e=[];for(;e.length<t;)this.V=this.hmac().update(this.V).digest(),e=e.concat(this.V);const n=e.slice(0,t);return this.update(),N(n)}}function En(r,t,e=new Z){const n=r.byteLength()*8-e.n.bitLength();return n>0&&r.iushrn(n),t!==!0&&r.cmp(e.n)>=0?r.sub(e.n):r}function Ct(r){const t=r.toArray("be");let e=0n;for(let n=0;n<t.length;n++)e=e<<8n|BigInt(t[n]);return e}const oe=new Z,Ue=oe.n.byteLength(),Ur=oe.n.subn(1),Vr=Ht>>1n,pi=(r,t,e=!1,n)=>{const i=oe.n.bitLength();if(r.bitLength()>i)throw new Error(`ECDSA message is too large: expected <= ${i} bits. Callers must hash messages before signing.`);r=En(r);const s=Ct(r),a=Ct(t),o=t.toArray("be",Ue),c=r.toArray("be",Ue),f=new Lr(o,c);for(let u=0;;u++){let h=typeof n=="function"?n(u):w.isBN(n)?n:new w(f.generate(Ue),16);if(h==null)throw new Error("k is undefined");if(h=En(h,!0),h.cmpn(1)<0||h.cmp(Ur)>0){if(w.isBN(n))throw new Error("Invalid fixed custom K value (must be >1 and <N-1)");continue}const b=oe.g.mulCT(h);if(b.isInfinity()){if(w.isBN(n))throw new Error("Invalid fixed custom K value (kG at infinity)");continue}const g=BigInt("0x"+b.getX().toString(16)),p=Gt(g);if(p===0n){if(w.isBN(n))throw new Error("Invalid fixed custom K value (r == 0)");continue}const m=BigInt("0x"+h.toString(16)),y=bi(m),k=Oe(p,a),I=Gt(s+k);let v=Oe(y,I);if(v===0n){if(w.isBN(n))throw new Error("Invalid fixed custom K value (s == 0)");continue}e&&v>Vr&&(v=Ht-v);const E=new w(p.toString(16),16),_=new w(v.toString(16),16);return new At(E,_)}},ce=(r,t,e)=>{const n=oe.n.bitLength();if(r.bitLength()>n)return!1;const i=Ct(r);if(e.x==null||e.y==null)throw new Error("Invalid public key: missing coordinates.");const s={x:Ct(e.x),y:Ct(e.y)},a={r:Ct(t.r),s:Ct(t.s)},{r:o,s:c}=a,f=i;if(o<=F||o>=Ht||c<=F||c>=Ht)return!1;const u=bi(c);if(u===0n)return!1;const h=Oe(f,u),b=Oe(o,u),g=Xe(h,{x:ze,y:$e}),p=Xe(b,s),m=ae(g,p);if(m.Z===0n)return!1;const y=Jt(m.Z),k=P(y,y),I=P(m.X,k);return Gt(I)===o};class st extends C{static fromPrivateKey(t){const n=new Z().g.mul(t);return new st(n.x,n.y)}static fromString(t){const e=C.fromString(t);return new st(e.x,e.y)}static fromDER(t){const e=C.fromDER(t);return new st(e.x,e.y)}constructor(t,e=null,n=!0){if(t instanceof C)super(t.getX(),t.getY());else{if(e===null&&n&&typeof t=="string"&&(t.length===66||t.length===130))throw new Error('You are using the "new PublicKey()" constructor with a DER hex string. You need to use "PublicKey.fromString()" instead.');super(t,e,n)}}deriveSharedSecret(t){if(!this.validate())throw new Error("Public key not valid for ECDH secret derivation");return this.mulCT(t)}verify(t,e,n){const i=new w(Et(t,n),16);return ce(i,e,this)}toDER(t){return t==="hex"?this.encode(!0,t):this.encode(!0)}toHash(t){const e=ni(this.encode(!0));return t==="hex"?N(e):e}toAddress(t=[0]){if(typeof t=="string")if(t==="testnet"||t==="test")t=[111];else if(t==="mainnet"||t==="main")t=[0];else throw new Error(`Invalid prefix ${t}`);return hi(this.toHash(),t)}deriveChild(t,e,n,i){let s;if(typeof i=="function"){const h=i(t,this);typeof h<"u"?s=h:(s=this.deriveSharedSecret(t),typeof n=="function"&&n(t,this,s))}else s=this.deriveSharedSecret(t);const a=x(e,"utf8"),o=ie(s.encode(!0),a),f=new Z().g.mul(new w(o)),u=this.add(f);return new st(u.x,u.y)}static fromMsgHashAndCompactSignature(t,e,n){const i=x(e,n);if(i.length!==65)throw new Error("Invalid Compact Signature");const s=i[0];if(s<27||s>=35)throw new Error("Invalid Compact Byte");let a=i[0]-27;return a>3&&(a-=4),new At(new w(i.slice(1,33)),new w(i.slice(33,65))).RecoverPublicKey(a,t)}}class Hr{constructor(){l(this,"_rand");var e,n,i,s;const t=()=>{throw new Error("No secure random number generator is available in this environment.")};if(this._rand=t,typeof globalThis<"u"&&typeof((e=globalThis.crypto)==null?void 0:e.getRandomValues)=="function"){this._rand=a=>this.getRandomValues(globalThis,a);return}if(typeof process<"u"&&((n=process.release)==null?void 0:n.name)==="node")try{const a=require("crypto");if(typeof a.randomBytes=="function"){this._rand=o=>Array.from(a.randomBytes(o));return}}catch{}if(typeof self<"u"&&typeof((i=self.crypto)==null?void 0:i.getRandomValues)=="function"){this._rand=a=>this.getRandomValues(self,a);return}if(typeof window<"u"&&typeof((s=window.crypto)==null?void 0:s.getRandomValues)=="function"){this._rand=a=>this.getRandomValues(window,a);return}this._rand=t}getRandomValues(t,e){const n=new Uint8Array(e);return t.crypto.getRandomValues(n),Array.from(n)}generate(t){return this._rand(t)}}let Ve=null;const xt=r=>(Ve==null&&(Ve=new Hr),Ve.generate(r));class Yt{constructor(t,e){l(this,"x");l(this,"y");const n=new Z().p;this.x=t.umod(n),this.y=e.umod(n)}toString(){return Ke(this.x.toArray())+"."+Ke(this.y.toArray())}static fromString(t){const[e,n]=t.split(".");return new Yt(new w(qe(e)),new w(qe(n)))}}class Ee{constructor(t,e){l(this,"points");l(this,"threshold");this.points=t,this.threshold=e??t.length}static fromPrivateKey(t,e){const n=new Z().p,i=[new Yt(new w(0),new w(t.toArray()))];for(let s=1;s<e;s++){const a=new w(xt(32)).umod(n),o=new w(xt(32)).umod(n);i.push(new Yt(a,o))}return new Ee(i)}valueAt(t){const e=new Z().p;let n=new w(0);for(let i=0;i<this.threshold;i++){let s=this.points[i].y;for(let a=0;a<this.threshold;a++)if(i!==a){const o=this.points[a].x,c=this.points[i].x,f=t.sub(o).umod(e),h=c.sub(o).umod(e).invm(e),b=f.mul(h).umod(e);s=s.mul(b).umod(e)}n=n.add(s).umod(e)}return n}}class Ae{constructor(t,e,n){l(this,"points");l(this,"threshold");l(this,"integrity");this.points=t,this.threshold=e,this.integrity=n}static fromBackupFormat(t){let e=0,n="";const i=t.map((s,a)=>{const o=s.split(".");if(o.length!==4)throw new Error("Invalid share format in share "+a.toString()+'. Expected format: "x.y.t.i" - received '+s);const[c,f,u,h]=o;if(u===void 0)throw new Error("Threshold not found in share "+a.toString());if(h===void 0)throw new Error("Integrity not found in share "+a.toString());const b=parseInt(u);if(a!==0&&e!==b)throw new Error("Threshold mismatch in share "+a.toString());if(a!==0&&n!==h)throw new Error("Integrity mismatch in share "+a.toString());return e=b,n=h,Yt.fromString([c,f].join("."))});return new Ae(i,e,n)}toBackupFormat(){return this.points.map(t=>t.toString()+"."+this.threshold.toString()+"."+this.integrity)}}class et extends w{static fromRandom(){return new et(xt(32))}static fromString(t,e="hex"){return new et(super.fromString(t,e).toArray())}static fromHex(t){return new et(super.fromHex(t,"big"))}static fromWif(t,e=1){const n=di(t,void 0,e);if(n.data.length!==33)throw new Error("Invalid WIF length");if(n.data[32]!==1)throw new Error("Invalid WIF padding");return new et(n.data.slice(0,32))}constructor(t=0,e=10,n="be",i="apply"){if(t instanceof w?(super(),t.copy(this)):super(t,e,n),i!=="nocheck"){const s=this.checkInField();if(!s.inField){if(i==="error")throw new Error("Input is out of field");w.move(this,s.modN)}}}checkInField(){const t=new Z,e=this.mod(t.n);return{inField:this.cmp(e)===0,modN:e}}isValid(){return this.checkInField().inField}sign(t,e,n=!0,i){const s=new w(Et(t,e),16);return pi(s,this,n,i)}verify(t,e,n){const i=new w(Et(t,n),16);return ce(i,e,this.toPublicKey())}toPublicKey(){const e=new Z().g.mulCT(this);return new st(e.x,e.y)}toWif(t=[128]){if(!this.isValid())throw new Error("Value is out of field");return hi([...this.toArray("be",32),1],t)}toAddress(t=[0]){return this.toPublicKey().toAddress(t)}toHex(){return super.toHex(32)}toString(t="hex",e=64){return super.toString(t,e)}deriveSharedSecret(t){if(!t.validate())throw new Error("Public key not valid for ECDH secret derivation");return t.mulCT(this)}deriveChild(t,e,n,i){let s;if(typeof i=="function"){const f=i(this,t);typeof f<"u"?s=f:(s=this.deriveSharedSecret(t),typeof n=="function"&&n(this,t,s))}else s=this.deriveSharedSecret(t);const a=x(e,"utf8"),o=ie(s.encode(!0),a),c=new Z;return new et(this.add(new w(o)).mod(c.n).toArray())}toKeyShares(t,e){if(typeof t!="number"||typeof e!="number")throw new Error("threshold and totalShares must be numbers");if(t<2)throw new Error("threshold must be at least 2");if(e<2)throw new Error("totalShares must be at least 2");if(t>e)throw new Error("threshold should be less than or equal to totalShares");const n=Ee.fromPrivateKey(this,t),i=[],s=new Set,a=new Z,o=xt(64);for(let f=0;f<e;f++){let u,h=0;do{const g=[f,h,...xt(32)],p=tr(o,g);if(u=new w(p).umod(a.p),h++,h>5)throw new Error("Failed to generate unique x coordinate after 5 attempts")}while(u.isZero()||s.has(u.toString()));s.add(u.toString());const b=n.valueAt(u);i.push(new Yt(u,b))}const c=this.toPublicKey().toHash("hex").slice(0,8);return new Ae(i,t,c)}toBackupShares(t,e){return this.toKeyShares(t,e).toBackupFormat()}static fromBackupShares(t){return et.fromKeyShares(Ae.fromBackupFormat(t))}static fromKeyShares(t){const{points:e,threshold:n,integrity:i}=t;if(n<2)throw new Error("threshold must be at least 2");if(e.length<n)throw new Error(`At least ${n} shares are required to reconstruct the private key`);for(let c=0;c<n;c++)for(let f=c+1;f<n;f++)if(e[c].x.eq(e[f].x))throw new Error("Duplicate share detected, each must be unique.");const s=new Ee(e,n),a=new et(s.valueAt(new w(0)).toArray());if(a.toPublicKey().toHash("hex").slice(0,8)!==i)throw new Error("Integrity hash mismatch");return a}}const gi=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),Dr=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]].map(r=>new Uint8Array(r)),te=new Uint8Array(256),ee=new Uint8Array(256);for(let r=0;r<256;r++){const t=(r<<1^((r&128)!==0?27:0))&255;te[r]=t,ee[r]=t^r}function Mr(r){for(let t=0;t<4;t++){const e=r[0][t],n=r[1][t],i=r[2][t],s=r[3][t];r[0][t]=te[e]^ee[n]^i^s,r[1][t]=e^te[n]^ee[i]^s,r[2][t]=e^n^te[i]^ee[s],r[3][t]=ee[e]^n^i^te[s]}}function An(r,t,e){for(let n=0;n<4;n++){const i=t[e+n];for(let s=0;s<4;s++)r[s][n]^=i[s]}}function Fr(r){for(let t=0;t<4;t++)for(let e=0;e<4;e++)r[t][e]=gi[r[t][e]]}function Pn(r){for(let t=0;t<4;t++)r[t]=gi[r[t]]}function qr(r){const t=r[0];r[0]=r[1],r[1]=r[2],r[2]=r[3],r[3]=t}function Kr(r){let t=r[1][0];r[1][0]=r[1][1],r[1][1]=r[1][2],r[1][2]=r[1][3],r[1][3]=t,t=r[2][0];const e=r[2][1];r[2][0]=r[2][2],r[2][1]=r[2][3],r[2][2]=t,r[2][3]=e,t=r[3][3],r[3][3]=r[3][2],r[3][2]=r[3][1],r[3][1]=r[3][0],r[3][0]=t}function Wr(r,t){const e=t.length/4,n=[];for(let i=0;i<t.length;i++)i%4===0&&n.push([]),n[i>>2].push(t[i]);for(let i=e;i<4*r;i++){n[i]=[];const s=n[i-1].slice();if(i%e===0){qr(s),Pn(s);const a=Dr[i/e];for(let o=0;o<4;o++)s[o]^=a[o]}else e>6&&i%e===4&&Pn(s);for(let a=0;a<4;a++)n[i][a]=n[i-e][a]^s[a]}return n}function sn(r,t){let e,n,i,s;const a=[[],[],[],[]],o=[],c=Array.from(t);if(c.length===16)s=11;else if(c.length===24)s=13;else if(c.length===32)s=15;else throw new Error("Illegal key length: "+String(c.length));const f=Wr(s,c);for(let u=0;u<4;u++)a[0][u]=r[u*4],a[1][u]=r[u*4+1],a[2][u]=r[u*4+2],a[3][u]=r[u*4+3];for(An(a,f,0),i=1;i<s;i++)Fr(a),Kr(a),i+1<s&&Mr(a),An(a,f,i*4);for(e=0;e<4;e++)for(n=0;n<4;n++)o.push(a[n][e]);return o}const Pe=function(r){if(r<0||r>Number.MAX_SAFE_INTEGER)throw new Error("getBytes64: value out of range");const t=Math.floor(r/4294967296),e=r>>>0;return[t>>>24&255,t>>>16&255,t>>>8&255,t&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255]},wt=function(r){return new Uint8Array(r)},zr=(()=>{const r=new Uint8Array(16);return r[0]=225,r})(),zt=(...r)=>{let t=0;for(const i of r)t+=i.length;const e=new Uint8Array(t);let n=0;for(const i of r)e.set(i,n),n+=i.length;return e},$r=function(r){let t=0,e=0;for(let n=0;n<r.length;n++)e=t,t=r[n]&1,r[n]=r[n]>>1,e!==0&&(r[n]=r[n]|128);return r},Xr=function(r,t){const e=t.slice(),n=wt(16);for(let i=0;i<16;i++){const s=r[i];for(let a=7;a>=0;a--){const c=-(s>>a&1)&255;for(let h=0;h<16;h++)n[h]^=e[h]&c;const u=-(e[15]&1)&255;$r(e);for(let h=0;h<16;h++)e[h]^=zr[h]&u}}return n},an=function(r){const t=r.slice();for(let e=15;e>11&&(t[e]=t[e]+1&255,t[e]===0);e--);return t};function Ne(r,t){let e=wt(16);const n=new Uint8Array(16);for(let i=0;i<r.length;i+=16){n.set(e);for(let s=0;s<16;s++)n[s]^=r[i+s]??0;e=Xr(n,t)}return e}function _e(r,t,e){if(r.length===0)return new Uint8Array(0);const n=new Uint8Array(r.length);let i=t.slice(),s=0;const a=Math.ceil(r.length/16);for(let o=0;o<a;o++){const c=sn(i,e),f=Math.min(16,r.length-s);for(let u=0;u<f;u++)n[s]=r[s]^c[u],s++;o+1<a&&(i=an(i))}return n}function wi(r){const e=r.length*8;let n;r.length===0?n=16:r.length%16===0?n=0:n=16-r.length%16;const i=16+r.length+n+16,s=new Uint8Array(i);let a=0;a+=16,s.set(r,a),a+=r.length,a+=n;const o=Pe(0);s.set(o,a),a+=8;const c=Pe(e);return s.set(c,a),s}function jr(r,t,e){if(t.length===0)throw new Error("Initialization vector must not be empty");if(e.length===0)throw new Error("Key must not be empty");const n=new Uint8Array(sn(wt(16),e));let i;if(t.length===12)i=zt(t,wt(3),new Uint8Array([1]));else{let f=t;f.length%16!==0&&(f=zt(f,wt(16-f.length%16)));const u=Pe(t.length*8),h=zt(f,wt(8),new Uint8Array(u));i=Ne(h,n)}const s=_e(r,an(i),e),a=wi(s),o=Ne(a,n),c=_e(o,i,e);return{result:s,authenticationTag:c}}function Gr(r,t,e,n){if(r.length===0)throw new Error("Cipher text must not be empty");if(t.length===0)throw new Error("Initialization vector must not be empty");if(n.length===0)throw new Error("Key must not be empty");const i=new Uint8Array(sn(wt(16),n));let s;if(t.length===12)s=zt(t,wt(3),new Uint8Array([1]));else{let h=t;h.length%16!==0&&(h=zt(h,wt(16-h.length%16)));const b=Pe(t.length*8),g=zt(h,wt(8),new Uint8Array(b));s=Ne(g,i)}const a=_e(r,an(s),n),o=wi(r),c=Ne(o,i),f=_e(c,s,n);if(f.length!==e.length)return null;let u=0;for(let h=0;h<f.length;h++)u|=f[h]^e[h];return u!==0?null:a}class on extends w{static fromRandom(){return new on(xt(32))}encrypt(t,e){const n=new Uint8Array(xt(32)),i=new Uint8Array(x(t,e)),s=new Uint8Array(this.toArray("be",32)),{result:a,authenticationTag:o}=jr(i,n,s),c=n.length+a.length+o.length,f=new Uint8Array(c);let u=0;return f.set(n,u),u+=n.length,f.set(a,u),u+=a.length,f.set(o,u),ke(Array.from(f),e)}decrypt(t,e){const n=new Uint8Array(x(t,e)),i=32,s=16;if(n.length<i+s)throw new Error("Ciphertext too short");const a=n.slice(0,i),o=n.length-s,c=n.slice(i,o),f=n.slice(o),u=new Uint8Array(this.toArray("be",32)),h=Gr(c,a,f,u);if(h===null)throw new Error("Decryption failed!");return ke(Array.from(h),e)}}const d={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SPLIT:127,OP_NUM2BIN:128,OP_BIN2NUM:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_SUBSTR:179,OP_NOP5:180,OP_LEFT:180,OP_NOP6:181,OP_RIGHT:181,OP_NOP7:182,OP_LSHIFTNUM:182,OP_NOP8:183,OP_RSHIFTNUM:183,OP_NOP9:184,OP_NOP10:185,OP_NOP11:186,OP_NOP12:187,OP_NOP13:188,OP_NOP14:189,OP_NOP15:190,OP_NOP16:191,OP_NOP17:192,OP_NOP18:193,OP_NOP19:194,OP_NOP20:195,OP_NOP21:196,OP_NOP22:197,OP_NOP23:198,OP_NOP24:199,OP_NOP25:200,OP_NOP26:201,OP_NOP27:202,OP_NOP28:203,OP_NOP29:204,OP_NOP30:205,OP_NOP31:206,OP_NOP32:207,OP_NOP33:208,OP_NOP34:209,OP_NOP35:210,OP_NOP36:211,OP_NOP37:212,OP_NOP38:213,OP_NOP39:214,OP_NOP40:215,OP_NOP41:216,OP_NOP42:217,OP_NOP43:218,OP_NOP44:219,OP_NOP45:220,OP_NOP46:221,OP_NOP47:222,OP_NOP48:223,OP_NOP49:224,OP_NOP50:225,OP_NOP51:226,OP_NOP52:227,OP_NOP53:228,OP_NOP54:229,OP_NOP55:230,OP_NOP56:231,OP_NOP57:232,OP_NOP58:233,OP_NOP59:234,OP_NOP60:235,OP_NOP61:236,OP_NOP62:237,OP_NOP63:238,OP_NOP64:239,OP_NOP65:240,OP_NOP66:241,OP_NOP67:242,OP_NOP68:243,OP_NOP69:244,OP_NOP70:245,OP_NOP71:246,OP_NOP72:247,OP_NOP73:248,OP_NOP77:252,OP_SMALLDATA:249,OP_SMALLINTEGER:250,OP_PUBKEYS:251,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};for(const r in d)d[d[r]]=r;const Nn=typeof globalThis<"u"?globalThis.Buffer:void 0;class M{constructor(t=[],e,n,i=!0){l(this,"_chunks");l(this,"parsed");l(this,"rawBytesCache");l(this,"hexCache");this._chunks=t,this.parsed=i,this.rawBytesCache=e,this.hexCache=n}static fromASM(t){const e=[],n=t.split(" ");let i=0;for(;i<n.length;){const s=n[i];let a,o=0;if(s.startsWith("OP_")&&typeof d[s]<"u"&&(a=s,o=d[s]),s==="0")o=0,e.push({op:o}),i=i+1;else if(s==="-1")o=d.OP_1NEGATE,e.push({op:o}),i=i+1;else if(a===void 0){let c=n[i];c.length%2!==0&&(c="0"+c);const f=x(c,"hex");if(ke(f,"hex")!==c)throw new Error("invalid hex string in script");const u=f.length;u>=0&&u<d.OP_PUSHDATA1?o=u:u<Math.pow(2,8)?o=d.OP_PUSHDATA1:u<Math.pow(2,16)?o=d.OP_PUSHDATA2:u<Math.pow(2,32)&&(o=d.OP_PUSHDATA4),e.push({data:f,op:o}),i=i+1}else o===d.OP_PUSHDATA1||o===d.OP_PUSHDATA2||o===d.OP_PUSHDATA4?(e.push({data:x(n[i+2],"hex"),op:o}),i=i+3):(e.push({op:o}),i=i+1)}return new M(e)}static fromHex(t){if(t.length===0)return M.fromBinary([]);if(t.length%2!==0)throw new Error("There is an uneven number of characters in the string which suggests it is not hex encoded.");if(!/^[0-9a-fA-F]+$/.test(t))throw new Error("Some elements in this string are not hex encoded.");const e=x(t,"hex"),n=Uint8Array.from(e);return new M([],n,t.toLowerCase(),!1)}static fromBinary(t){const e=Uint8Array.from(t);return new M([],e,void 0,!1)}get chunks(){return this.ensureParsed(),this._chunks}set chunks(t){this._chunks=t,this.parsed=!0,this.invalidateSerializationCaches()}ensureParsed(){this.parsed||(this.rawBytesCache!=null?this._chunks=M.parseChunks(this.rawBytesCache):this._chunks=[],this.parsed=!0)}toASM(){let t="";for(let e=0;e<this.chunks.length;e++){const n=this.chunks[e];t+=this._chunkToString(n)}return t.slice(1)}toHex(){if(this.hexCache!=null)return this.hexCache;this.rawBytesCache==null&&(this.rawBytesCache=this.serializeChunksToBytes());const t=Nn!=null?Nn.from(this.rawBytesCache).toString("hex"):ke(Array.from(this.rawBytesCache),"hex");return this.hexCache=t,t}toBinary(){return Array.from(this.toUint8Array())}toUint8Array(){return this.rawBytesCache==null&&(this.rawBytesCache=this.serializeChunksToBytes()),this.rawBytesCache}writeScript(t){return this.invalidateSerializationCaches(),this.chunks=this.chunks.concat(t.chunks),this}writeOpCode(t){return this.invalidateSerializationCaches(),this.chunks.push({op:t}),this}setChunkOpCode(t,e){return this.invalidateSerializationCaches(),this.chunks[t]={op:e},this}writeBn(t){if(this.invalidateSerializationCaches(),t.cmpn(0)===d.OP_0)this.chunks.push({op:d.OP_0});else if(t.cmpn(-1)===0)this.chunks.push({op:d.OP_1NEGATE});else if(t.cmpn(1)>=0&&t.cmpn(16)<=0)this.chunks.push({op:t.toNumber()+d.OP_1-1});else{const e=t.toSm("little");this.writeBin(e)}return this}writeBin(t){this.invalidateSerializationCaches();let e;const n=t.length>0?t:void 0;if(t.length>0&&t.length<d.OP_PUSHDATA1)e=t.length;else if(t.length===0)e=d.OP_0;else if(t.length<Math.pow(2,8))e=d.OP_PUSHDATA1;else if(t.length<Math.pow(2,16))e=d.OP_PUSHDATA2;else if(t.length<Math.pow(2,32))e=d.OP_PUSHDATA4;else throw new Error("You can't push that much data");return this.chunks.push({data:n,op:e}),this}writeNumber(t){return this.invalidateSerializationCaches(),this.writeBn(new w(t)),this}removeCodeseparators(){this.invalidateSerializationCaches();const t=[];for(let e=0;e<this.chunks.length;e++)this.chunks[e].op!==d.OP_CODESEPARATOR&&t.push(this.chunks[e]);return this.chunks=t,this}findAndDelete(t){this.invalidateSerializationCaches();const e=t.toUint8Array(),n=e.length;if(n===0)return this;const i=e[0]??0,s=a=>{if(a.op!==i)return!1;const o=a.data??[],c=o.length;if(c===0)return n===1;if(a.op===d.OP_RETURN){if(n!==1+c)return!1;for(let f=0;f<c;f++)if(e[1+f]!==o[f])return!1;return!0}if(a.op<d.OP_PUSHDATA1){if(n!==1+c)return!1;for(let f=0;f<c;f++)if(e[1+f]!==o[f])return!1;return!0}if(a.op===d.OP_PUSHDATA1){if(n!==2+c||e[1]!==(c&255))return!1;for(let f=0;f<c;f++)if(e[2+f]!==o[f])return!1;return!0}if(a.op===d.OP_PUSHDATA2){if(n!==3+c||e[1]!==(c&255)||e[2]!==(c>>8&255))return!1;for(let f=0;f<c;f++)if(e[3+f]!==o[f])return!1;return!0}if(a.op===d.OP_PUSHDATA4){if(n!==5+c)return!1;const f=c>>>0;if(e[1]!==(f&255)||e[2]!==(f>>8&255)||e[3]!==(f>>16&255)||e[4]!==(f>>24&255))return!1;for(let u=0;u<c;u++)if(e[5+u]!==o[u])return!1;return!0}return!1};for(let a=0;a<this.chunks.length;)s(this.chunks[a])?this.chunks.splice(a,1):a++;return this}isPushOnly(){for(let t=0;t<this.chunks.length;t++)if(this.chunks[t].op>d.OP_16)return!1;return!0}isLockingScript(){throw new Error("Not implemented")}isUnlockingScript(){throw new Error("Not implemented")}static computeSerializedLength(t){let e=0;for(const n of t){if(e+=1,n.data==null)continue;const i=n.data.length;if(n.op===d.OP_RETURN){e+=i;break}n.op<d.OP_PUSHDATA1?e+=i:n.op===d.OP_PUSHDATA1?e+=1+i:n.op===d.OP_PUSHDATA2?e+=2+i:n.op===d.OP_PUSHDATA4&&(e+=4+i)}return e}serializeChunksToBytes(){const t=this.chunks,e=M.computeSerializedLength(t),n=new Uint8Array(e);let i=0;for(let s=0;s<t.length;s++){const a=t[s];if(n[i++]=a.op,a.data!=null){if(a.op===d.OP_RETURN){n.set(a.data,i),i+=a.data.length;break}i=M.writeChunkData(n,i,a.op,a.data)}}return n}invalidateSerializationCaches(){this.rawBytesCache=void 0,this.hexCache=void 0}static writeChunkData(t,e,n,i){const s=i.length;if(n<d.OP_PUSHDATA1)return t.set(i,e),e+s;if(n===d.OP_PUSHDATA1)return t[e++]=s&255,t.set(i,e),e+s;if(n===d.OP_PUSHDATA2)return t[e++]=s&255,t[e++]=s>>8&255,t.set(i,e),e+s;if(n===d.OP_PUSHDATA4){const a=s>>>0;return t[e++]=a&255,t[e++]=a>>8&255,t[e++]=a>>16&255,t[e++]=a>>24&255,t.set(i,e),e+s}return e}static parseChunks(t){const e=[],n=t.length;let i=0,s=0;for(;i<n;){const a=t[i++]??0;if(a===d.OP_RETURN&&s===0){e.push({op:a,data:M.copyRange(t,i,n)});break}if(a===d.OP_IF||a===d.OP_NOTIF||a===d.OP_VERIF||a===d.OP_VERNOTIF?s++:a===d.OP_ENDIF&&s--,a>0&&a<d.OP_PUSHDATA1){const c=Math.min(i+a,n);e.push({data:M.copyRange(t,i,c),op:a}),i=c}else if(a===d.OP_PUSHDATA1){const o=i<n?t[i++]??0:0,c=Math.min(i+o,n);e.push({data:M.copyRange(t,i,c),op:a}),i=c}else if(a===d.OP_PUSHDATA2){const o=t[i]??0,c=t[i+1]??0,f=o|c<<8;i=Math.min(i+2,n);const u=Math.min(i+f,n);e.push({data:M.copyRange(t,i,u),op:a}),i=u}else if(a===d.OP_PUSHDATA4){const o=((t[i]??0)|(t[i+1]??0)<<8|(t[i+2]??0)<<16|(t[i+3]??0)<<24)>>>0;i=Math.min(i+4,n);const c=Math.min(i+o,n);e.push({data:M.copyRange(t,i,c),op:a}),i=c}else e.push({op:a})}return e}static copyRange(t,e,n){const i=Math.max(n-e,0),s=new Array(i);for(let a=0;a<i;a++)s[a]=t[e+a]??0;return s}_chunkToString(t){const e=t.op;let n="";if(typeof t.data>"u"){const i=d[e];n=`${n} ${i}`}else n=`${n} ${N(t.data)}`;return n}}const _n=new Uint8Array(0),D=class D extends At{constructor(e,n,i){super(e,n);l(this,"scope");this.scope=i}static formatOTDA(e){const n=(e.scope&D.SIGHASH_ANYONECANPAY)===D.SIGHASH_ANYONECANPAY,i=(e.scope&31)===D.SIGHASH_SINGLE,s=(e.scope&31)===D.SIGHASH_NONE,a=(e.scope&31)===D.SIGHASH_ALL||!i&&!s,o=new M([...e.subscript.chunks]);o.findAndDelete(new M().writeOpCode(d.OP_CODESEPARATOR));const c={sourceTXID:e.sourceTXID,sourceOutputIndex:e.sourceOutputIndex,sequence:e.inputSequence,script:o.toBinary()},f=new B;function u(p){f.writeVarIntNum(p.length);for(const m of p)f.writeReverse(x(m.sourceTXID,"hex")),f.writeUInt32LE(m.sourceOutputIndex),f.writeVarIntNum(m.script.length),f.write(m.script),f.writeUInt32LE(m.sequence)}function h(p){f.writeVarIntNum(p.length);for(const m of p)f.writeUInt64LE(m.satoshis),f.writeVarIntNum(m.script.length),f.write(m.script)}f.writeInt32LE(e.transactionVersion);const b=new M().toBinary();if(n)n&&u([c]);else{const p=e.otherInputs.map(m=>{var y;return{sourceTXID:m.sourceTXID??((y=m.sourceTransaction)==null?void 0:y.id("hex"))??"",sourceOutputIndex:m.sourceOutputIndex,sequence:i||s?0:m.sequence??4294967295,script:b}});p.splice(e.inputIndex,0,c),u(p)}if(a){const p=e.outputs.map(m=>({satoshis:m.satoshis??0,script:m.lockingScript.toBinary()}));h(p)}else if(i){const p=[];for(let y=0;y<e.inputIndex;y++)p.push({satoshis:-1,script:b});const m=e.outputs[e.inputIndex];m!==void 0&&p.push({satoshis:m.satoshis??0,script:m.lockingScript.toBinary()}),h(p)}else s&&h([]);return f.writeUInt32LE(e.lockTime),f.writeUInt32LE(e.scope>>>0),f.toUint8Array()}static formatBip143(e){var y;const n=e.cache,i={sourceTXID:e.sourceTXID,sourceOutputIndex:e.sourceOutputIndex,sequence:e.inputSequence},s=[...e.otherInputs];s.splice(e.inputIndex,0,i);const a=()=>{const k=new B;for(const E of s){if(typeof E.sourceTXID>"u"){if(E.sourceTransaction==null)throw new Error("Missing sourceTransaction for input");k.write(E.sourceTransaction.hash())}else k.writeReverse(x(E.sourceTXID,"hex"));k.writeUInt32LE(E.sourceOutputIndex)}const I=k.toUint8Array();return ct(I)},o=()=>{const k=new B;for(const E of s){const _=E.sequence??4294967295;k.writeUInt32LE(_)}const I=k.toUint8Array();return ct(I)};function c(k){var _,V;const I=new B;if(typeof k>"u")for(const U of e.outputs){const K=U.satoshis??0;I.writeUInt64LE(K);const L=((_=U.lockingScript)==null?void 0:_.toUint8Array())??_n;I.writeVarIntNum(L.length),I.write(L)}else{const U=e.outputs[k];if(U===void 0)throw new Error(`Output at index ${k} does not exist`);const K=U.satoshis??0;I.writeUInt64LE(K);const L=((V=U.lockingScript)==null?void 0:V.toUint8Array())??_n;I.writeVarIntNum(L.length),I.write(L)}const v=I.toUint8Array();return ct(v)}let f=new Array(32).fill(0),u=new Array(32).fill(0),h=new Array(32).fill(0);if((e.scope&D.SIGHASH_ANYONECANPAY)===0&&((n==null?void 0:n.hashPrevouts)!=null?f=n.hashPrevouts:(f=a(),n!=null&&(n.hashPrevouts=f))),(e.scope&D.SIGHASH_ANYONECANPAY)===0&&(e.scope&31)!==D.SIGHASH_SINGLE&&(e.scope&31)!==D.SIGHASH_NONE&&((n==null?void 0:n.hashSequence)!=null?u=n.hashSequence:(u=o(),n!=null&&(n.hashSequence=u))),(e.scope&31)!==D.SIGHASH_SINGLE&&(e.scope&31)!==D.SIGHASH_NONE)(n==null?void 0:n.hashOutputsAll)!=null?h=n.hashOutputsAll:(h=c(),n!=null&&(n.hashOutputsAll=h));else if((e.scope&31)===D.SIGHASH_SINGLE&&e.inputIndex<e.outputs.length){const k=e.inputIndex,I=(y=n==null?void 0:n.hashOutputsSingle)==null?void 0:y.get(k);I!=null?h=I:(h=c(k),n!=null&&(n.hashOutputsSingle==null&&(n.hashOutputsSingle=new Map),n.hashOutputsSingle.set(k,h)))}const b=new B;b.writeInt32LE(e.transactionVersion),b.write(f),b.write(u),b.writeReverse(x(e.sourceTXID,"hex")),b.writeUInt32LE(e.sourceOutputIndex);const g=e.subscript.toUint8Array();b.writeVarIntNum(g.length),b.write(g),b.writeUInt64LE(e.sourceSatoshis);const p=i.sequence;return b.writeUInt32LE(p),b.write(h),b.writeUInt32LE(e.lockTime),b.writeUInt32LE(e.scope>>>0),b.toUint8Array()}static format(e){return Array.from(this.formatBytes(e))}static formatBytes(e){const n=(e.scope&D.SIGHASH_FORKID)!==0,i=e.ignoreChronicle!==!0&&(e.scope&D.SIGHASH_CHRONICLE)!==0;return n&&!i?D.formatBip143(e):!n||n&&i?D.formatOTDA(e):new Uint8Array(0)}static fromChecksigFormat(e){if(e.length===0){const a=new w(1),o=new w(1),c=1;return new D(a,o,c)}const n=e[e.length-1],i=e.slice(0,e.length-1),s=At.fromDER(i);return new D(s.r,s.s,n)}hasLowS(){return!(this.s.ltn(1)||this.s.gt(new w("7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5D576E7357A4501DDFE92F46681B20A0","hex")))}toChecksigFormat(){return[...this.toDER(),this.scope]}};l(D,"SIGHASH_ALL",1),l(D,"SIGHASH_NONE",2),l(D,"SIGHASH_SINGLE",3),l(D,"SIGHASH_CHRONICLE",32),l(D,"SIGHASH_FORKID",64),l(D,"SIGHASH_ANYONECANPAY",128);let rt=D;class Yr{constructor(){l(this,"curve");this.curve=new Z}generateProof(t,e,n,i){const s=et.fromRandom(),a=s.toPublicKey(),o=n.mul(s),c=this.computeChallenge(e,n,i,o,a),f=s.add(c.mul(t)).umod(this.curve.n);return{R:a,SPrime:o,z:f}}verifyProof(t,e,n,i){const{R:s,SPrime:a,z:o}=i,c=this.computeChallenge(t,e,n,a,s),f=this.curve.g.mul(o),u=s.add(t.mul(c));if(!f.eq(u))return!1;const h=e.mul(o),b=a.add(n.mul(c));return!!h.eq(b)}computeChallenge(t,e,n,i,s){const a=[...t.encode(!0),...e.encode(!0),...n.encode(!0),...i.encode(!0),...s.encode(!0)],o=Et(a);return new w(o).umod(this.curve.n)}}BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff");BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551");BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b");BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296");BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5");class we extends M{isLockingScript(){return!0}isUnlockingScript(){return!1}}class je extends M{isLockingScript(){return!1}isUnlockingScript(){return!0}}class Zr extends Error{constructor(e){const n=e.stackState.map(u=>u!=null&&typeof u.length<"u"?N(u):u==null?"null/undef":"INVALID_STACK_ITEM").join(", "),i=e.altStackState.map(u=>u!=null&&typeof u.length<"u"?N(u):u==null?"null/undef":"INVALID_STACK_ITEM").join(", "),s=`Context: ${e.context}, PC: ${e.programCounter}`,a=`Stack: [${n}] (len: ${e.stackState.length}, mem: ${e.stackMem})`,o=`AltStack: [${i}] (len: ${e.altStackState.length}, mem: ${e.altStackMem})`,c=`IfStack: [${e.ifStackState.join(", ")}]`,f=`Script evaluation error: ${e.message}
TXID: ${e.txid}, OutputIdx: ${e.outputIndex}
${s}
${a}
${o}
${c}`;super(f);l(this,"txid");l(this,"outputIndex");l(this,"context");l(this,"programCounter");l(this,"stackState");l(this,"altStackState");l(this,"ifStackState");l(this,"stackMem");l(this,"altStackMem");this.name=this.constructor.name,this.txid=e.txid,this.outputIndex=e.outputIndex,this.context=e.context,this.programCounter=e.programCounter,this.stackState=e.stackState.map(u=>u.slice()),this.altStackState=e.altStackState.map(u=>u.slice()),this.ifStackState=e.ifStackState.slice(),this.stackMem=e.stackMem,this.altStackMem=e.altStackMem}}const qt=1024*1024*1024,mi=Math.pow(2,31)-1,Qr=BigInt(mi),Jr=Object.freeze(new w(-1).toScriptNum()),Tn=Object.freeze(Array.from({length:17},(r,t)=>Object.freeze(new w(t).toScriptNum())));function Bn(r,t){if(r.length!==t.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!==t[e])return!1;return!0}function ts(r,t=Number.MAX_SAFE_INTEGER){return!(r.length>t||r.length>0&&(r[r.length-1]&127)===0&&(r.length<=1||(r[r.length-2]&128)===0))}function es(r){if(r.length<9||r.length>73||r[0]!==48||r[1]!==r.length-3)return!1;const t=r[2],e=r[3];if(t!==2||e===0||5+e>=r.length)return!1;const n=4+e,i=r[n],s=r[n+1];if(i!==2||s===0||(r[4]&128)!==0||e>1&&r[4]===0&&(r[5]&128)===0)return!1;const a=n+2;return!((r[a]&128)!==0||s>1&&r[a]===0&&(r[a+1]&128)===0||e+s+7!==r.length)}function ns(r){const t=r.data,e=r.op;return Array.isArray(t)?t.length===0?e===d.OP_0:t.length===1&&t[0]>=1&&t[0]<=16?e===d.OP_1+(t[0]-1):t.length===1&&t[0]===129?e===d.OP_1NEGATE:t.length<=75?e===t.length:t.length<=255?e===d.OP_PUSHDATA1:t.length<=65535?e===d.OP_PUSHDATA2:!0:!0}class is{constructor(t){l(this,"sourceTXID");l(this,"sourceOutputIndex");l(this,"sourceSatoshis");l(this,"lockingScript");l(this,"transactionVersion");l(this,"otherInputs");l(this,"outputs");l(this,"inputIndex");l(this,"unlockingScript");l(this,"inputSequence");l(this,"lockTime");l(this,"context");l(this,"programCounter");l(this,"lastCodeSeparator");l(this,"stack");l(this,"altStack");l(this,"ifStack");l(this,"memoryLimit");l(this,"stackMem");l(this,"altStackMem");l(this,"isRelaxedOverride");l(this,"sigHashCache");this.sourceTXID=t.sourceTXID,this.sourceOutputIndex=t.sourceOutputIndex,this.sourceSatoshis=t.sourceSatoshis,this.lockingScript=t.lockingScript,this.transactionVersion=t.transactionVersion,this.otherInputs=t.otherInputs,this.outputs=t.outputs,this.inputIndex=t.inputIndex,this.unlockingScript=t.unlockingScript,this.inputSequence=t.inputSequence,this.lockTime=t.lockTime,this.memoryLimit=t.memoryLimit??32e6,this.isRelaxedOverride=t.isRelaxed===!0,this.stack=[],this.altStack=[],this.ifStack=[],this.stackMem=0,this.altStackMem=0,this.sigHashCache={hashOutputsSingle:new Map},this.reset()}isRelaxed(){return this.isRelaxedOverride||this.transactionVersion>1}reset(){this.context="UnlockingScript",this.programCounter=0,this.lastCodeSeparator=null,this.stack=[],this.altStack=[],this.ifStack=[],this.stackMem=0,this.altStackMem=0,this.sigHashCache={hashOutputsSingle:new Map}}ensureStackMem(t){this.stackMem+t>this.memoryLimit&&this.scriptEvaluationError("Stack memory usage has exceeded "+String(this.memoryLimit)+" bytes")}ensureAltStackMem(t){this.altStackMem+t>this.memoryLimit&&this.scriptEvaluationError("Alt stack memory usage has exceeded "+String(this.memoryLimit)+" bytes")}pushStack(t){this.ensureStackMem(t.length),this.stack.push(t),this.stackMem+=t.length}pushStackCopy(t){this.ensureStackMem(t.length);const e=t.slice();this.stack.push(e),this.stackMem+=e.length}popStack(){this.stack.length===0&&this.scriptEvaluationError("Attempted to pop from an empty stack.");const t=this.stack.pop();return this.stackMem-=t.length,t}stackTop(t=-1){return(this.stack.length===0||this.stack.length<Math.abs(t)||t>=0&&t>=this.stack.length)&&this.scriptEvaluationError(`Stack underflow accessing element at index ${t}. Stack length is ${this.stack.length}.`),this.stack[this.stack.length+t]}pushAltStack(t){this.ensureAltStackMem(t.length),this.altStack.push(t),this.altStackMem+=t.length}popAltStack(){this.altStack.length===0&&this.scriptEvaluationError("Attempted to pop from an empty alt stack.");const t=this.altStack.pop();return this.altStackMem-=t.length,t}checkSignatureEncoding(t){if(t.length===0)return!0;if(!es(t))return this.scriptEvaluationError("The signature format is invalid."),!1;try{const e=rt.fromChecksigFormat(t);if(!this.isRelaxed()&&!e.hasLowS())return this.scriptEvaluationError("The signature must have a low S value."),!1}catch{return this.scriptEvaluationError("The signature format is invalid."),!1}return!0}checkPublicKeyEncoding(t){if(t.length===0)return this.scriptEvaluationError("Public key is empty."),!1;if(t.length<33)return this.scriptEvaluationError("The public key is too short, it must be at least 33 bytes."),!1;if(t[0]===4){if(t.length!==65)return this.scriptEvaluationError("The non-compressed public key must be 65 bytes."),!1}else if(t[0]===2||t[0]===3){if(t.length!==33)return this.scriptEvaluationError("The compressed public key must be 33 bytes."),!1}else return this.scriptEvaluationError("The public key is in an unknown format."),!1;try{st.fromDER(t)}catch{return this.scriptEvaluationError("The public key is in an unknown format."),!1}return!0}verifySignature(t,e,n){const i=rt.formatBytes({sourceTXID:this.sourceTXID,sourceOutputIndex:this.sourceOutputIndex,sourceSatoshis:this.sourceSatoshis,transactionVersion:this.transactionVersion,otherInputs:this.otherInputs,outputs:this.outputs,inputIndex:this.inputIndex,subscript:n,inputSequence:this.inputSequence,lockTime:this.lockTime,scope:t.scope,cache:this.sigHashCache}),s=new w(ct(i));return ce(s,t,e)}step(){if(this.stackMem>this.memoryLimit)return this.scriptEvaluationError("Stack memory usage has exceeded "+String(this.memoryLimit)+" bytes"),!1;if(this.altStackMem>this.memoryLimit)return this.scriptEvaluationError("Alt stack memory usage has exceeded "+String(this.memoryLimit)+" bytes"),!1;this.context==="UnlockingScript"&&this.programCounter>=this.unlockingScript.chunks.length&&(this.context="LockingScript",this.programCounter=0);const t=this.context==="UnlockingScript"?this.unlockingScript:this.lockingScript;if(this.programCounter>=t.chunks.length)return!1;const e=t.chunks[this.programCounter],n=e.op;typeof n>"u"&&this.scriptEvaluationError(`Missing opcode in ${this.context} at pc=${this.programCounter}.`),Array.isArray(e.data)&&e.data.length>qt&&this.scriptEvaluationError(`Data push > ${qt} bytes (pc=${this.programCounter}).`);const i=!this.ifStack.includes(!1);if(i&&n>=0&&n<=d.OP_PUSHDATA4)!this.isRelaxed()&&!ns(e)&&this.scriptEvaluationError(`This data is not minimally-encoded. (PC: ${this.programCounter})`),this.pushStack(Array.isArray(e.data)?e.data:[]);else if(i||n>=d.OP_IF&&n<=d.OP_ENDIF){let s,a,o,c,f,u,h,b,g,p,m,y,k,I,v,E,_,V,U,K,L,W,Q,G,$,at;switch(n){case d.OP_VER:this.pushStackCopy(new w(this.transactionVersion).toScriptNum());break;case d.OP_SUBSTR:{this.stack.length<3&&this.scriptEvaluationError("OP_SUBSTR requires at least three items to be on the stack.");const O=w.fromScriptNum(this.popStack(),!this.isRelaxed()).toNumber(),S=w.fromScriptNum(this.popStack(),!this.isRelaxed()).toNumber();s=this.popStack();const R=s.length;(S<0||S>=R||O<0||O>R-S)&&this.scriptEvaluationError(`OP_SUBSTR offset (${S}) must be in range [0, ${R}) and length (${O}) must be in range [0, ${R-S}]`),this.pushStack(s.slice(S,S+O));break}case d.OP_LEFT:{this.stack.length<2&&this.scriptEvaluationError("OP_LEFT requires at least two items to be on the stack.");const O=w.fromScriptNum(this.popStack(),!this.isRelaxed()).toNumber();s=this.popStack();const S=s.length;(O<0||O>S)&&this.scriptEvaluationError(`OP_LEFT length (${O}) must be in range [0, ${S}]`),this.pushStack(s.slice(0,O));break}case d.OP_RIGHT:{this.stack.length<2&&this.scriptEvaluationError("OP_RIGHT requires at least two items to be on the stack.");const O=w.fromScriptNum(this.popStack(),!this.isRelaxed()).toNumber();s=this.popStack();const S=s.length;(O<0||O>S)&&this.scriptEvaluationError(`OP_RIGHT length (${O}) must be in range [0, ${S}]`),this.pushStack(s.slice(S-O,O));break}case d.OP_LSHIFTNUM:{this.stack.length<2&&this.scriptEvaluationError("OP_LSHIFTNUM requires at least two items to be on the stack.");const O=w.fromScriptNum(this.popStack(),!this.isRelaxed()).toBigInt();O<0&&this.scriptEvaluationError("OP_LSHIFTNUM bits to shift must not be negative.");const S=w.fromScriptNum(this.popStack(),!this.isRelaxed()).toBigInt(),R=new w(S<<O);this.pushStack(R.toScriptNum());break}case d.OP_RSHIFTNUM:{this.stack.length<2&&this.scriptEvaluationError("OP_RSHIFTNUM requires at least two items to be on the stack.");const O=w.fromScriptNum(this.popStack(),!this.isRelaxed()).toBigInt();O<0&&this.scriptEvaluationError("OP_RSHIFTNUM bits to shift must not be negative.");const S=w.fromScriptNum(this.popStack(),!this.isRelaxed()).toBigInt();let R;S<0?R=new w(-(-S>>O)):R=new w(S>>O),this.pushStack(R.toScriptNum());break}case d.OP_1NEGATE:this.pushStackCopy(Jr);break;case d.OP_0:this.pushStackCopy(Tn[0]);break;case d.OP_1:case d.OP_2:case d.OP_3:case d.OP_4:case d.OP_5:case d.OP_6:case d.OP_7:case d.OP_8:case d.OP_9:case d.OP_10:case d.OP_11:case d.OP_12:case d.OP_13:case d.OP_14:case d.OP_15:case d.OP_16:y=n-(d.OP_1-1),this.pushStackCopy(Tn[y]);break;case d.OP_NOP:case d.OP_NOP1:case d.OP_NOP2:case d.OP_NOP3:case d.OP_NOP7:case d.OP_NOP8:case d.OP_NOP9:case d.OP_NOP10:case d.OP_NOP11:case d.OP_NOP12:case d.OP_NOP13:case d.OP_NOP14:case d.OP_NOP15:case d.OP_NOP16:case d.OP_NOP17:case d.OP_NOP18:case d.OP_NOP19:case d.OP_NOP20:case d.OP_NOP21:case d.OP_NOP22:case d.OP_NOP23:case d.OP_NOP24:case d.OP_NOP25:case d.OP_NOP26:case d.OP_NOP27:case d.OP_NOP28:case d.OP_NOP29:case d.OP_NOP30:case d.OP_NOP31:case d.OP_NOP32:case d.OP_NOP33:case d.OP_NOP34:case d.OP_NOP35:case d.OP_NOP36:case d.OP_NOP37:case d.OP_NOP38:case d.OP_NOP39:case d.OP_NOP40:case d.OP_NOP41:case d.OP_NOP42:case d.OP_NOP43:case d.OP_NOP44:case d.OP_NOP45:case d.OP_NOP46:case d.OP_NOP47:case d.OP_NOP48:case d.OP_NOP49:case d.OP_NOP50:case d.OP_NOP51:case d.OP_NOP52:case d.OP_NOP53:case d.OP_NOP54:case d.OP_NOP55:case d.OP_NOP56:case d.OP_NOP57:case d.OP_NOP58:case d.OP_NOP59:case d.OP_NOP60:case d.OP_NOP61:case d.OP_NOP62:case d.OP_NOP63:case d.OP_NOP64:case d.OP_NOP65:case d.OP_NOP66:case d.OP_NOP67:case d.OP_NOP68:case d.OP_NOP69:case d.OP_NOP70:case d.OP_NOP71:case d.OP_NOP72:case d.OP_NOP73:case d.OP_NOP77:break;case d.OP_VERIF:case d.OP_VERNOTIF:I=!1,i&&(this.stack.length<1&&this.scriptEvaluationError("OP_VERIF and OP_VERNOTIF require at least one item on the stack when they are used!"),o=new w(this.transactionVersion).toScriptNum(),a=this.popStack(),I=Bn(a,o),n===d.OP_VERNOTIF&&(I=!I)),this.ifStack.push(I);break;case d.OP_IF:case d.OP_NOTIF:I=!1,i&&(this.stack.length<1&&this.scriptEvaluationError("OP_IF and OP_NOTIF require at least one item on the stack when they are used!"),s=this.popStack(),I=this.castToBool(s),n===d.OP_NOTIF&&(I=!I)),this.ifStack.push(I);break;case d.OP_ELSE:this.ifStack.length===0&&this.scriptEvaluationError("OP_ELSE requires a preceeding OP_IF."),this.ifStack[this.ifStack.length-1]=!this.ifStack[this.ifStack.length-1];break;case d.OP_ENDIF:this.ifStack.length===0&&this.scriptEvaluationError("OP_ENDIF requires a preceeding OP_IF."),this.ifStack.pop();break;case d.OP_VERIFY:this.stack.length<1&&this.scriptEvaluationError("OP_VERIFY requires at least one item to be on the stack."),a=this.stackTop(),I=this.castToBool(a),I||this.scriptEvaluationError("OP_VERIFY requires the top stack value to be truthy."),this.popStack();break;case d.OP_RETURN:this.context==="UnlockingScript"?this.programCounter=this.unlockingScript.chunks.length:this.programCounter=this.lockingScript.chunks.length,this.ifStack=[],this.programCounter--;break;case d.OP_TOALTSTACK:this.stack.length<1&&this.scriptEvaluationError("OP_TOALTSTACK requires at oeast one item to be on the stack."),this.pushAltStack(this.popStack());break;case d.OP_FROMALTSTACK:this.altStack.length<1&&this.scriptEvaluationError("OP_FROMALTSTACK requires at least one item to be on the stack."),this.pushStack(this.popAltStack());break;case d.OP_2DROP:this.stack.length<2&&this.scriptEvaluationError("OP_2DROP requires at least two items to be on the stack."),this.popStack(),this.popStack();break;case d.OP_2DUP:this.stack.length<2&&this.scriptEvaluationError("OP_2DUP requires at least two items to be on the stack."),a=this.stackTop(-2),o=this.stackTop(-1),this.pushStackCopy(a),this.pushStackCopy(o);break;case d.OP_3DUP:this.stack.length<3&&this.scriptEvaluationError("OP_3DUP requires at least three items to be on the stack."),a=this.stackTop(-3),o=this.stackTop(-2),c=this.stackTop(-1),this.pushStackCopy(a),this.pushStackCopy(o),this.pushStackCopy(c);break;case d.OP_2OVER:this.stack.length<4&&this.scriptEvaluationError("OP_2OVER requires at least four items to be on the stack."),a=this.stackTop(-4),o=this.stackTop(-3),this.pushStackCopy(a),this.pushStackCopy(o);break;case d.OP_2ROT:{this.stack.length<6&&this.scriptEvaluationError("OP_2ROT requires at least six items to be on the stack.");const O=this.popStack(),S=this.popStack(),R=this.popStack(),X=this.popStack(),it=this.popStack(),Dt=this.popStack();this.pushStack(X),this.pushStack(R),this.pushStack(S),this.pushStack(O),this.pushStack(Dt),this.pushStack(it);break}case d.OP_2SWAP:{this.stack.length<4&&this.scriptEvaluationError("OP_2SWAP requires at least four items to be on the stack.");const O=this.popStack(),S=this.popStack(),R=this.popStack(),X=this.popStack();this.pushStack(S),this.pushStack(O),this.pushStack(X),this.pushStack(R);break}case d.OP_IFDUP:this.stack.length<1&&this.scriptEvaluationError("OP_IFDUP requires at least one item to be on the stack."),a=this.stackTop(),this.castToBool(a)&&this.pushStackCopy(a);break;case d.OP_DEPTH:this.pushStack(new w(this.stack.length).toScriptNum());break;case d.OP_DROP:this.stack.length<1&&this.scriptEvaluationError("OP_DROP requires at least one item to be on the stack."),this.popStack();break;case d.OP_DUP:this.stack.length<1&&this.scriptEvaluationError("OP_DUP requires at least one item to be on the stack."),this.pushStackCopy(this.stackTop());break;case d.OP_NIP:this.stack.length<2&&this.scriptEvaluationError("OP_NIP requires at least two items to be on the stack."),o=this.popStack(),this.popStack(),this.pushStack(o);break;case d.OP_OVER:this.stack.length<2&&this.scriptEvaluationError("OP_OVER requires at least two items to be on the stack."),this.pushStackCopy(this.stackTop(-2));break;case d.OP_PICK:case d.OP_ROLL:{this.stack.length<2&&this.scriptEvaluationError(`${d[n]} requires at least two items to be on the stack.`),b=w.fromScriptNum(this.popStack(),!this.isRelaxed());const O=b.toBigInt();(O<0n||O>=BigInt(this.stack.length))&&this.scriptEvaluationError(`${d[n]} requires the top stack element to be 0 or a positive number less than the current size of the stack.`);const S=Number(O),R=this.stack[this.stack.length-1-S];n===d.OP_ROLL?(this.stack.splice(this.stack.length-1-S,1),this.stackMem-=R.length,this.pushStack(R)):this.pushStackCopy(R);break}case d.OP_ROT:this.stack.length<3&&this.scriptEvaluationError("OP_ROT requires at least three items to be on the stack."),h=this.popStack(),u=this.popStack(),f=this.popStack(),this.pushStack(u),this.pushStack(h),this.pushStack(f);break;case d.OP_SWAP:this.stack.length<2&&this.scriptEvaluationError("OP_SWAP requires at least two items to be on the stack."),u=this.popStack(),f=this.popStack(),this.pushStack(u),this.pushStack(f);break;case d.OP_TUCK:this.stack.length<2&&this.scriptEvaluationError("OP_TUCK requires at least two items to be on the stack."),a=this.stackTop(-1),this.ensureStackMem(a.length),this.stack.splice(this.stack.length-2,0,a.slice()),this.stackMem+=a.length;break;case d.OP_SIZE:this.stack.length<1&&this.scriptEvaluationError("OP_SIZE requires at least one item to be on the stack."),this.pushStack(new w(this.stackTop().length).toScriptNum());break;case d.OP_AND:case d.OP_OR:case d.OP_XOR:{this.stack.length<2&&this.scriptEvaluationError(`${d[n]} requires at least two items on the stack.`),o=this.popStack(),a=this.popStack(),a.length!==o.length&&this.scriptEvaluationError(`${d[n]} requires the top two stack items to be the same size.`);const O=new Array(a.length);for(let S=0;S<a.length;S++)n===d.OP_AND?O[S]=a[S]&o[S]:n===d.OP_OR?O[S]=a[S]|o[S]:O[S]=a[S]^o[S];this.pushStack(O);break}case d.OP_INVERT:{this.stack.length<1&&this.scriptEvaluationError("OP_INVERT requires at least one item to be on the stack."),s=this.popStack();const O=new Array(s.length);for(let S=0;S<s.length;S++)O[S]=~s[S]&255;this.pushStack(O);break}case d.OP_LSHIFT:case d.OP_RSHIFT:{this.stack.length<2&&this.scriptEvaluationError(`${d[n]} requires at least two items to be on the stack.`),p=w.fromScriptNum(this.popStack(),!this.isRelaxed()),a=this.popStack();const O=p.toBigInt();if(O<0n&&this.scriptEvaluationError(`${d[n]} requires the top item on the stack not to be negative.`),a.length===0){this.pushStack([]);break}g=new w(a);let S;n===d.OP_LSHIFT?S=g.ushln(O):S=g.ushrn(O);const R=S.toArray("be",a.length);this.pushStack(R);break}case d.OP_EQUAL:case d.OP_EQUALVERIFY:this.stack.length<2&&this.scriptEvaluationError(`${d[n]} requires at least two items to be on the stack.`),o=this.popStack(),a=this.popStack(),I=Bn(a,o),this.pushStack(I?[1]:[]),n===d.OP_EQUALVERIFY&&(I||this.scriptEvaluationError("OP_EQUALVERIFY requires the top two stack items to be equal."),this.popStack());break;case d.OP_1ADD:case d.OP_1SUB:case d.OP_2MUL:case d.OP_2DIV:case d.OP_NEGATE:case d.OP_ABS:case d.OP_NOT:case d.OP_0NOTEQUAL:switch(this.stack.length<1&&this.scriptEvaluationError(`${d[n]} requires at least one item to be on the stack.`),b=w.fromScriptNum(this.popStack(),!this.isRelaxed()),n){case d.OP_1ADD:b=b.add(new w(1));break;case d.OP_1SUB:b=b.sub(new w(1));break;case d.OP_2MUL:b=b.mul(new w(2));break;case d.OP_2DIV:b=b.div(new w(2));break;case d.OP_NEGATE:b=b.neg();break;case d.OP_ABS:b.isNeg()&&(b=b.neg());break;case d.OP_NOT:b=new w(b.cmpn(0)===0?1:0);break;case d.OP_0NOTEQUAL:b=new w(b.cmpn(0)!==0?1:0);break}this.pushStack(b.toScriptNum());break;case d.OP_ADD:case d.OP_SUB:case d.OP_MUL:case d.OP_DIV:case d.OP_MOD:case d.OP_BOOLAND:case d.OP_BOOLOR:case d.OP_NUMEQUAL:case d.OP_NUMEQUALVERIFY:case d.OP_NUMNOTEQUAL:case d.OP_LESSTHAN:case d.OP_GREATERTHAN:case d.OP_LESSTHANOREQUAL:case d.OP_GREATERTHANOREQUAL:case d.OP_MIN:case d.OP_MAX:{this.stack.length<2&&this.scriptEvaluationError(`${d[n]} requires at least two items to be on the stack.`),o=this.popStack(),a=this.popStack(),p=w.fromScriptNum(o,!this.isRelaxed()),g=w.fromScriptNum(a,!this.isRelaxed());let O=0;switch(n){case d.OP_MUL:O=g.byteLength()+p.byteLength();break;case d.OP_ADD:case d.OP_SUB:O=Math.max(g.byteLength(),p.byteLength())+1;break;default:O=Math.max(g.byteLength(),p.byteLength())}this.ensureStackMem(O);let S=new w(0);switch(n){case d.OP_ADD:S=g.add(p);break;case d.OP_SUB:S=g.sub(p);break;case d.OP_MUL:S=g.mul(p);break;case d.OP_DIV:p.cmpn(0)===0&&this.scriptEvaluationError("OP_DIV cannot divide by zero!"),S=g.div(p);break;case d.OP_MOD:p.cmpn(0)===0&&this.scriptEvaluationError("OP_MOD cannot divide by zero!"),S=g.mod(p);break;case d.OP_BOOLAND:S=new w(g.cmpn(0)!==0&&p.cmpn(0)!==0?1:0);break;case d.OP_BOOLOR:S=new w(g.cmpn(0)!==0||p.cmpn(0)!==0?1:0);break;case d.OP_NUMEQUAL:S=new w(g.cmp(p)===0?1:0);break;case d.OP_NUMEQUALVERIFY:S=new w(g.cmp(p)===0?1:0);break;case d.OP_NUMNOTEQUAL:S=new w(g.cmp(p)!==0?1:0);break;case d.OP_LESSTHAN:S=new w(g.cmp(p)<0?1:0);break;case d.OP_GREATERTHAN:S=new w(g.cmp(p)>0?1:0);break;case d.OP_LESSTHANOREQUAL:S=new w(g.cmp(p)<=0?1:0);break;case d.OP_GREATERTHANOREQUAL:S=new w(g.cmp(p)>=0?1:0);break;case d.OP_MIN:S=g.cmp(p)<0?g:p;break;case d.OP_MAX:S=g.cmp(p)>0?g:p;break}this.pushStack(S.toScriptNum()),n===d.OP_NUMEQUALVERIFY&&(this.castToBool(this.stackTop())||this.scriptEvaluationError("OP_NUMEQUALVERIFY requires the top stack item to be truthy."),this.popStack());break}case d.OP_WITHIN:this.stack.length<3&&this.scriptEvaluationError("OP_WITHIN requires at least three items to be on the stack."),m=w.fromScriptNum(this.popStack(),!this.isRelaxed()),p=w.fromScriptNum(this.popStack(),!this.isRelaxed()),g=w.fromScriptNum(this.popStack(),!this.isRelaxed()),I=g.cmp(p)>=0&&g.cmp(m)<0,this.pushStack(I?[1]:[]);break;case d.OP_RIPEMD160:case d.OP_SHA1:case d.OP_SHA256:case d.OP_HASH160:case d.OP_HASH256:{this.stack.length<1&&this.scriptEvaluationError(`${d[n]} requires at least one item to be on the stack.`),s=this.popStack();let O=[];n===d.OP_RIPEMD160?O=Qi(s):n===d.OP_SHA1?O=Ji(s):n===d.OP_SHA256?O=Et(s):n===d.OP_HASH160?O=ni(s):n===d.OP_HASH256&&(O=ct(s)),this.pushStack(O);break}case d.OP_CODESEPARATOR:this.lastCodeSeparator=this.programCounter;break;case d.OP_CHECKSIG:case d.OP_CHECKSIGVERIFY:{if(this.stack.length<2&&this.scriptEvaluationError(`${d[n]} requires at least two items to be on the stack.`),V=this.popStack(),_=this.popStack(),(!this.checkSignatureEncoding(_)||!this.checkPublicKeyEncoding(V))&&this.scriptEvaluationError(`${d[n]} requires correct encoding for the public key and signature.`),v=!1,_.length>0)try{U=rt.fromChecksigFormat(_);const S=(this.context==="UnlockingScript"?this.unlockingScript:this.lockingScript).chunks.slice(this.lastCodeSeparator===null?0:this.lastCodeSeparator+1);E=new M(S),E.findAndDelete(new M().writeBin(_)),K=st.fromDER(V),v=this.verifySignature(U,K,E)}catch{v=!1}this.pushStack(v?[1]:[]),n===d.OP_CHECKSIGVERIFY&&(v||this.scriptEvaluationError("OP_CHECKSIGVERIFY requires that a valid signature is provided."),this.popStack());break}case d.OP_CHECKMULTISIG:case d.OP_CHECKMULTISIGVERIFY:{L=1,this.stack.length<L&&this.scriptEvaluationError(`${d[n]} requires at least 1 item for nKeys.`);const S=w.fromScriptNum(this.stackTop(-L),!this.isRelaxed()).toBigInt();(S<0n||S>Qr)&&this.scriptEvaluationError(`${d[n]} requires a key count between 0 and ${mi}.`),G=Number(S);const R=G;W=++L,L+=G,this.stack.length<L&&this.scriptEvaluationError(`${d[n]} stack too small for nKeys and keys. Need ${L}, have ${this.stack.length}.`);const it=w.fromScriptNum(this.stackTop(-L),!this.isRelaxed()).toBigInt();(it<0n||it>BigInt(G))&&this.scriptEvaluationError(`${d[n]} requires the number of signatures to be no greater than the number of keys.`),$=Number(it);const Dt=$;Q=++L,L+=$,this.stack.length<L&&this.scriptEvaluationError(`${d[n]} stack too small for N, keys, M, sigs, and dummy. Need ${L}, have ${this.stack.length}.`);const bt=(this.context==="UnlockingScript"?this.unlockingScript:this.lockingScript).chunks.slice(this.lastCodeSeparator===null?0:this.lastCodeSeparator+1);E=new M(bt);for(let de=0;de<$;de++)_=this.stackTop(-Q-de),E.findAndDelete(new M().writeBin(_));for(v=!0;v&&$>0;){if(G===0){v=!1;break}if(_=this.stackTop(-Q),V=this.stackTop(-W),(!this.checkSignatureEncoding(_)||!this.checkPublicKeyEncoding(V))&&this.scriptEvaluationError(`${d[n]} requires correct encoding for the public key and signature.`),at=!1,_.length>0)try{U=rt.fromChecksigFormat(_),K=st.fromDER(V),at=this.verifySignature(U,K,E)}catch{at=!1}at&&(Q++,$--),W++,G--,$>G&&(v=!1)}let he=1+R+1+Dt+1-1;for(;he>0;)this.popStack(),he--;this.stack.length<1&&this.scriptEvaluationError(`${d[n]} requires an extra item (dummy) to be on the stack.`);const Oi=this.popStack();!this.isRelaxed()&&Oi.length>0&&this.scriptEvaluationError(`${d[n]} requires the extra stack item (dummy) to be empty.`),this.pushStack(v?[1]:[]),n===d.OP_CHECKMULTISIGVERIFY&&(v||this.scriptEvaluationError("OP_CHECKMULTISIGVERIFY requires that a sufficient number of valid signatures are provided."),this.popStack());break}case d.OP_CAT:{this.stack.length<2&&this.scriptEvaluationError("OP_CAT requires at least two items to be on the stack."),o=this.popStack(),a=this.popStack();const O=a.concat(o);O.length>qt&&this.scriptEvaluationError(`It's not currently possible to push data larger than ${qt} bytes.`),this.pushStack(O);break}case d.OP_SPLIT:{this.stack.length<2&&this.scriptEvaluationError("OP_SPLIT requires at least two items to be on the stack.");const O=this.popStack(),S=this.popStack(),R=w.fromScriptNum(O,!this.isRelaxed()).toBigInt();(R<0n||R>BigInt(S.length))&&this.scriptEvaluationError("OP_SPLIT requires the first stack item to be a non-negative number less than or equal to the size of the second-from-top stack item.");const X=Number(R);this.pushStack(S.slice(0,X)),this.pushStack(S.slice(X));break}case d.OP_NUM2BIN:{this.stack.length<2&&this.scriptEvaluationError("OP_NUM2BIN requires at least two items to be on the stack.");const O=w.fromScriptNum(this.popStack(),!this.isRelaxed()).toBigInt();(O>BigInt(qt)||O<0n)&&this.scriptEvaluationError(`It's not currently possible to push data larger than ${qt} bytes or negative size.`),k=Number(O);let S=this.popStack();if(S=In(S),S.length>k&&this.scriptEvaluationError("OP_NUM2BIN requires that the size expressed in the top stack item is large enough to hold the value expressed in the second-from-top stack item."),S.length===k){this.pushStack(S);break}const R=new Array(k).fill(0);let X=0;S.length>0&&(X=S[S.length-1]&128,S[S.length-1]&=127);for(let it=0;it<S.length;it++)R[it]=S[it];X!==0&&(R[k-1]|=128),this.pushStack(R);break}case d.OP_BIN2NUM:{this.stack.length<1&&this.scriptEvaluationError("OP_BIN2NUM requires at least one item to be on the stack."),a=this.popStack();const O=In(a);ts(O)||this.scriptEvaluationError("OP_BIN2NUM requires that the resulting number is valid."),this.pushStack(O);break}default:this.scriptEvaluationError(`Invalid opcode ${n} (pc=${this.programCounter}).`)}}return this.programCounter++,!0}validate(){for(!this.isRelaxed()&&!this.unlockingScript.isPushOnly()&&this.scriptEvaluationError("Unlocking scripts can only contain push operations, and no other opcodes.");this.step()&&!(this.context==="LockingScript"&&this.programCounter>=this.lockingScript.chunks.length););return this.ifStack.length>0&&this.scriptEvaluationError("Every OP_IF, OP_NOTIF, or OP_ELSE must be terminated with OP_ENDIF prior to the end of the script."),this.isRelaxed()||this.stack.length!==1&&this.scriptEvaluationError(`The clean stack rule requires exactly one item to be on the stack after script execution, found ${this.stack.length}.`),this.stack.length===0?this.scriptEvaluationError("The top stack element must be truthy after script evaluation (stack is empty)."):this.castToBool(this.stackTop())||this.scriptEvaluationError("The top stack element must be truthy after script evaluation."),!0}castToBool(t){if(t.length===0)return!1;for(let e=0;e<t.length;e++)if(t[e]!==0)return!(e===t.length-1&&t[e]===128);return!1}scriptEvaluationError(t){throw new Zr({message:t,txid:this.sourceTXID,outputIndex:this.sourceOutputIndex,context:this.context,programCounter:this.programCounter,stackState:this.stack,altStackState:this.altStack,ifStackState:this.ifStack,stackMem:this.stackMem,altStackMem:this.altStackMem})}}class rs{lock(t){let e;if(typeof t=="string"){const n=di(t);if(n.prefix[0]!==0&&n.prefix[0]!==111)throw new Error("only P2PKH is supported");e=n.data}else e=t;if(e.length!==20)throw new Error("P2PKH hash length must be 20 bytes");return new we([{op:d.OP_DUP},{op:d.OP_HASH160},{op:e.length,data:e},{op:d.OP_EQUALVERIFY},{op:d.OP_CHECKSIG}])}unlock(t,e="all",n=!1,i,s){return{sign:async(a,o)=>{var k,I,v;let c=rt.SIGHASH_FORKID;e==="all"&&(c|=rt.SIGHASH_ALL),e==="none"&&(c|=rt.SIGHASH_NONE),e==="single"&&(c|=rt.SIGHASH_SINGLE),n&&(c|=rt.SIGHASH_ANYONECANPAY);const f=a.inputs[o],u=a.inputs.filter((E,_)=>_!==o),h=f.sourceTXID??((k=f.sourceTransaction)==null?void 0:k.id("hex"));if(h==null||h===void 0)throw new Error("The input sourceTXID or sourceTransaction is required for transaction signing.");if(h==="")throw new Error("The input sourceTXID or sourceTransaction is required for transaction signing.");if(i||(i=(I=f.sourceTransaction)==null?void 0:I.outputs[f.sourceOutputIndex].satoshis),i==null||i===void 0)throw new Error("The sourceSatoshis or input sourceTransaction is required for transaction signing.");if(s||(s=(v=f.sourceTransaction)==null?void 0:v.outputs[f.sourceOutputIndex].lockingScript),s==null)throw new Error("The lockingScript or input sourceTransaction is required for transaction signing.");const b=rt.format({sourceTXID:h,sourceOutputIndex:ve(f.sourceOutputIndex,"input.sourceOutputIndex must have value"),sourceSatoshis:i,transactionVersion:a.version,otherInputs:u,inputIndex:o,outputs:a.outputs,inputSequence:ve(f.sequence,"input.sequence must have value"),subscript:s,lockTime:a.lockTime,scope:c}),g=t.sign(Et(b)),m=new rt(g.r,g.s,c).toChecksigFormat(),y=t.toPublicKey().encode(!0);return new je([{op:m.length,data:m},{op:y.length,data:y}])},estimateLength:async()=>108}}}class ss{constructor(t){l(this,"value");this.value=t}async computeFee(t){const e=s=>s>4294967296?9:s>65536?5:s>253?3:1;let n=4;n+=e(t.inputs.length);for(let s=0;s<t.inputs.length;s++){const a=t.inputs[s];n+=40;let o;if(typeof a.unlockingScript=="object")o=a.unlockingScript.toBinary().length;else if(typeof a.unlockingScriptTemplate=="object")o=await a.unlockingScriptTemplate.estimateLength(t,s);else throw new Error("All inputs must have an unlocking script or an unlocking script template for sat/kb fee computation.");n+=e(o),n+=o}n+=e(t.outputs.length);for(const s of t.outputs){n+=8;const a=s.lockingScript.toBinary().length;n+=e(a),n+=a}return n+=4,Math.ceil(n/1e3*this.value)}}const kt=class kt extends ss{constructor(e=300*1e3){super(100);l(this,"cachedRate",null);l(this,"cacheTimestamp",0);l(this,"cacheValidityMs");this.cacheValidityMs=e}static getInstance(e=300*1e3){return kt.instance||(kt.instance=new kt(e)),kt.instance}async fetchFeeRate(){var n;const e=Date.now();if(this.cachedRate!==null&&e-this.cacheTimestamp<this.cacheValidityMs)return this.cachedRate;try{const i=await fetch(kt.ARC_POLICY_URL);if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const s=await i.json();if(!((n=s.policy)!=null&&n.miningFee)||typeof s.policy.miningFee.satoshis!="number"||typeof s.policy.miningFee.bytes!="number")throw new Error("Invalid policy response format");const a=s.policy.miningFee.satoshis/s.policy.miningFee.bytes*1e3;return this.cachedRate=a,this.cacheTimestamp=e,a}catch(i){return this.cachedRate!==null?(console.warn("Failed to fetch live fee rate, using cached value:",i),this.cachedRate):(console.warn("Failed to fetch live fee rate, using default 100 sat/kb:",i),100)}}async computeFee(e){const n=await this.fetchFeeRate();return this.value=n,super.computeFee(e)}};l(kt,"ARC_POLICY_URL","https://arc.gorillapool.io/v1/policy"),l(kt,"instance",null);let Ge=kt;class as{constructor(t){l(this,"https");this.https=t}async request(t,e){return await new Promise((n,i)=>{const s=this.https.request(t,e,a=>{let o="";a.on("data",c=>{o+=c}),a.on("end",()=>{const c=a.statusCode>=200&&a.statusCode<=299,f=a.headers["content-type"],u=o!==""&&typeof f=="string"&&f.startsWith("application/json")?JSON.parse(o):o;n({status:a.statusCode,statusText:a.statusMessage,ok:c,data:u})})});s.on("error",a=>{i(a)}),e.data!==null&&e.data!==void 0&&s.write(JSON.stringify(e.data)),s.end()})}}class os{constructor(t){l(this,"fetch");this.fetch=t}async request(t,e){const n={method:e.method,headers:e.headers,body:JSON.stringify(e.data)},i=await this.fetch(t,n),s=i.headers.get("Content-Type"),a=(s==null?void 0:s.startsWith("application/json"))??!1?await i.json():await i.text();return{ok:i.ok,status:i.status,statusText:i.statusText,data:a}}}function Ye(){const r={async request(...t){throw new Error("No method available to perform HTTP request")}};if(typeof window<"u"&&typeof window.fetch=="function")return new os(window.fetch.bind(window));if(typeof require<"u")try{const t=require("https");return new as(t)}catch{return r}else return r}function Cn(){return`ts-sdk-${N(xt(16))}`}class cs{constructor(t,e){l(this,"URL");l(this,"apiKey");l(this,"deploymentId");l(this,"callbackUrl");l(this,"callbackToken");l(this,"headers");l(this,"httpClient");if(this.URL=t,typeof e=="string")this.apiKey=e,this.httpClient=Ye(),this.deploymentId=Cn(),this.callbackToken=void 0,this.callbackUrl=void 0;else{const n=e??{},{apiKey:i,deploymentId:s,httpClient:a,callbackToken:o,callbackUrl:c,headers:f}=n;this.apiKey=i,this.httpClient=a??Ye(),this.deploymentId=s??Cn(),this.callbackToken=o,this.callbackUrl=c,this.headers=f}}requestHeaders(){const t={"Content-Type":"application/json","XDeployment-ID":this.deploymentId};if(this.apiKey!=null&&this.apiKey!==""&&(t.Authorization=`Bearer ${this.apiKey}`),this.callbackUrl!=null&&this.callbackUrl!==""&&(t["X-CallbackUrl"]=this.callbackUrl),this.callbackToken!=null&&this.callbackToken!==""&&(t["X-CallbackToken"]=this.callbackToken),this.headers!=null)for(const e in this.headers)t[e]=this.headers[e];return t}async broadcast(t){let e;try{e=t.toHexEF()}catch(i){if(i.message==="All inputs must have source transactions when serializing to EF format")e=t.toHex();else throw i}const n={method:"POST",headers:this.requestHeaders(),data:{rawTx:e}};try{const i=await this.httpClient.request(`${this.URL}/v1/tx`,n);if(i.ok){const{txid:s,extraInfo:a,txStatus:o,competingTxs:c}=i.data,f=["DOUBLE_SPEND_ATTEMPTED","REJECTED","INVALID","MALFORMED","MINED_IN_STALE_BLOCK"],u=(a==null?void 0:a.toUpperCase().includes("ORPHAN"))||(o==null?void 0:o.toUpperCase().includes("ORPHAN"));if(f.includes(o==null?void 0:o.toUpperCase())||u){const b={status:"error",code:o??"UNKNOWN",txid:s,description:`${o??""} ${a??""}`.trim()};return c!=null&&(b.more={competingTxs:c}),b}const h={status:"success",txid:s,message:`${o} ${a}`};return c!=null&&(h.competingTxs=c),h}else{const s=typeof i.status,a={status:"error",code:s==="number"||s==="string"?i.status.toString():"ERR_UNKNOWN",description:"Unknown error"};let o=i.data;if(typeof o=="string")try{o=JSON.parse(i.data)}catch{}return typeof o=="object"&&(o!==null&&(a.more=o),o!=null&&typeof o.txid=="string"&&(a.txid=o.txid),o!=null&&"detail"in o&&typeof o.detail=="string"&&(a.description=o.detail)),a}}catch(i){return{status:"error",code:"500",description:typeof i.message=="string"?i.message:"Internal Server Error"}}}async broadcastMany(t){const e=t.map(i=>{try{return{rawTx:i.toHexEF()}}catch(s){if(s.message==="All inputs must have source transactions when serializing to EF format")return{rawTx:i.toHex()};throw s}}),n={method:"POST",headers:this.requestHeaders(),data:e};try{return(await this.httpClient.request(`${this.URL}/v1/txs`,n)).data}catch(i){const s={status:"error",code:"500",description:typeof i.message=="string"?i.message:"Internal Server Error"};return t.map(()=>s)}}}function fs(r=!1,t={}){return new cs(r?"https://testnet.arc.gorillapool.io":"https://arc.gorillapool.io",t)}class us{constructor(t="main",e={}){l(this,"network");l(this,"apiKey");l(this,"URL");l(this,"httpClient");const{apiKey:n,httpClient:i}=e;this.network=t,this.URL=`https://api.whatsonchain.com/v1/bsv/${t}`,this.httpClient=i??Ye(),this.apiKey=n??""}async isValidRootForHeight(t,e){const n={method:"GET",headers:this.getHttpHeaders()},i=await this.httpClient.request(`${this.URL}/block/${e}/header`,n);if(i.ok){const{merkleroot:s}=i.data;return s===t}else{if(i.status===404)return!1;throw new Error(`Failed to verify merkleroot for height ${e} because of an error: ${JSON.stringify(i.data)} `)}}async currentHeight(){try{const t={method:"GET",headers:this.getHttpHeaders()},e=await this.httpClient.request(`${this.URL}/block/headers`,t);if(e.ok)return e.data[0].height;throw new Error(`Failed to get current height because of an error: ${JSON.stringify(e.data)} `)}catch(t){throw new Error(`Failed to get current height because of an error: ${t instanceof Error?t.message:String(t)}`)}}getHttpHeaders(){const t={Accept:"application/json"};return typeof this.apiKey=="string"&&this.apiKey.trim()!==""&&(t.Authorization=this.apiKey),t}}function hs(){return new us}class Kt{constructor(t,e,n=!0){l(this,"blockHeight");l(this,"path");this.blockHeight=t,this.path=e;const i=Array(this.path.length).fill(0).map(()=>new Set);this.path.forEach((a,o)=>{if(a.length===0&&o===0)throw new Error(`Empty level at height: ${o}`);const c=new Set;a.forEach(f=>{if(c.has(f.offset))throw new Error(`Duplicate offset: ${f.offset}, at height: ${o}`);if(c.add(f.offset),o===0){if(f.duplicate!==!0)for(let u=1;u<this.path.length;u++)i[u].add(f.offset>>u^1)}else if(n&&!i[o].has(f.offset))throw new Error(`Invalid offset: ${f.offset}, at height: ${o}, with legal offsets: ${Array.from(i[o]).join(", ")}`)})});let s;this.path[0].forEach((a,o)=>{if(o===0&&(s=this.computeRoot(a.hash)),s!==this.computeRoot(a.hash))throw new Error("Mismatched roots")})}static fromHex(t){return Kt.fromBinary(x(t,"hex"))}static fromReader(t,e=!0){const n=t.readVarIntNum(),i=t.readUInt8(),s=Array(i).fill(null).map(()=>[]);let a,o,c;for(let f=0;f<i;f++){for(c=t.readVarIntNum();c>0;){o=t.readVarIntNum(),a=t.readUInt8();const u={offset:o};(a&1)!==0?u.duplicate=!0:((a&2)!==0&&(u.txid=!0),u.hash=N(t.read(32).reverse())),(!Array.isArray(s[f])||s[f].length===0)&&(s[f]=[]),s[f].push(u),c--}s[f].sort((u,h)=>u.offset-h.offset)}return new Kt(n,s,e)}static fromBinary(t){const e=new vt(t);return Kt.fromReader(e)}static fromCoinbaseTxidAndHeight(t,e){return new Kt(e,[[{offset:0,hash:t,txid:!0}]])}toWriter(t){t.writeVarIntNum(this.blockHeight);const e=this.path.length;t.writeUInt8(e);for(let n=0;n<e;n++){const i=Object.keys(this.path[n]).length;t.writeVarIntNum(i);for(const s of this.path[n]){t.writeVarIntNum(s.offset);let a=0;(s==null?void 0:s.duplicate)===!0&&(a|=1),(s==null?void 0:s.txid)!==void 0&&s.txid!==null&&(a|=2),t.writeUInt8(a),(a&1)===0&&t.write(x(s.hash,"hex").reverse())}}}toBinary(){const t=new B;return this.toWriter(t),t.toArray()}toBinaryUint8Array(){const t=new Lt;return this.toWriter(t),t.toUint8Array()}toHex(){return N(this.toBinaryUint8Array())}indexOf(t){const e=this.path[0].find(n=>n.hash===t);if(e==null)throw new Error(`Transaction ID ${t} not found in the Merkle Path`);return e.offset}computeRoot(t){if(typeof t!="string"){const s=this.path[0].find(a=>!!(a!=null&&a.hash));if(s==null)throw new Error("No valid leaf found in the Merkle Path");t=s.hash}if(typeof t!="string")throw new Error("Transaction ID is undefined");const e=this.indexOf(t);if(typeof e!="number")throw new Error(`This proof does not contain the txid: ${t??"undefined"}`);const n=s=>N(ct(x(s,"hex").reverse()).reverse());let i=t;if(this.path.length===1&&this.path[0].length===1)return i;for(let s=0;s<this.path.length;s++){this.path[s];const a=e>>s^1,o=this.findOrComputeLeaf(s,a);if(typeof o!="object")throw new Error(`Missing hash for index ${e} at height ${s}`);o.duplicate===!0?i=n((i??"")+(i??"")):a%2!==0?i=n((o.hash??"")+(i??"")):i=n((i??"")+(o.hash??""))}return i}findOrComputeLeaf(t,e){const n=u=>N(ct(x(u,"hex").reverse()).reverse());let i=this.path[t].find(u=>u.offset===e);if(i!=null)return i;if(t===0)return;const s=t-1,a=e<<1,o=this.findOrComputeLeaf(s,a);if(o==null||o.hash==null||o.hash==="")return;const c=this.findOrComputeLeaf(s,a+1);if(c==null)return;let f;return c.duplicate===!0?f=n(o.hash+o.hash):f=n((c.hash??"")+(o.hash??"")),i={offset:e,hash:f},i}async verify(t,e){const n=this.computeRoot(t);if(this.indexOf(t)===0){const i=await e.currentHeight();if(this.blockHeight+100<i)return!1}return await e.isValidRootForHeight(n,this.blockHeight)}combine(t){var s,a;if(this.blockHeight!==t.blockHeight)throw new Error("You cannot combine paths which do not have the same block height.");const e=this.computeRoot(),n=t.computeRoot();if(e!==n)throw new Error("You cannot combine paths which do not have the same root.");const i=[];for(let o=0;o<this.path.length;o++){i.push([]);for(let c=0;c<this.path[o].length;c++)i[o].push(this.path[o][c]);for(let c=0;c<t.path[o].length;c++)if(i[o].find(f=>f.offset===t.path[o][c].offset)===void 0)i[o].push(t.path[o][c]);else if(((s=t.path[o][c])==null?void 0:s.txid)!==void 0&&((a=t.path[o][c])==null?void 0:a.txid)!==null){const f=i[o].find(u=>u.offset===t.path[o][c].offset);f!=null&&(f.txid=!0)}}this.path=i,this.trim()}trim(){const t=(a,o)=>{(o.length===0||o.slice(-1)[0]!==a)&&o.push(a)},e=(a,o)=>{for(let c=a.length;c>=0;c--){const f=this.path[o].findIndex(u=>u.offset===a[c]);f>=0&&this.path[o].splice(f,1)}},n=a=>{const o=[];for(const c of a)t(c>>1,o);return o};let i=[],s=[];for(let a=0;a<this.path.length;a++)this.path[a].sort((o,c)=>o.offset-c.offset);for(let a=0;a<this.path[0].length;a++){const o=this.path[0][a];if(o.txid===!0)t(o.offset>>1,i);else{const c=o.offset%2===1,f=this.path[0][a+(c?-1:1)];(f.txid===void 0||f.txid===null||!f.txid)&&t(f.offset,s)}}e(s,0);for(let a=1;a<this.path.length;a++)s=i,i=n(i),e(s,a)}}class ht{constructor(t,e){l(this,"_bumpIndex");l(this,"_tx");l(this,"_rawTx");l(this,"_txid");l(this,"inputTxids",[]);l(this,"isValid");if(typeof t=="string")this._txid=t;else if(t instanceof Uint8Array)this._rawTx=t;else if(Array.isArray(t))this._rawTx=new Uint8Array(t);else if(t instanceof j)this._tx=t;else throw new Error("Invalid transaction data type");this.bumpIndex=e,this.updateInputTxids()}get bumpIndex(){return this._bumpIndex}set bumpIndex(t){this._bumpIndex=t,this.updateInputTxids()}get hasProof(){return this._bumpIndex!==void 0}get isTxidOnly(){return this._txid!==void 0&&this._txid!==null&&this._rawTx==null&&this._tx==null}get txid(){if(this._txid!==void 0&&this._txid!==null&&this._txid!=="")return this._txid;if(this._tx!=null)return this._txid=this._tx.id("hex"),this._txid;if(this._rawTx!=null)return this._txid=N(ct(this._rawTx)),this._txid;throw new Error("Internal")}get tx(){if(this._tx!=null)return this._tx;if(this._rawTx!=null)return this._tx=j.fromBinary(this._rawTx),this._tx}get rawTx(){if(this._rawTx!=null)return Array.from(this._rawTx);if(this._tx!=null){const t=this._tx.toUint8Array();return this._rawTx=t,Array.from(t)}}get rawTxUint8Array(){if(this._rawTx!=null)return this._rawTx;if(this._tx!=null)return this._rawTx=this._tx.toUint8Array(),this._rawTx}static fromTx(t,e){return new ht(t,e)}static fromRawTx(t,e){return new ht(t,e)}static fromTxid(t,e){return new ht(t,e)}updateInputTxids(){if(this.hasProof||this.tx==null)this.inputTxids=[];else{const t=new Set;for(const e of this.tx.inputs)e.sourceTXID!==void 0&&e.sourceTXID!==null&&e.sourceTXID!==""&&t.add(e.sourceTXID);this.inputTxids=Array.from(t)}}toWriter(t,e){const n=o=>{t.writeUInt8(o)},i=()=>{if(this._txid==null)throw new Error("Transaction ID (_txid) is undefined");t.writeReverse(x(this._txid,"hex"))},s=()=>{const o=this.rawTxUint8Array;if(o==null)throw new Error("a valid serialized Transaction is expected");t.write(o)},a=()=>{this.bumpIndex===void 0?n(St.RAWTX):(n(St.RAWTX_AND_BUMP_INDEX),t.writeVarIntNum(this.bumpIndex))};e===Wt?this.isTxidOnly?(n(St.TXID_ONLY),i()):this.bumpIndex!==void 0?(n(St.RAWTX_AND_BUMP_INDEX),t.writeVarIntNum(this.bumpIndex),s()):(n(St.RAWTX),s()):(s(),a())}static fromReader(t,e){let n,i,s;if(e===Wt){const a=t.readUInt8();a===St.TXID_ONLY?s=ht.fromTxid(N(t.readReverse(32))):(a===St.RAWTX_AND_BUMP_INDEX&&(i=t.readVarIntNum()),n=j.fromReader(t),s=ht.fromTx(n,i))}else n=j.fromReader(t),i=t.readUInt8()!==0?t.readVarIntNum():void 0,s=ht.fromTx(n,i);return s}}const Ze=4022206465,Wt=4022206466,Rn=16843009;var St;(function(r){r[r.RAWTX=0]="RAWTX",r[r.RAWTX_AND_BUMP_INDEX=1]="RAWTX_AND_BUMP_INDEX",r[r.TXID_ONLY=2]="TXID_ONLY"})(St||(St={}));class gt{constructor(t=Wt){l(this,"bumps",[]);l(this,"txs",[]);l(this,"version",Wt);l(this,"atomicTxid");l(this,"txidIndex");l(this,"rawBytesCache");l(this,"hexCache");l(this,"needsSort",!0);this.version=t}invalidateSerializationCaches(){this.rawBytesCache=void 0,this.hexCache=void 0}markMutated(t=!0){this.invalidateSerializationCaches(),t&&(this.needsSort=!0)}ensureSerializableState(){for(const t of this.txs)t.txid}ensureSortedForSerialization(){this.needsSort&&this.sortTxs()}getSerializedBytes(){if(this.ensureSerializableState(),this.rawBytesCache==null){this.ensureSortedForSerialization();const t=new Lt;this.toWriter(t),this.rawBytesCache=t.toUint8Array()}return this.rawBytesCache}getBeefForAtomic(t){this.needsSort&&this.sortTxs();const e=this.findTxid(t);if(e==null)throw new Error(`${t} does not exist in this Beef`);const n=this.txs[this.txs.length-1]===e?this:this.clone();if(n!==this){const s=this.txs.findIndex(a=>a.txid===t);n.txs.splice(s+1)}const i=new Lt;return i.writeUInt32LE(Rn),i.writeReverse(x(t,"hex")),{beef:n,writer:i}}findTxid(t){return this.ensureTxidIndex().get(t)}ensureTxidIndex(){if(this.txidIndex==null){this.txidIndex=new Map;for(const t of this.txs)this.txidIndex.set(t.txid,t)}return this.txidIndex}deleteFromIndex(t){var e;(e=this.txidIndex)==null||e.delete(t)}addToIndex(t){var e;(e=this.txidIndex)==null||e.set(t.txid,t)}makeTxidOnly(t){const e=this.txs.findIndex(i=>i.txid===t);if(e===-1)return;let n=this.txs[e];return n.isTxidOnly||(this.deleteFromIndex(t),this.txs.splice(e,1),this.markMutated(!0),n=this.mergeTxidOnly(t)),n}findBump(t){return this.bumps.find(e=>e.path[0].some(n=>n.hash===t))}findTransactionForSigning(t){const e=this.findTxid(t);if(!(e==null||e.tx==null)){for(const n of e.tx.inputs)if(n.sourceTransaction==null){const i=this.findTxid(ve(n.sourceTXID,"sourceTXID must be valid"));i!=null&&(n.sourceTransaction=i.tx)}return e.tx}}findAtomicTransaction(t){const e=this.findTxid(t);if(e==null||e.tx==null)return;const n=(i,s)=>{const a=i.findBump(s.id("hex"));if(a!=null)s.merklePath=a;else for(const o of s.inputs){if(o.sourceTransaction==null){const c=i.findTxid(ve(o.sourceTXID,"sourceTXID must be valid"));c!=null&&(o.sourceTransaction=c.tx)}if(o.sourceTransaction!=null){const c=i.findBump(o.sourceTransaction.id("hex"));c!=null?o.sourceTransaction.merklePath=c:n(i,o.sourceTransaction)}}};return n(this,e.tx),e.tx}mergeBump(t){this.markMutated(!1);let e;for(let i=0;i<this.bumps.length;i++){const s=this.bumps[i];if(s===t)return i;if(s.blockHeight===t.blockHeight){const a=s.computeRoot(),o=t.computeRoot();if(a===o){s.combine(t),e=i;break}}}e===void 0&&(e=this.bumps.length,this.bumps.push(t));const n=this.bumps[e];for(const i of this.txs){const s=i.txid;if(i.bumpIndex==null){for(const a of n.path[0])if(a.hash===s){i.bumpIndex=e,a.txid=!0;break}}}return e}mergeRawTx(t,e){this.markMutated(!0);const n=new ht(t,e);return this.removeExistingTxid(n.txid),this.txs.push(n),this.addToIndex(n),this.tryToValidateBumpIndex(n),n}mergeTransaction(t){this.markMutated(!0);const e=t.id("hex");this.removeExistingTxid(e);let n;t.merklePath!=null&&(n=this.mergeBump(t.merklePath));const i=new ht(t,n);if(this.txs.push(i),this.addToIndex(i),this.tryToValidateBumpIndex(i),n=i.bumpIndex,n===void 0)for(const s of t.inputs)s.sourceTransaction!=null&&this.mergeTransaction(s.sourceTransaction);return i}removeExistingTxid(t){const e=this.txs.findIndex(n=>n.txid===t);e>=0&&(this.deleteFromIndex(t),this.txs.splice(e,1),this.markMutated(!0))}mergeTxidOnly(t){let e=this.findTxid(t);return e==null&&(e=new ht(t),this.txs.push(e),this.addToIndex(e),this.tryToValidateBumpIndex(e),this.markMutated(!0)),e}mergeBeefTx(t){let e=this.findTxid(t.txid);if(t.isTxidOnly&&e==null?e=this.mergeTxidOnly(t.txid):t._tx!=null&&(e==null||e.isTxidOnly)?e=this.mergeTransaction(t._tx):t._rawTx!=null&&(e==null||e.isTxidOnly)&&(e=this.mergeRawTx(t._rawTx)),e==null)throw new Error(`Failed to merge BeefTx for txid: ${t.txid}`);return e}mergeBeef(t){const e=t instanceof gt?t:gt.fromBinary(t);for(const n of e.bumps)this.mergeBump(n);for(const n of e.txs)this.mergeBeefTx(n)}isValid(t){return this.verifyValid(t).valid}async verify(t,e){const n=this.verifyValid(e);if(!n.valid)return!1;for(const i of Object.keys(n.roots))if(!await t.isValidRootForHeight(n.roots[i],Number(i)))return!1;return!0}verifyValid(t){const e={valid:!1,roots:{}},n=this.sortTxs();if(n.missingInputs.length>0||n.notValid.length>0||n.txidOnly.length>0&&t!==!0||n.withMissingInputs.length>0)return e;const i={};for(const a of this.txs)if(a.isTxidOnly){if(t!==!0)return e;i[a.txid]=!0}const s=(a,o)=>{const c=a.computeRoot(o);return(e.roots[a.blockHeight]===void 0||e.roots[a.blockHeight]==="")&&(e.roots[a.blockHeight]=c),e.roots[a.blockHeight]===c};for(const a of this.bumps)for(const o of a.path[0])if(o.txid===!0&&typeof o.hash=="string"&&o.hash.length>0&&(i[o.hash]=!0,!s(a,o.hash)))return e;for(const a of this.txs)if(a.bumpIndex!==void 0&&this.bumps[a.bumpIndex].path[0].find(c=>c.hash===a.txid)==null)return e;for(const a of this.txs){for(const o of a.inputTxids)if(!i[o])return e;i[a.txid]=!0}return e.valid=!0,e}toWriter(t){t.writeUInt32LE(this.version),t.writeVarIntNum(this.bumps.length);for(const e of this.bumps)t.write(e.toBinary());t.writeVarIntNum(this.txs.length);for(const e of this.txs)e.toWriter(t,this.version)}toBinary(){return Array.from(this.getSerializedBytes())}toUint8Array(){return this.getSerializedBytes()}toBinaryAtomic(t){const{beef:e,writer:n}=this.getBeefForAtomic(t);return e.toWriter(n),n.toArray()}toUint8ArrayAtomic(t){const{beef:e,writer:n}=this.getBeefForAtomic(t),i=e.getSerializedBytes(),s=n.toUint8Array(),a=new Uint8Array(s.length+i.length);return a.set(s,0),a.set(i,s.length),a}toHex(){if(this.hexCache!=null)return this.hexCache;const t=this.getSerializedBytes(),e=N(t);return this.hexCache=e,e}static fromReader(t){let e=t.readUInt32LE(),n;if(e===Rn&&(n=N(t.readReverse(32)),e=t.readUInt32LE()),e!==Ze&&e!==Wt)throw new Error(`Serialized BEEF must start with ${Ze} or ${Wt} but starts with ${e}`);const i=new gt(e),s=t.readVarIntNum();for(let o=0;o<s;o++){const c=Kt.fromReader(t,!1);i.bumps.push(c)}const a=t.readVarIntNum();for(let o=0;o<a;o++){const c=ht.fromReader(t,e);i.txs.push(c)}return i.atomicTxid=n,i}static fromBinary(t){const e=vt.makeReader(t);return gt.fromReader(e)}static fromString(t,e="hex"){const n=Fe(t,e),i=new vt(n);return gt.fromReader(i)}tryToValidateBumpIndex(t){if(t.bumpIndex!==void 0)return!0;const e=t.txid;for(let n=0;n<this.bumps.length;n++){const i=this.bumps[n].path[0].findIndex(s=>s.hash===e);if(i>=0)return t.bumpIndex=n,this.bumps[n].path[0][i].txid=!0,!0}return!1}sortTxs(){const t={},e={};let n=[];const i=[],s=[];for(const u of this.txs)e[u.txid]=u,u.isValid=u.hasProof,u.isValid?(t[u.txid]=!0,i.push(u)):u.isTxidOnly&&u.inputTxids.length===0?(t[u.txid]=!0,s.push(u)):n.push(u);const a={},o=[],c=n;n=[];for(const u of c){let h=!1;for(const b of u.inputTxids)e[b]===void 0&&(a[b]=!0,h=!0);h?o.push(u):n.push(u)}for(;n.length>0;){const u=n;n=[];for(const h of u)h.inputTxids.every(b=>t[b])?(t[h.txid]=!0,i.push(h)):n.push(h);if(u.length===n.length)break}const f=n;return this.txs=o.concat(f).concat(s).concat(i),this.needsSort=!1,this.invalidateSerializationCaches(),{missingInputs:Object.keys(a),notValid:f.map(u=>u.txid),valid:Object.keys(t),withMissingInputs:o.map(u=>u.txid),txidOnly:s.map(u=>u.txid)}}clone(){const t=new gt;return t.version=this.version,t.bumps=Array.from(this.bumps),t.txs=Array.from(this.txs),t.txidIndex=void 0,t.needsSort=this.needsSort,t.hexCache=this.hexCache,t.rawBytesCache=this.rawBytesCache,t}trimKnownTxids(t){let e=!1;for(let i=0;i<this.txs.length;){const s=this.txs[i];s.isTxidOnly&&t.includes(s.txid)?(this.deleteFromIndex(s.txid),this.txs.splice(i,1),e=!0):i++}const n=new Set;for(const i of this.txs)i.bumpIndex!==void 0&&n.add(i.bumpIndex);if(n.size<this.bumps.length){const i=new Map;let s=0;for(let a=0;a<this.bumps.length;a++)n.has(a)&&(i.set(a,s),s++);this.bumps=this.bumps.filter((a,o)=>n.has(o));for(const a of this.txs)if(a.bumpIndex!==void 0){const o=i.get(a.bumpIndex);if(o===void 0)throw new Error(`Internal error: bumpIndex ${a.bumpIndex} not found in indexMap`);a.bumpIndex=o}e=!0}e&&this.markMutated(!0)}getValidTxids(){return this.sortTxs().valid}toLogString(){var n;let t="";t+=`BEEF with ${this.bumps.length} BUMPS and ${this.txs.length} Transactions, isValid ${this.isValid().toString()}
`;let e=-1;for(const i of this.bumps)e++,t+=`  BUMP ${e}
    block: ${i.blockHeight}
    txids: [
${i.path[0].filter(s=>s.txid===!0).map(s=>`      '${s.hash??""}'`).join(`,
`)}
    ]
`;e=-1;for(const i of this.txs)e++,t+=`  TX ${e}
    txid: ${i.txid}
`,i.bumpIndex!==void 0&&(t+=`    bumpIndex: ${i.bumpIndex}
`),i.isTxidOnly?t+=`    txidOnly
`:t+=`    rawTx length=${((n=i.rawTx)==null?void 0:n.length)??0}
`,i.inputTxids.length>0&&(t+=`    inputs: [
${i.inputTxids.map(s=>`      '${s}'`).join(`,
`)}
    ]
`);return t}addComputedLeaves(){const t=e=>N(ct(x(e,"hex").reverse()).reverse());for(const e of this.bumps)for(let n=1;n<e.path.length;n++)for(const i of e.path[n-1])if(typeof i.hash=="string"&&(i.offset&1)===0){const s=e.path[n-1].find(o=>o.offset===i.offset+1),a=i.offset>>1;s!==void 0&&typeof s.hash=="string"&&e.path[n].every(o=>o.offset!==a)&&e.path[n].push({offset:a,hash:t(s.hash+i.hash)})}}}class j{constructor(t=1,e=[],n=[],i=0,s=new Map,a){l(this,"version");l(this,"inputs");l(this,"outputs");l(this,"lockTime");l(this,"metadata");l(this,"merklePath");l(this,"cachedHash");l(this,"rawBytesCache");l(this,"hexCache");this.version=t,this.inputs=e,this.outputs=n,this.lockTime=i,this.metadata=s,this.merklePath=a}static addPathOrInputs(t,e,n){if(typeof t.pathIndex=="number"){const i=n[t.pathIndex];if(typeof i!="object")throw new Error("Invalid merkle path index found in BEEF!");t.tx.merklePath=i}else for(const i of t.tx.inputs){if(i.sourceTXID===void 0)throw new Error("Input sourceTXID is undefined");const s=e[i.sourceTXID];if(typeof s!="object")throw new Error(`Reference to unknown TXID in BEEF: ${i.sourceTXID??"undefined"}`);i.sourceTransaction=s.tx,this.addPathOrInputs(s,e,n)}}static fromBEEF(t,e){const{tx:n}=j.fromAnyBeef(t,e);return n}static fromAtomicBEEF(t){const{tx:e,txid:n,beef:i}=j.fromAnyBeef(t);if(n!==i.atomicTxid)throw i.atomicTxid!=null?new Error(`Transaction with TXID ${i.atomicTxid} not found in BEEF data.`):new Error("beef must conform to BRC-95 and must contain the subject txid.");return e}static fromAnyBeef(t,e){const n=gt.fromBinary(t);if(n.txs.length<1)throw new Error("beef must include at least one transaction.");const i=e??n.atomicTxid??n.txs.slice(-1)[0].txid,s=n.findAtomicTransaction(i);if(s==null)throw e!=null?new Error(`Transaction with TXID ${i} not found in BEEF data.`):new Error("beef does not contain transaction for atomic txid.");return{tx:s,beef:n,txid:i}}static fromEF(t){const e=vt.makeReader(t),n=e.readUInt32LE();if(N(e.read(6))!=="0000000000ef")throw new Error("Invalid EF marker");const i=e.readVarIntNum(),s=[];for(let f=0;f<i;f++){const u=N(e.readReverse(32)),h=e.readUInt32LE(),b=e.readVarIntNum(),g=e.read(b),p=je.fromBinary(g),m=e.readUInt32LE(),y=e.readUInt64LEBn().toNumber(),k=e.readVarIntNum(),I=e.read(k),v=we.fromBinary(I),E=new j(void 0,[],[],void 0);E.outputs=Array(h+1).fill(null),E.outputs[h]={satoshis:y,lockingScript:v},s.push({sourceTransaction:E,sourceTXID:u,sourceOutputIndex:h,unlockingScript:p,sequence:m})}const a=e.readVarIntNum(),o=[];for(let f=0;f<a;f++){const u=e.readUInt64LEBn().toNumber(),h=e.readVarIntNum(),b=e.read(h),g=we.fromBinary(b);o.push({satoshis:u,lockingScript:g})}const c=e.readUInt32LE();return new j(n,s,o,c)}static parseScriptOffsets(t){const e=vt.makeReader(t),n=[],i=[];e.pos+=4;const s=e.readVarIntNum();for(let o=0;o<s;o++){e.pos+=36;const c=e.readVarIntNum();n.push({vin:o,offset:e.pos,length:c}),e.pos+=c+4}const a=e.readVarIntNum();for(let o=0;o<a;o++){e.pos+=8;const c=e.readVarIntNum();i.push({vout:o,offset:e.pos,length:c}),e.pos+=c}return{inputs:n,outputs:i}}static fromReader(t){const e=t.readUInt32LE(),n=t.readVarIntNum(),i=[];for(let c=0;c<n;c++){const f=N(t.readReverse(32)),u=t.readUInt32LE(),h=t.readVarIntNum(),b=t.read(h),g=je.fromBinary(b),p=t.readUInt32LE();i.push({sourceTXID:f,sourceOutputIndex:u,unlockingScript:g,sequence:p})}const s=t.readVarIntNum(),a=[];for(let c=0;c<s;c++){const f=t.readUInt64LEBn().toNumber(),u=t.readVarIntNum(),h=t.read(u),b=we.fromBinary(h);a.push({satoshis:f,lockingScript:b})}const o=t.readUInt32LE();return new j(e,i,a,o)}static fromBinary(t){const e=t.slice(),n=Uint8Array.from(e),i=new vt(n),s=j.fromReader(i);return s.rawBytesCache=n,s}static fromHex(t){const e=Fe(t,"hex"),n=new vt(e),i=j.fromReader(n);return i.rawBytesCache=e,i.hexCache=N(e),i}static fromHexEF(t){return j.fromEF(Fe(t,"hex"))}static fromHexBEEF(t,e){return j.fromBEEF(x(t,"hex"),e)}invalidateSerializationCaches(){this.cachedHash=void 0,this.rawBytesCache=void 0,this.hexCache=void 0}addInput(t){if(typeof t.sourceTXID>"u"&&typeof t.sourceTransaction>"u")throw new Error("A reference to an an input transaction is required. If the input transaction itself cannot be referenced, its TXID must still be provided.");typeof t.sequence>"u"&&(t.sequence=4294967295),this.invalidateSerializationCaches(),this.inputs.push(t)}addOutput(t){if(this.cachedHash=void 0,t.change!==!0){if(typeof t.satoshis>"u")throw new Error("either satoshis must be defined or change must be set to true");if(t.satoshis<0)throw new Error("satoshis must be a positive integer or zero")}if(t.lockingScript==null)throw new Error("lockingScript must be defined");this.outputs.push(t)}addP2PKHOutput(t,e){const n=new rs().lock(t);if(typeof e>"u")return this.addOutput({lockingScript:n,change:!0});this.addOutput({lockingScript:n,satoshis:e})}updateMetadata(t){this.metadata={...this.metadata,...t}}async fee(t=Ge.getInstance(),e="equal"){if(this.invalidateSerializationCaches(),typeof t=="number"){const s=t;t={computeFee:async()=>s}}const n=await t.computeFee(this),i=this.calculateChange(n);if(i<=0){this.outputs=this.outputs.filter(s=>s.change!==!0);return}this.distributeChange(i,e)}calculateChange(t){let e=0;for(const n of this.inputs){if(typeof n.sourceTransaction!="object")throw new Error("Source transactions are required for all inputs during fee computation");e+=n.sourceTransaction.outputs[n.sourceOutputIndex].satoshis??0}e-=t;for(const n of this.outputs)n.change!==!0&&n.satoshis!==void 0&&(e-=n.satoshis);return e}distributeChange(t,e){let n=0;const i=this.outputs.filter(s=>s.change);if(e==="random"?n=this.distributeRandomChange(t,i):e==="equal"&&(n=this.distributeEqualChange(t,i)),n<t){const s=this.outputs[this.outputs.length-1];s.satoshis!==void 0?s.satoshis+=t-n:s.satoshis=t-n}}distributeRandomChange(t,e){let n=0,i=t;const s=Array(e.length).fill(1);i-=e.length,n+=e.length;for(let a=0;a<e.length-1;a++){const o=this.benfordNumber(0,i);s[a]=s[a]+o,n+=o,i-=o}for(const a of this.outputs)a.change===!0&&(a.satoshis=s.shift());return n}distributeEqualChange(t,e){let n=0;const i=Math.floor(t/e.length);for(const s of e)n+=i,s.satoshis=i;return n}benfordNumber(t,e){const n=Math.floor(Math.random()*9)+1;return Math.floor(t+(e-t)*Math.log10(1+1/n)/Math.log10(10))}getFee(){let t=0;for(const n of this.inputs){if(typeof n.sourceTransaction!="object")throw new Error("Source transactions or sourceSatoshis are required for all inputs to calculate fee");t+=n.sourceTransaction.outputs[n.sourceOutputIndex].satoshis??0}let e=0;for(const n of this.outputs)e+=n.satoshis??0;return t-e}async sign(){this.invalidateSerializationCaches();for(const e of this.outputs)if(typeof e.satoshis>"u")throw e.change===!0?new Error("There are still change outputs with uncomputed amounts. Use the fee() method to compute the change amounts and transaction fees prior to signing."):new Error("One or more transaction outputs is missing an amount. Ensure all output amounts are provided before signing.");const t=await Promise.all(this.inputs.map(async(e,n)=>{var i,s;return typeof this.inputs[n].unlockingScriptTemplate=="object"?await((s=(i=this.inputs[n])==null?void 0:i.unlockingScriptTemplate)==null?void 0:s.sign(this,n)):await Promise.resolve(void 0)}));for(let e=0,n=this.inputs.length;e<n;e++)typeof this.inputs[e].unlockingScriptTemplate=="object"&&(this.inputs[e].unlockingScript=t[e])}async broadcast(t=fs()){return await t.broadcast(this)}writeTransactionBody(t){t.writeUInt32LE(this.version),t.writeVarIntNum(this.inputs.length);for(const e of this.inputs){if(typeof e.sourceTXID>"u")if(e.sourceTransaction!=null)t.write(e.sourceTransaction.hash());else throw new Error("sourceTransaction is undefined");else t.writeReverse(x(e.sourceTXID,"hex"));if(t.writeUInt32LE(e.sourceOutputIndex),e.unlockingScript==null)throw new Error("unlockingScript is undefined");const n=e.unlockingScript.toUint8Array();t.writeVarIntNum(n.length),t.write(n),t.writeUInt32LE(e.sequence??4294967295)}t.writeVarIntNum(this.outputs.length);for(const e of this.outputs){t.writeUInt64LE(e.satoshis??0);const n=e.lockingScript.toUint8Array();t.writeVarIntNum(n.length),t.write(n)}t.writeUInt32LE(this.lockTime)}buildSerializedBytes(){const t=new Lt;return this.writeTransactionBody(t),t.toUint8Array()}getSerializedBytes(){return this.rawBytesCache==null&&(this.rawBytesCache=this.buildSerializedBytes()),this.rawBytesCache}toBinary(){return Array.from(this.getSerializedBytes())}toUint8Array(){return this.getSerializedBytes()}writeEF(t){t.writeUInt32LE(this.version),t.write([0,0,0,0,0,239]),t.writeVarIntNum(this.inputs.length);for(const e of this.inputs){if(typeof e.sourceTransaction>"u")throw new Error("All inputs must have source transactions when serializing to EF format");if(typeof e.sourceTXID>"u"?t.write(e.sourceTransaction.hash()):t.write(x(e.sourceTXID,"hex").reverse()),t.writeUInt32LE(e.sourceOutputIndex),e.unlockingScript==null)throw new Error("unlockingScript is undefined");const n=e.unlockingScript.toBinary();t.writeVarIntNum(n.length),t.write(n),t.writeUInt32LE(e.sequence??4294967295),t.writeUInt64LE(e.sourceTransaction.outputs[e.sourceOutputIndex].satoshis??0);const i=e.sourceTransaction.outputs[e.sourceOutputIndex].lockingScript.toBinary();t.writeVarIntNum(i.length),t.write(i)}t.writeVarIntNum(this.outputs.length);for(const e of this.outputs){t.writeUInt64LE(e.satoshis??0);const n=e.lockingScript.toBinary();t.writeVarIntNum(n.length),t.write(n)}t.writeUInt32LE(this.lockTime)}toEF(){const t=new B;return this.writeEF(t),t.toArray()}toEFUint8Array(){const t=new Lt;return this.writeEF(t),t.toUint8Array()}toHexEF(){return N(this.toEFUint8Array())}toHex(){if(this.hexCache!=null)return this.hexCache;const t=this.getSerializedBytes(),e=N(t);return this.hexCache=e,e}toHexBEEF(){return N(this.toBEEF())}toHexAtomicBEEF(){return N(this.toAtomicBEEF())}hash(t){return this.cachedHash==null&&(this.cachedHash=ct(this.getSerializedBytes())),t==="hex"?N(this.cachedHash):this.cachedHash}id(t){const e=[...this.hash()];return e.reverse(),t==="hex"?N(e):e}async verify(t=hs(),e,n){const i=new Set,s=[this];for(;s.length>0;){const a=s.shift(),o=(a==null?void 0:a.id("hex"))??"";if(o!=null&&o!==""&&i.has(o))continue;if(typeof(a==null?void 0:a.merklePath)=="object")if(t==="scripts only"){o!=null&&i.add(o);continue}else if(await a.merklePath.verify(o,t)){i.add(o);continue}else throw new Error(`Invalid merkle path for transaction ${o}`);if(typeof e<"u"){if(a===void 0)throw new Error("Transaction is undefined");const u=j.fromEF(a.toEF());if(delete u.outputs[0].satoshis,u.outputs[0].change=!0,await u.fee(e),a.getFee()<u.getFee())throw new Error(`Verification failed because the transaction ${o} has an insufficient fee and has not been mined.`)}let c=0;if(a===void 0)throw new Error("Transaction is undefined");for(let u=0;u<a.inputs.length;u++){const h=a.inputs[u];if(typeof h.sourceTransaction!="object")throw new Error(`Verification failed because the input at index ${u} of transaction ${o} is missing an associated source transaction. This source transaction is required for transaction verification because there is no merkle proof for the transaction spending a UTXO it contains.`);if(typeof h.unlockingScript!="object")throw new Error(`Verification failed because the input at index ${u} of transaction ${o} is missing an associated unlocking script. This script is required for transaction verification because there is no merkle proof for the transaction spending the UTXO.`);const b=h.sourceTransaction.outputs[h.sourceOutputIndex];c+=b.satoshis??0;const g=h.sourceTransaction.id("hex");i.has(g)||s.push(h.sourceTransaction);const p=a.inputs.filter((k,I)=>I!==u);if(typeof h.sourceTXID>"u"&&(h.sourceTXID=g),!new is({sourceTXID:h.sourceTXID,sourceOutputIndex:h.sourceOutputIndex,lockingScript:b.lockingScript,sourceSatoshis:b.satoshis??0,transactionVersion:a.version,otherInputs:p,unlockingScript:h.unlockingScript,inputSequence:h.sequence??4294967295,inputIndex:u,outputs:a.outputs,lockTime:a.lockTime,memoryLimit:n}).validate())return!1}let f=0;for(const u of a.outputs){if(typeof u.satoshis!="number")throw new Error("Every output must have a defined amount during transaction verification.");f+=u.satoshis}if(f>c)return!1;i.add(o)}return!0}writeSerializedBEEF(t,e){t.writeUInt32LE(Ze);const n=[],i=new Map,s=new Map,a=[],o=new Set,c=u=>{const h=i.get(u);if(h!==void 0)return h;const b=`${u.blockHeight}:${u.computeRoot()}`,g=s.get(b);if(g!==void 0)return n[g].combine(u),i.set(u,g),g;const p=n.length;return n.push(u),i.set(u,p),s.set(b,p),p},f=u=>{const h=u.id("hex");if(o.has(h))return;const b={tx:u},g=u.merklePath,p=typeof g=="object";if(p&&g!=null&&(b.pathIndex=c(g)),!p)for(let m=u.inputs.length-1;m>=0;m--){const y=u.inputs[m];if(typeof y.sourceTransaction=="object")f(y.sourceTransaction);else if(e===!1)throw new Error("A required source transaction is missing!")}o.add(h),a.push(b)};f(this),t.writeVarIntNum(n.length);for(const u of n)t.write(u.toBinary());t.writeVarIntNum(a.length);for(const u of a)t.write(u.tx.toBinary()),typeof u.pathIndex=="number"?(t.writeUInt8(1),t.writeVarIntNum(u.pathIndex)):t.writeUInt8(0);return t.toArray()}toBEEF(t){const e=new B;return this.writeSerializedBEEF(e,t),e.toArray()}toBEEFUint8Array(t){const e=new Lt;return this.writeSerializedBEEF(e,t),e.toArray()}toAtomicBEEF(t){const e=[1,1,1,1],n=this.hash(),i=this.toBEEF(t);return e.concat(n,i)}toAtomicBEEFUint8Array(t){const e=new Lt,n=[1,1,1,1];e.write(n);const i=this.hash();return e.write(i),this.writeSerializedBEEF(e,t),e.toUint8Array()}async completeWithWallet(t,e,n,i){var g;const s=this.inputs.length,a=this.outputs.length,c={description:e??`Transaction with ${s} input(s) and ${a} output(s)`,inputs:[],outputs:[],lockTime:this.lockTime,version:this.version},f=this.inputs.some(p=>p.unlockingScriptTemplate!=null),u=new gt;for(let p=0;p<this.inputs.length;p++){const m=this.inputs[p];if(m.sourceTransaction==null)throw new Error("All inputs must have a sourceTransaction when using completeWithWallet");const y=m.sourceTransaction.toBEEF();u.mergeBeef(y);const I={outpoint:`${m.sourceTransaction.id("hex")}.${m.sourceOutputIndex}`,inputDescription:"Input from source transaction",sequenceNumber:m.sequence};if(f)if(m.unlockingScriptTemplate!=null){const v=await m.unlockingScriptTemplate.estimateLength(this,p);I.unlockingScriptLength=v}else if(m.unlockingScript!=null)I.unlockingScript=m.unlockingScript.toHex();else throw new Error(`Input ${p} must have either an unlockingScript or unlockingScriptTemplate`);else{if(m.unlockingScript==null)throw new Error("All inputs must have an unlockingScript when using completeWithWallet");I.unlockingScript=m.unlockingScript.toHex()}c.inputs.push(I)}this.inputs.length>0&&(c.inputBEEF=u.toBinary());for(const p of this.outputs)c.outputs.push({satoshis:p.satoshis,lockingScript:p.lockingScript.toHex(),outputDescription:"Output from source transaction"});((g=this.metadata)==null?void 0:g.labels)!=null&&Array.isArray(this.metadata.labels)&&(c.labels=this.metadata.labels);let h;if(f){c.options={...i,signAndProcess:!1};const{signableTransaction:p}=await t.createAction(c,n);if(p==null)throw new Error("Wallet createAction did not return signableTransaction");const m=j.fromBEEF(p.tx),y={};for(let v=0;v<this.inputs.length;v++){const E=this.inputs[v];if(E.unlockingScriptTemplate!=null){const _=await E.unlockingScriptTemplate.sign(m,v);y[v]={unlockingScript:_.toHex()}}else E.unlockingScript!=null&&(y[v]={unlockingScript:E.unlockingScript.toHex()})}const k=i!=null?{acceptDelayedBroadcast:i.acceptDelayedBroadcast,returnTXIDOnly:i.returnTXIDOnly,noSend:i.noSend,sendWith:i.sendWith}:void 0,I=await t.signAction({reference:p.reference,spends:y,options:k},n);if(I.tx==null)throw new Error("Wallet signAction did not return transaction data");h=I.tx}else{i!=null&&(c.options=i);const{tx:p}=await t.createAction(c,n);if(p==null)throw new Error("Wallet createAction did not return transaction data");h=p}const b=j.fromAtomicBEEF(h);this.version=b.version,this.inputs=b.inputs,this.outputs=b.outputs,this.lockTime=b.lockTime,this.merklePath=b.merklePath,this.cachedHash=b.cachedHash,this.metadata={...this.metadata,...b.metadata}}}var Qe;(function(r){r[r.Silent=0]="Silent",r[r.App=1]="App",r[r.Counterparty=2]="Counterparty"})(Qe||(Qe={}));class ds{constructor(t,e,n){l(this,"cacheSharedSecret");l(this,"retrieveCachedSharedSecret");l(this,"rootKey");l(this,"identityKey");l(this,"anyone");this.cacheSharedSecret=e,this.retrieveCachedSharedSecret=n,this.anyone=new et(1).toPublicKey(),t==="anyone"?this.rootKey=new et(1):this.rootKey=t,this.identityKey=this.rootKey.toPublicKey().toString()}derivePublicKey(t,e,n,i=!1){return n=this.normalizeCounterparty(n),i?this.rootKey.deriveChild(n,this.computeInvoiceNumber(t,e),this.cacheSharedSecret,this.retrieveCachedSharedSecret).toPublicKey():n.deriveChild(this.rootKey,this.computeInvoiceNumber(t,e),this.cacheSharedSecret,this.retrieveCachedSharedSecret)}derivePrivateKey(t,e,n){return n=this.normalizeCounterparty(n),this.rootKey.deriveChild(n,this.computeInvoiceNumber(t,e),this.cacheSharedSecret,this.retrieveCachedSharedSecret)}deriveSymmetricKey(t,e,n){var a,o;n==="anyone"?n=this.anyone:n=this.normalizeCounterparty(n);const i=this.derivePublicKey(t,e,n),s=this.derivePrivateKey(t,e,n);return new on(((o=(a=s.deriveSharedSecret(i))==null?void 0:a.x)==null?void 0:o.toArray())??[])}revealCounterpartySecret(t){if(t==="self")throw new Error("Counterparty secrets cannot be revealed for counterparty=self.");t=this.normalizeCounterparty(t);const e=this.rootKey.toPublicKey(),n=this.rootKey.deriveChild(e,"test").toHex(),i=this.rootKey.deriveChild(t,"test").toHex();if(n===i)throw new Error("Counterparty secrets cannot be revealed for counterparty=self.");return this.rootKey.deriveSharedSecret(t).encode(!0)}revealSpecificSecret(t,e,n){t=this.normalizeCounterparty(t);const i=this.rootKey.deriveSharedSecret(t),s=x(this.computeInvoiceNumber(e,n),"utf8");return ie(i.encode(!0),s)}normalizeCounterparty(t){if(t==null)throw new Error("counterparty must be self, anyone or a public key!");return t==="self"?this.rootKey.toPublicKey():t==="anyone"?new et(1).toPublicKey():typeof t=="string"?st.fromString(t):t}computeInvoiceNumber(t,e){const n=t[0];if(!Number.isInteger(n)||n<0||n>2)throw new Error("Protocol security level must be 0, 1, or 2");const i=t[1].toLowerCase().trim();if(e.length>800)throw new Error("Key IDs must be 800 characters or less");if(e.length<1)throw new Error("Key IDs must be 1 character or more");if(i.length>400)if(i.startsWith("specific linkage revelation ")){if(i.length>430)throw new Error("Specific linkage revelation protocol names must be 430 characters or less")}else throw new Error("Protocol names must be 400 characters or less");if(i.length<5)throw new Error("Protocol names must be 5 characters or more");if(i.includes("  "))throw new Error('Protocol names cannot contain multiple consecutive spaces ("  ")');if(!/^[a-z0-9 ]+$/g.test(i))throw new Error("Protocol names can only contain letters, numbers and spaces");if(i.endsWith(" protocol"))throw new Error('No need to end your protocol name with " protocol"');return`${n}-${i}-${e}`}}class ls{constructor(t,e){l(this,"keyDeriver");l(this,"cache");l(this,"maxCacheSize");l(this,"rootKey");l(this,"identityKey");t==="anyone"?this.rootKey=new et(1):this.rootKey=t,this.keyDeriver=new ds(this.rootKey,(i,s,a)=>{this.cacheSet(`${i.toString()}-${s.toString()}`,a)},(i,s)=>this.cacheGet(`${i.toString()}-${s.toString()}`)),this.identityKey=this.rootKey.toPublicKey().toString(),this.cache=new Map;const n=e==null?void 0:e.maxCacheSize;this.maxCacheSize=n!=null&&!isNaN(n)&&n>0?n:1e3}derivePublicKey(t,e,n,i=!1){const s=this.generateCacheKey("derivePublicKey",t,e,n,i);if(this.cache.has(s)){const a=this.cacheGet(s);if(a===void 0)throw new Error("Cached value is undefined");return a}else{const a=this.keyDeriver.derivePublicKey(t,e,n,i);return this.cacheSet(s,a),a}}derivePrivateKey(t,e,n){const i=this.generateCacheKey("derivePrivateKey",t,e,n);if(this.cache.has(i)){const s=this.cacheGet(i);if(s===void 0)throw new Error("Cached value is undefined");return s}else{const s=this.keyDeriver.derivePrivateKey(t,e,n);return this.cacheSet(i,s),s}}deriveSymmetricKey(t,e,n){const i=this.generateCacheKey("deriveSymmetricKey",t,e,n);if(this.cache.has(i)){const s=this.cacheGet(i);if(s===void 0)throw new Error("Cached value is undefined");return s}else{const s=this.keyDeriver.deriveSymmetricKey(t,e,n);return this.cacheSet(i,s),s}}revealCounterpartySecret(t){const e=this.generateCacheKey("revealCounterpartySecret",t);if(this.cache.has(e)){const n=this.cacheGet(e);if(n===void 0)throw new Error("Cached value is undefined");return n}else{const n=this.keyDeriver.revealCounterpartySecret(t);return this.cacheSet(e,n),n}}revealSpecificSecret(t,e,n){const i=this.generateCacheKey("revealSpecificSecret",t,e,n);if(this.cache.has(i)){const s=this.cacheGet(i);if(s===void 0)throw new Error("Cached value is undefined");return s}else{const s=this.keyDeriver.revealSpecificSecret(t,e,n);return this.cacheSet(i,s),s}}generateCacheKey(t,...e){const n=e.map(i=>this.serializeArgument(i)).join("|");return`${t}|${n}`}serializeArgument(t){return t instanceof st||t instanceof et?t.toString():Array.isArray(t)?t.map(e=>this.serializeArgument(e)).join(","):typeof t=="object"&&t!==null?JSON.stringify(t):String(t)}cacheGet(t){const e=this.cache.get(t);return this.cache.delete(t),e!==void 0&&this.cache.set(t,e),e}cacheSet(t,e){if(this.cache.size>=this.maxCacheSize){const n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(t,e)}}class bs{constructor(t){l(this,"keyDeriver");typeof t.identityKey!="string"&&(t=new ls(t)),this.keyDeriver=t}async getPublicKey(t){if(t.identityKey){if(this.keyDeriver==null)throw new Error("keyDeriver is undefined");return{publicKey:this.keyDeriver.rootKey.toPublicKey().toString()}}else{if(t.protocolID==null||t.keyID==null||t.keyID==="")throw new Error("protocolID and keyID are required if identityKey is false or undefined.");return{publicKey:(this.keyDeriver??(()=>{throw new Error("keyDeriver is undefined")})()).derivePublicKey(t.protocolID,t.keyID,t.counterparty??"self",t.forSelf).toString()}}}async revealCounterpartyKeyLinkage(t){const{publicKey:e}=await this.getPublicKey({identityKey:!0});if(this.keyDeriver==null)throw new Error("keyDeriver is undefined");const n=this.keyDeriver.revealCounterpartySecret(t.counterparty),i=new Yr().generateProof(this.keyDeriver.rootKey,this.keyDeriver.rootKey.toPublicKey(),st.fromString(t.counterparty),C.fromDER(n)),s=[...i.R.encode(!0),...i.SPrime.encode(!0),...i.z.toArray()],a=new Date().toISOString(),{ciphertext:o}=await this.encrypt({plaintext:n,protocolID:[2,"counterparty linkage revelation"],keyID:a,counterparty:t.verifier}),{ciphertext:c}=await this.encrypt({plaintext:s,protocolID:[2,"counterparty linkage revelation"],keyID:a,counterparty:t.verifier});return{prover:e,verifier:t.verifier,counterparty:t.counterparty,revelationTime:a,encryptedLinkage:o,encryptedLinkageProof:c}}async revealSpecificKeyLinkage(t){const{publicKey:e}=await this.getPublicKey({identityKey:!0});if(this.keyDeriver==null)throw new Error("keyDeriver is undefined");const n=this.keyDeriver.revealSpecificSecret(t.counterparty,t.protocolID,t.keyID),{ciphertext:i}=await this.encrypt({plaintext:n,protocolID:[2,`specific linkage revelation ${t.protocolID[0]} ${t.protocolID[1]}`],keyID:t.keyID,counterparty:t.verifier}),{ciphertext:s}=await this.encrypt({plaintext:[0],protocolID:[2,`specific linkage revelation ${t.protocolID[0]} ${t.protocolID[1]}`],keyID:t.keyID,counterparty:t.verifier});return{prover:e,verifier:t.verifier,counterparty:t.counterparty,protocolID:t.protocolID,keyID:t.keyID,encryptedLinkage:i,encryptedLinkageProof:s,proofType:0}}async encrypt(t){if(this.keyDeriver==null)throw new Error("keyDeriver is undefined");return{ciphertext:this.keyDeriver.deriveSymmetricKey(t.protocolID,t.keyID,t.counterparty??"self").encrypt(t.plaintext)}}async decrypt(t,e){if(this.keyDeriver==null)throw new Error("keyDeriver is undefined");return{plaintext:this.keyDeriver.deriveSymmetricKey(t.protocolID,t.keyID,t.counterparty??"self").decrypt(t.ciphertext)}}async createHmac(t){if(this.keyDeriver==null)throw new Error("keyDeriver is undefined");const e=this.keyDeriver.deriveSymmetricKey(t.protocolID,t.keyID,t.counterparty??"self");return{hmac:ie(e.toArray(),t.data)}}async verifyHmac(t){if(this.keyDeriver==null)throw new Error("keyDeriver is undefined");const e=this.keyDeriver.deriveSymmetricKey(t.protocolID,t.keyID,t.counterparty??"self"),n=ie(e.toArray(),t.data),i=t.hmac,s=Or(x(n),x(i));if(!s){const a=new Error("HMAC is not valid");throw a.code="ERR_INVALID_HMAC",a}return{valid:s}}async createSignature(t){if(t.hashToDirectlySign==null&&t.data==null)throw new Error("args.data or args.hashToDirectlySign must be valid");const e=t.hashToDirectlySign??Et(t.data??[]),i=(this.keyDeriver??(()=>{throw new Error("keyDeriver is undefined")})()).derivePrivateKey(t.protocolID,t.keyID,t.counterparty??"anyone");return{signature:pi(new w(e),i,!0).toDER()}}async verifySignature(t){if(t.hashToDirectlyVerify==null&&t.data==null)throw new Error("args.data or args.hashToDirectlyVerify must be valid");const e=t.hashToDirectlyVerify??Et(t.data??[]),i=(this.keyDeriver??(()=>{throw new Error("keyDeriver is undefined")})()).derivePublicKey(t.protocolID,t.keyID,t.counterparty??"self",t.forSelf),s=ce(new w(e),At.fromDER(t.signature),i);if(!s){const a=new Error("Signature is not valid");throw a.code="ERR_INVALID_SIGNATURE",a}return{valid:s}}}class Ln{constructor(){l(this,"CWI");if(typeof window!="object")throw new Error("The window.CWI substrate requires a global window object.");if(typeof window.CWI!="object")throw new Error("The window.CWI interface does not appear to be bound to the window object.");this.CWI=window.CWI}async createAction(t,e){return await this.CWI.createAction(t,e)}async signAction(t,e){return await this.CWI.signAction(t,e)}async abortAction(t,e){return await this.CWI.abortAction(t,e)}async listActions(t,e){return await this.CWI.listActions(t,e)}async internalizeAction(t,e){return await this.CWI.internalizeAction(t,e)}async listOutputs(t,e){return await this.CWI.listOutputs(t,e)}async relinquishOutput(t,e){return await this.CWI.relinquishOutput(t,e)}async getPublicKey(t,e){return await this.CWI.getPublicKey(t,e)}async revealCounterpartyKeyLinkage(t,e){return await this.CWI.revealCounterpartyKeyLinkage(t,e)}async revealSpecificKeyLinkage(t,e){return await this.CWI.revealSpecificKeyLinkage(t,e)}async encrypt(t,e){return await this.CWI.encrypt(t,e)}async decrypt(t,e){return await this.CWI.decrypt(t,e)}async createHmac(t,e){return await this.CWI.createHmac(t,e)}async verifyHmac(t,e){return await this.CWI.verifyHmac(t,e)}async createSignature(t,e){return await this.CWI.createSignature(t,e)}async verifySignature(t,e){return await this.CWI.verifySignature(t,e)}async acquireCertificate(t,e){return await this.CWI.acquireCertificate(t,e)}async listCertificates(t,e){return await this.CWI.listCertificates(t,e)}async proveCertificate(t,e){return await this.CWI.proveCertificate(t,e)}async relinquishCertificate(t,e){return await this.CWI.relinquishCertificate(t,e)}async discoverByIdentityKey(t,e){return await this.CWI.discoverByIdentityKey(t,e)}async discoverByAttributes(t,e){return await this.CWI.discoverByAttributes(t,e)}async isAuthenticated(t,e){return await this.CWI.isAuthenticated(t,e)}async waitForAuthentication(t,e){return await this.CWI.waitForAuthentication(t,e)}async getHeight(t,e){return await this.CWI.getHeight(t,e)}async getHeaderForHeight(t,e){return await this.CWI.getHeaderForHeight(t,e)}async getNetwork(t,e){return await this.CWI.getNetwork(t,e)}async getVersion(t,e){return await this.CWI.getVersion(t,e)}}class cn extends Error{constructor(e,n=1,i){super(e);l(this,"code");l(this,"isError",!0);this.code=n,this.name=this.constructor.name,i!=null&&i!==""?this.stack=i:Error.captureStackTrace(this,this.constructor)}static unknownToJson(e){let n;return e.isError===!0&&String(e.name).startsWith("WERR_")?(n={name:e.name,message:e.message,isError:!0},n.name==="WERR_REVIEW_ACTIONS"?(n.reviewActionResults=e.reviewActionResults,n.sendWithResults=e.sendWithResults,n.txid=e.txid,n.tx=e.tx,n.noSendChange=e.noSendChange,n.code=5):n.name==="WERR_INVALID_PARAMETER"?(n.parameter=e.parameter,n.code=6):n.name==="WERR_INSUFFICIENT_FUNDS"&&(n.totalSatoshisNeeded=e.totalSatoshisNeeded,n.moreSatoshisNeeded=e.moreSatoshisNeeded,n.code=7)):e instanceof Error?n={name:e.constructor.name,message:e.message,isError:!0}:n={name:"WERR_UNKNOWN",message:String(e),isError:!0},JSON.stringify(n)}}var Un;(function(r){r[r.unknownError=1]="unknownError",r[r.unsupportedAction=2]="unsupportedAction",r[r.invalidHmac=3]="invalidHmac",r[r.invalidSignature=4]="invalidSignature",r[r.reviewActions=5]="reviewActions",r[r.invalidParameter=6]="invalidParameter",r[r.insufficientFunds=7]="insufficientFunds"})(Un||(Un={}));class Vn{constructor(t="*"){l(this,"domain");if(typeof window!="object")throw new Error("The XDM substrate requires a global window object.");if(typeof window.postMessage!="function")throw new Error("The window object does not seem to support postMessage calls.");this.domain=t}async invoke(t,e){return await new Promise((n,i)=>{const s=Ot(xt(12)),a=o=>{if(!(o.data.type!=="CWI"||!o.isTrusted||o.data.id!==s||o.data.isInvocation===!0))if(typeof window.removeEventListener=="function"&&window.removeEventListener("message",a),o.data.status==="error"){const c=new cn(o.data.description,o.data.code);i(c)}else n(o.data.result)};window.addEventListener("message",a),window.parent.postMessage({type:"CWI",isInvocation:!0,id:s,call:t,args:e},this.domain)})}async createAction(t){return await this.invoke("createAction",t)}async signAction(t){return await this.invoke("signAction",t)}async abortAction(t){return await this.invoke("abortAction",t)}async listActions(t){return await this.invoke("listActions",t)}async internalizeAction(t){return await this.invoke("internalizeAction",t)}async listOutputs(t){return await this.invoke("listOutputs",t)}async relinquishOutput(t){return await this.invoke("relinquishOutput",t)}async getPublicKey(t){return await this.invoke("getPublicKey",t)}async revealCounterpartyKeyLinkage(t){return await this.invoke("revealCounterpartyKeyLinkage",t)}async revealSpecificKeyLinkage(t){return await this.invoke("revealSpecificKeyLinkage",t)}async encrypt(t){return await this.invoke("encrypt",t)}async decrypt(t){return await this.invoke("decrypt",t)}async createHmac(t){return await this.invoke("createHmac",t)}async verifyHmac(t){return await this.invoke("verifyHmac",t)}async createSignature(t){return await this.invoke("createSignature",t)}async verifySignature(t){return await this.invoke("verifySignature",t)}async acquireCertificate(t){return await this.invoke("acquireCertificate",t)}async listCertificates(t){return await this.invoke("listCertificates",t)}async proveCertificate(t){return await this.invoke("proveCertificate",t)}async relinquishCertificate(t){return await this.invoke("relinquishCertificate",t)}async discoverByIdentityKey(t){return await this.invoke("discoverByIdentityKey",t)}async discoverByAttributes(t){return await this.invoke("discoverByAttributes",t)}async isAuthenticated(t){return await this.invoke("isAuthenticated",t)}async waitForAuthentication(t){return await this.invoke("waitForAuthentication",t)}async getHeight(t){return await this.invoke("getHeight",t)}async getHeaderForHeight(t){return await this.invoke("getHeaderForHeight",t)}async getNetwork(t){return await this.invoke("getNetwork",t)}async getVersion(t){return await this.invoke("getVersion",t)}}class $t{constructor(t,e,n,i,s,a,o){l(this,"type");l(this,"serialNumber");l(this,"subject");l(this,"certifier");l(this,"revocationOutpoint");l(this,"fields");l(this,"signature");this.type=t,this.serialNumber=e,this.subject=n,this.certifier=i,this.revocationOutpoint=s,this.fields=a,this.signature=o}toBinary(t=!0){const e=new B,n=x(this.type,"base64");e.write(n);const i=x(this.serialNumber,"base64");e.write(i);const s=x(this.subject,"hex");e.write(s);const a=x(this.certifier,"hex");e.write(a);const[o,c]=this.revocationOutpoint.split("."),f=x(o,"hex");e.write(f),e.writeVarIntNum(Number(c));const u=Object.keys(this.fields).sort();e.writeVarIntNum(u.length);for(const h of u){const b=this.fields[h],g=x(h,"utf8");e.writeVarIntNum(g.length),e.write(g);const p=x(b,"utf8");e.writeVarIntNum(p.length),e.write(p)}if(t&&(this.signature??"").length>0){const h=x(this.signature,"hex");e.write(h)}return e.toArray()}static fromBinary(t){const e=new tt(t),n=e.read(32),i=Ot(n),s=e.read(32),a=Ot(s),o=e.read(33),c=N(o),f=e.read(33),u=N(f),h=e.read(32),b=N(h),g=e.readVarIntNum(),p=`${b}.${g}`,m=e.readVarIntNum(),y={};for(let I=0;I<m;I++){const v=e.readVarIntNum(),E=e.read(v),_=H(E),V=e.readVarIntNum(),U=e.read(V),K=H(U);y[_]=K}let k;if(!e.eof()){const I=e.read();k=At.fromDER(I).toString("hex")}return new $t(i,a,c,u,p,y,k)}async verify(){const t=new bs("anyone"),e=this.toBinary(!1),n=this.signature??"",{valid:i}=await t.verifySignature({signature:x(n,"hex"),data:e,protocolID:[2,"certificate signature"],keyID:`${this.type} ${this.serialNumber}`,counterparty:this.certifier});return i}async sign(t){if(this.signature!=null&&this.signature.length>0)throw new Error(`Certificate has already been signed! Signature present: ${this.signature}`);this.certifier=(await t.getPublicKey({identityKey:!0})).publicKey;const e=this.toBinary(!1),{signature:n}=await t.createSignature({data:e,protocolID:[2,"certificate signature"],keyID:`${this.type} ${this.serialNumber}`});this.signature=N(n)}static getCertificateFieldEncryptionDetails(t,e){return{protocolID:[2,"certificate field encryption"],keyID:e?`${e} ${t}`:t}}static fromObject(t){return new $t(t.type,t.serialNumber,t.subject,t.certifier,t.revocationOutpoint,t.fields,t.signature)}}var Je;(function(r){r[r.createAction=1]="createAction",r[r.signAction=2]="signAction",r[r.abortAction=3]="abortAction",r[r.listActions=4]="listActions",r[r.internalizeAction=5]="internalizeAction",r[r.listOutputs=6]="listOutputs",r[r.relinquishOutput=7]="relinquishOutput",r[r.getPublicKey=8]="getPublicKey",r[r.revealCounterpartyKeyLinkage=9]="revealCounterpartyKeyLinkage",r[r.revealSpecificKeyLinkage=10]="revealSpecificKeyLinkage",r[r.encrypt=11]="encrypt",r[r.decrypt=12]="decrypt",r[r.createHmac=13]="createHmac",r[r.verifyHmac=14]="verifyHmac",r[r.createSignature=15]="createSignature",r[r.verifySignature=16]="verifySignature",r[r.acquireCertificate=17]="acquireCertificate",r[r.listCertificates=18]="listCertificates",r[r.proveCertificate=19]="proveCertificate",r[r.relinquishCertificate=20]="relinquishCertificate",r[r.discoverByIdentityKey=21]="discoverByIdentityKey",r[r.discoverByAttributes=22]="discoverByAttributes",r[r.isAuthenticated=23]="isAuthenticated",r[r.waitForAuthentication=24]="waitForAuthentication",r[r.getHeight=25]="getHeight",r[r.getHeaderForHeight=26]="getHeaderForHeight",r[r.getNetwork=27]="getNetwork",r[r.getVersion=28]="getVersion"})(Je||(Je={}));const yi=Je;class Hn{constructor(t){l(this,"wire");this.wire=t}async transmit(t,e="",n=[]){const i=new B;i.writeUInt8(yi[t]);const s=x(e,"utf8");i.writeUInt8(s.length),i.write(s),n.length>0&&i.write(n);const a=i.toArray(),o=await this.wire.transmitToWallet(a),c=new tt(o),f=c.readUInt8();if(f===0)return c.read();{const u=c.readVarIntNum(),h=c.read(u),b=H(h),g=c.readVarIntNum(),p=c.read(g),m=H(p);throw new cn(b,f,m)}}async createAction(t,e){const n=new B,i=x(t.description,"utf8");if(n.writeVarIntNum(i.length),n.write(i),t.inputBEEF!=null?(n.writeVarIntNum(t.inputBEEF.length),n.write(t.inputBEEF)):n.writeVarIntNum(-1),t.inputs!=null){n.writeVarIntNum(t.inputs.length);for(const g of t.inputs){if(n.write(this.encodeOutpoint(g.outpoint)),g.unlockingScript!=null&&g.unlockingScript!==""){const m=x(g.unlockingScript,"hex");n.writeVarIntNum(m.length),n.write(m)}else n.writeVarIntNum(-1),n.writeVarIntNum(g.unlockingScriptLength??0);const p=x(g.inputDescription,"utf8");n.writeVarIntNum(p.length),n.write(p),typeof g.sequenceNumber=="number"?n.writeVarIntNum(g.sequenceNumber):n.writeVarIntNum(-1)}}else n.writeVarIntNum(-1);if(t.outputs!=null){n.writeVarIntNum(t.outputs.length);for(const g of t.outputs){const p=x(g.lockingScript,"hex");n.writeVarIntNum(p.length),n.write(p),n.writeVarIntNum(g.satoshis);const m=x(g.outputDescription,"utf8");if(n.writeVarIntNum(m.length),n.write(m),g.basket!=null&&g.basket!==""){const y=x(g.basket,"utf8");n.writeVarIntNum(y.length),n.write(y)}else n.writeVarIntNum(-1);if(g.customInstructions!=null&&g.customInstructions!==""){const y=x(g.customInstructions,"utf8");n.writeVarIntNum(y.length),n.write(y)}else n.writeVarIntNum(-1);if(g.tags!=null){n.writeVarIntNum(g.tags.length);for(const y of g.tags){const k=x(y,"utf8");n.writeVarIntNum(k.length),n.write(k)}}else n.writeVarIntNum(-1)}}else n.writeVarIntNum(-1);if(typeof t.lockTime=="number"?n.writeVarIntNum(t.lockTime):n.writeVarIntNum(-1),typeof t.version=="number"?n.writeVarIntNum(t.version):n.writeVarIntNum(-1),t.labels!=null){n.writeVarIntNum(t.labels.length);for(const g of t.labels){const p=x(g,"utf8");n.writeVarIntNum(p.length),n.write(p)}}else n.writeVarIntNum(-1);if(t.options!=null){if(n.writeInt8(1),typeof t.options.signAndProcess=="boolean"?n.writeInt8(t.options.signAndProcess?1:0):n.writeInt8(-1),typeof t.options.acceptDelayedBroadcast=="boolean"?n.writeInt8(t.options.acceptDelayedBroadcast?1:0):n.writeInt8(-1),t.options.trustSelf==="known"?n.writeInt8(1):n.writeInt8(-1),t.options.knownTxids!=null){n.writeVarIntNum(t.options.knownTxids.length);for(const g of t.options.knownTxids){const p=x(g,"hex");n.write(p)}}else n.writeVarIntNum(-1);if(typeof t.options.returnTXIDOnly=="boolean"?n.writeInt8(t.options.returnTXIDOnly?1:0):n.writeInt8(-1),typeof t.options.noSend=="boolean"?n.writeInt8(t.options.noSend?1:0):n.writeInt8(-1),t.options.noSendChange!=null){n.writeVarIntNum(t.options.noSendChange.length);for(const g of t.options.noSendChange)n.write(this.encodeOutpoint(g))}else n.writeVarIntNum(-1);if(t.options.sendWith!=null){n.writeVarIntNum(t.options.sendWith.length);for(const g of t.options.sendWith){const p=x(g,"hex");n.write(p)}}else n.writeVarIntNum(-1);typeof t.options.randomizeOutputs=="boolean"?n.writeInt8(t.options.randomizeOutputs?1:0):n.writeInt8(-1)}else n.writeInt8(0);const s=await this.transmit("createAction",e,n.toArray()),a=new tt(s),o={};if(a.readInt8()===1){const g=a.read(32);o.txid=N(g)}if(a.readInt8()===1){const g=a.readVarIntNum();o.tx=a.read(g)}const u=a.readVarIntNum();if(u>=0){o.noSendChange=[];for(let g=0;g<u;g++){const p=this.readOutpoint(a);o.noSendChange.push(p)}}const h=a.readVarIntNum();if(h>=0){o.sendWithResults=[];for(let g=0;g<h;g++){const p=a.read(32),m=N(p),y=a.readInt8();let k="unproven";y===1?k="unproven":y===2?k="sending":y===3&&(k="failed"),o.sendWithResults.push({txid:m,status:k})}}if(a.readInt8()===1){const g=a.readVarIntNum(),p=a.read(g),m=a.readVarIntNum(),y=a.read(m);o.signableTransaction={tx:p,reference:Ot(y)}}return o}async signAction(t,e){const n=new B,i=Object.keys(t.spends);n.writeVarIntNum(i.length);for(const b of i){n.writeVarIntNum(Number(b));const g=t.spends[Number(b)],p=x(g.unlockingScript,"hex");n.writeVarIntNum(p.length),n.write(p),typeof g.sequenceNumber=="number"?n.writeVarIntNum(g.sequenceNumber):n.writeVarIntNum(-1)}const s=x(t.reference,"base64");if(n.writeVarIntNum(s.length),n.write(s),t.options!=null)if(n.writeInt8(1),typeof t.options.acceptDelayedBroadcast=="boolean"?n.writeInt8(t.options.acceptDelayedBroadcast?1:0):n.writeInt8(-1),typeof t.options.returnTXIDOnly=="boolean"?n.writeInt8(t.options.returnTXIDOnly?1:0):n.writeInt8(-1),typeof t.options.noSend=="boolean"?n.writeInt8(t.options.noSend?1:0):n.writeInt8(-1),t.options.sendWith!=null){n.writeVarIntNum(t.options.sendWith.length);for(const b of t.options.sendWith){const g=x(b,"hex");n.write(g)}}else n.writeVarIntNum(-1);else n.writeInt8(0);const a=await this.transmit("signAction",e,n.toArray()),o=new tt(a),c={};if(o.readInt8()===1){const b=o.read(32);c.txid=N(b)}if(o.readInt8()===1){const b=o.readVarIntNum();c.tx=o.read(b)}const h=o.readVarIntNum();if(h>=0){c.sendWithResults=[];for(let b=0;b<h;b++){const g=o.read(32),p=N(g),m=o.readInt8();let y="unproven";m===1?y="unproven":m===2?y="sending":m===3&&(y="failed"),c.sendWithResults.push({txid:p,status:y})}}return c}async abortAction(t,e){return await this.transmit("abortAction",e,x(t.reference,"base64")),{aborted:!0}}async listActions(t,e){const n=new B;n.writeVarIntNum(t.labels.length);for(const f of t.labels){const u=x(f,"utf8");n.writeVarIntNum(u.length),n.write(u)}t.labelQueryMode==="any"?n.writeInt8(1):t.labelQueryMode==="all"?n.writeInt8(2):n.writeInt8(-1);const i=[t.includeLabels,t.includeInputs,t.includeInputSourceLockingScripts,t.includeInputUnlockingScripts,t.includeOutputs,t.includeOutputLockingScripts];for(const f of i)typeof f=="boolean"?n.writeInt8(f?1:0):n.writeInt8(-1);typeof t.limit=="number"?n.writeVarIntNum(t.limit):n.writeVarIntNum(-1),typeof t.offset=="number"?n.writeVarIntNum(t.offset):n.writeVarIntNum(-1),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1);const s=await this.transmit("listActions",e,n.toArray()),a=new tt(s),o=a.readVarIntNum(),c=[];for(let f=0;f<o;f++){const u=a.read(32),h=N(u),b=a.readVarIntNum(),g=a.readInt8();let p;switch(g){case 1:p="completed";break;case 2:p="unprocessed";break;case 3:p="sending";break;case 4:p="unproven";break;case 5:p="unsigned";break;case 6:p="nosend";break;case 7:p="nonfinal";break;case 8:p="failed";break;default:throw new Error(`Unknown status code: ${g}`)}const m=a.readInt8()===1,y=a.readVarIntNum(),k=a.read(y),I=H(k),v={txid:h,satoshis:b,status:p,isOutgoing:m,description:I,version:0,lockTime:0},E=a.readVarIntNum();if(E>=0){v.labels=[];for(let U=0;U<E;U++){const K=a.readVarIntNum(),L=a.read(K);v.labels.push(H(L))}}v.version=a.readVarIntNum(),v.lockTime=a.readVarIntNum();const _=a.readVarIntNum();if(_>=0){v.inputs=[];for(let U=0;U<_;U++){const K=this.readOutpoint(a),L=a.readVarIntNum(),W=a.readVarIntNum();let Q;if(W>=0){const X=a.read(W);Q=N(X)}const G=a.readVarIntNum();let $;if(G>=0){const X=a.read(G);$=N(X)}const at=a.readVarIntNum(),O=a.read(at),S=H(O),R=a.readVarIntNum();v.inputs.push({sourceOutpoint:K,sourceSatoshis:L,sourceLockingScript:Q,unlockingScript:$,inputDescription:S,sequenceNumber:R})}}const V=a.readVarIntNum();if(V>=0){v.outputs=[];for(let U=0;U<V;U++){const K=a.readVarIntNum(),L=a.readVarIntNum(),W=a.readVarIntNum();let Q;if(W>=0){const bt=a.read(W);Q=N(bt)}const G=a.readInt8()===1,$=a.readVarIntNum(),at=a.read($),O=H(at),S=a.readVarIntNum();let R;if(S>=0){const bt=a.read(S);R=H(bt)}const X=a.readVarIntNum(),it=[];if(X>=0)for(let bt=0;bt<X;bt++){const ln=a.readVarIntNum(),he=a.read(ln);it.push(H(he))}const Dt=a.readVarIntNum();let Ce;if(Dt>=0){const bt=a.read(Dt);Ce=H(bt)}v.outputs.push({outputIndex:K,satoshis:L,lockingScript:Q,spendable:G,outputDescription:O,basket:R,tags:it,customInstructions:Ce})}}c.push(v)}return{totalActions:o,actions:c}}async internalizeAction(t,e){var s,a,o;const n=new B;n.writeVarIntNum(t.tx.length),n.write(t.tx),n.writeVarIntNum(t.outputs.length);for(const c of t.outputs)if(n.writeVarIntNum(c.outputIndex),c.protocol==="wallet payment"){if(c.paymentRemittance==null)throw new Error("Payment remittance is required for wallet payment");n.writeUInt8(1),n.write(x(c.paymentRemittance.senderIdentityKey,"hex"));const f=x(c.paymentRemittance.derivationPrefix,"base64");n.writeVarIntNum(f.length),n.write(f);const u=x(c.paymentRemittance.derivationSuffix,"base64");n.writeVarIntNum(u.length),n.write(u)}else{n.writeUInt8(2);const f=x((s=c.insertionRemittance)==null?void 0:s.basket,"utf8");if(n.writeVarIntNum(f.length),n.write(f),typeof((a=c.insertionRemittance)==null?void 0:a.customInstructions)=="string"&&c.insertionRemittance.customInstructions!==""){const u=x(c.insertionRemittance.customInstructions,"utf8");n.writeVarIntNum(u.length),n.write(u)}else n.writeVarIntNum(-1);if(typeof((o=c.insertionRemittance)==null?void 0:o.tags)=="object"){n.writeVarIntNum(c.insertionRemittance.tags.length);for(const u of c.insertionRemittance.tags){const h=x(u,"utf8");n.writeVarIntNum(h.length),n.write(h)}}else n.writeVarIntNum(0)}if(typeof t.labels=="object"){n.writeVarIntNum(t.labels.length);for(const c of t.labels){const f=x(c,"utf8");n.writeVarIntNum(f.length),n.write(f)}}else n.writeVarIntNum(-1);const i=x(t.description);return n.writeVarIntNum(i.length),n.write(i),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1),await this.transmit("internalizeAction",e,n.toArray()),{accepted:!0}}async listOutputs(t,e){const n=new B,i=x(t.basket,"utf8");if(n.writeVarIntNum(i.length),n.write(i),typeof t.tags=="object"){n.writeVarIntNum(t.tags.length);for(const h of t.tags){const b=x(h,"utf8");n.writeVarIntNum(b.length),n.write(b)}}else n.writeVarIntNum(0);t.tagQueryMode==="all"?n.writeInt8(1):t.tagQueryMode==="any"?n.writeInt8(2):n.writeInt8(-1),t.include==="locking scripts"?n.writeInt8(1):t.include==="entire transactions"?n.writeInt8(2):n.writeInt8(-1),typeof t.includeCustomInstructions=="boolean"?n.writeInt8(t.includeCustomInstructions?1:0):n.writeInt8(-1),typeof t.includeTags=="boolean"?n.writeInt8(t.includeTags?1:0):n.writeInt8(-1),typeof t.includeLabels=="boolean"?n.writeInt8(t.includeLabels?1:0):n.writeInt8(-1),typeof t.limit=="number"?n.writeVarIntNum(t.limit):n.writeVarIntNum(-1),typeof t.offset=="number"?n.writeVarIntNum(t.offset):n.writeVarIntNum(-1),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1);const s=await this.transmit("listOutputs",e,n.toArray()),a=new tt(s),o=a.readVarIntNum(),c=a.readVarIntNum();let f;c>=0&&(f=a.read(c));const u=[];for(let h=0;h<o;h++){const b=this.readOutpoint(a),g=a.readVarIntNum(),p={spendable:!0,outpoint:b,satoshis:g},m=a.readVarIntNum();m>=0&&(p.lockingScript=N(a.read(m)));const y=a.readVarIntNum();y>=0&&(p.customInstructions=H(a.read(y)));const k=a.readVarIntNum();if(k!==-1){const v=[];for(let E=0;E<k;E++){const _=a.readVarIntNum();v.push(H(a.read(_)))}p.tags=v}const I=a.readVarIntNum();if(I!==-1){const v=[];for(let E=0;E<I;E++){const _=a.readVarIntNum();v.push(H(a.read(_)))}p.labels=v}u.push(p)}return{totalOutputs:o,BEEF:f,outputs:u}}async relinquishOutput(t,e){const n=new B,i=x(t.basket,"utf8");return n.writeVarIntNum(i.length),n.write(i),n.write(this.encodeOutpoint(t.output)),await this.transmit("relinquishOutput",e,n.toArray()),{relinquished:!0}}encodeOutpoint(t){const e=new B,[n,i]=t.split(".");return e.write(x(n,"hex")),e.writeVarIntNum(Number(i)),e.toArray()}readOutpoint(t){const e=N(t.read(32)),n=t.readVarIntNum();return`${e}.${n}`}async getPublicKey(t,e){const n=new B;n.writeUInt8(t.identityKey?1:0),t.identityKey?n.write(this.encodePrivilegedParams(t.privileged,t.privilegedReason)):(n.write(this.encodeKeyRelatedParams(t.protocolID??(t.protocolID=[Qe.Silent,"default"]),t.keyID??(t.keyID=""),t.counterparty,t.privileged,t.privilegedReason)),typeof t.forSelf=="boolean"?n.writeInt8(t.forSelf?1:0):n.writeInt8(-1)),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1);const i=await this.transmit("getPublicKey",e,n.toArray());return{publicKey:N(i)}}async revealCounterpartyKeyLinkage(t,e){const n=new B;n.write(this.encodePrivilegedParams(t.privileged,t.privilegedReason)),n.write(x(t.counterparty,"hex")),n.write(x(t.verifier,"hex"));const i=await this.transmit("revealCounterpartyKeyLinkage",e,n.toArray()),s=new tt(i),a=N(s.read(33)),o=N(s.read(33)),c=N(s.read(33)),f=s.readVarIntNum(),u=H(s.read(f)),h=s.readVarIntNum(),b=s.read(h),g=s.readVarIntNum(),p=s.read(g);return{prover:a,verifier:o,counterparty:c,revelationTime:u,encryptedLinkage:b,encryptedLinkageProof:p}}async revealSpecificKeyLinkage(t,e){const n=new B;n.write(this.encodeKeyRelatedParams(t.protocolID,t.keyID,t.counterparty,t.privileged,t.privilegedReason)),n.write(x(t.verifier,"hex"));const i=await this.transmit("revealSpecificKeyLinkage",e,n.toArray()),s=new tt(i),a=N(s.read(33)),o=N(s.read(33)),c=N(s.read(33)),f=s.readUInt8(),u=s.readVarIntNum(),h=H(s.read(u)),b=s.readVarIntNum(),g=H(s.read(b)),p=s.readVarIntNum(),m=s.read(p),y=s.readVarIntNum(),k=s.read(y),I=s.readUInt8();return{prover:a,verifier:o,counterparty:c,protocolID:[f,h],keyID:g,encryptedLinkage:m,encryptedLinkageProof:k,proofType:I}}async encrypt(t,e){const n=new B;return n.write(this.encodeKeyRelatedParams(t.protocolID,t.keyID,t.counterparty,t.privileged,t.privilegedReason)),n.writeVarIntNum(t.plaintext.length),n.write(t.plaintext),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1),{ciphertext:await this.transmit("encrypt",e,n.toArray())}}async decrypt(t,e){const n=new B;return n.write(this.encodeKeyRelatedParams(t.protocolID,t.keyID,t.counterparty,t.privileged,t.privilegedReason)),n.writeVarIntNum(t.ciphertext.length),n.write(t.ciphertext),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1),{plaintext:await this.transmit("decrypt",e,n.toArray())}}async createHmac(t,e){const n=new B;return n.write(this.encodeKeyRelatedParams(t.protocolID,t.keyID,t.counterparty,t.privileged,t.privilegedReason)),n.writeVarIntNum(t.data.length),n.write(t.data),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1),{hmac:await this.transmit("createHmac",e,n.toArray())}}async verifyHmac(t,e){const n=new B;return n.write(this.encodeKeyRelatedParams(t.protocolID,t.keyID,t.counterparty,t.privileged,t.privilegedReason)),n.write(t.hmac),n.writeVarIntNum(t.data.length),n.write(t.data),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1),await this.transmit("verifyHmac",e,n.toArray()),{valid:!0}}async createSignature(t,e){const n=new B;return n.write(this.encodeKeyRelatedParams(t.protocolID,t.keyID,t.counterparty,t.privileged,t.privilegedReason)),typeof t.data=="object"?(n.writeUInt8(1),n.writeVarIntNum(t.data.length),n.write(t.data)):(n.writeUInt8(2),n.write(t.hashToDirectlySign??(t.hashToDirectlySign=[]))),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1),{signature:await this.transmit("createSignature",e,n.toArray())}}async verifySignature(t,e){const n=new B;return n.write(this.encodeKeyRelatedParams(t.protocolID,t.keyID,t.counterparty,t.privileged,t.privilegedReason)),typeof t.forSelf=="boolean"?n.writeInt8(t.forSelf?1:0):n.writeInt8(-1),n.writeVarIntNum(t.signature.length),n.write(t.signature),typeof t.data=="object"?(n.writeUInt8(1),n.writeVarIntNum(t.data.length),n.write(t.data)):(n.writeUInt8(2),n.write(t.hashToDirectlyVerify??[])),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1),await this.transmit("verifySignature",e,n.toArray()),{valid:!0}}encodeKeyRelatedParams(t,e,n,i,s){const a=new B;a.writeUInt8(t[0]);const o=x(t[1],"utf8");a.writeVarIntNum(o.length),a.write(o);const c=x(e,"utf8");return a.writeVarIntNum(c.length),a.write(c),typeof n!="string"?a.writeUInt8(0):n==="self"?a.writeUInt8(11):n==="anyone"?a.writeUInt8(12):a.write(x(n,"hex")),a.write(this.encodePrivilegedParams(i,s)),a.toArray()}async acquireCertificate(t,e){var o;const n=new B;n.write(x(t.type,"base64")),n.write(x(t.certifier,"hex"));const i=Object.entries(t.fields);n.writeVarIntNum(i.length);for(const[c,f]of i){const u=x(c,"utf8"),h=x(f,"utf8");n.writeVarIntNum(u.length),n.write(u),n.writeVarIntNum(h.length),n.write(h)}if(n.write(this.encodePrivilegedParams(t.privileged,t.privilegedReason)),n.writeUInt8(t.acquisitionProtocol==="direct"?1:2),t.acquisitionProtocol==="direct"){n.write(x(t.serialNumber,"base64")),n.write(this.encodeOutpoint(t.revocationOutpoint??""));const c=x(t.signature,"hex");n.writeVarIntNum(c.length),n.write(c);const f=t.keyringRevealer!=="certifier"?x(t.keyringRevealer,"hex"):[11];n.write(f);const u=Object.keys(t.keyringForSubject??{});n.writeVarIntNum(u.length);for(let h=0;h<u.length;h++){const b=x(u[h],"utf8");n.writeVarIntNum(b.length),n.write(b);const g=x((o=t.keyringForSubject)==null?void 0:o[u[h]],"base64");n.writeVarIntNum(g.length),n.write(g)}}else{const c=x(t.certifierUrl,"utf8");n.writeVarIntNum(c.length),n.write(c)}const s=await this.transmit("acquireCertificate",e,n.toArray()),a=$t.fromBinary(s);return{...a,signature:a.signature}}encodePrivilegedParams(t,e){const n=new B;if(typeof t=="boolean"?n.writeInt8(t?1:0):n.writeInt8(-1),typeof e=="string"){const i=x(e,"utf8");n.writeInt8(i.length),n.write(i)}else n.writeInt8(-1);return n.toArray()}async listCertificates(t,e){const n=new B;n.writeVarIntNum(t.certifiers.length);for(let c=0;c<t.certifiers.length;c++)n.write(x(t.certifiers[c],"hex"));n.writeVarIntNum(t.types.length);for(let c=0;c<t.types.length;c++)n.write(x(t.types[c],"base64"));typeof t.limit=="number"?n.writeVarIntNum(t.limit):n.writeVarIntNum(-1),typeof t.offset=="number"?n.writeVarIntNum(t.offset):n.writeVarIntNum(-1),n.write(this.encodePrivilegedParams(t.privileged,t.privilegedReason));const i=await this.transmit("listCertificates",e,n.toArray()),s=new tt(i),a=s.readVarIntNum(),o=[];for(let c=0;c<a;c++){const f=s.readVarIntNum(),u=s.read(f),h=$t.fromBinary(u),b={};if(s.readInt8()===1){const m=s.readVarIntNum();for(let y=0;y<m;y++){const k=s.readVarIntNum(),I=H(s.read(k)),v=s.readVarIntNum();b[I]=Ot(s.read(v))}}const g=s.readVarIntNum();let p;g>0&&(p=H(s.read(g))),o.push({...h,signature:h.signature,keyring:b,verifier:p})}return{totalCertificates:a,certificates:o}}async proveCertificate(t,e){const n=new B,i=x(t.certificate.type,"base64");n.write(i);const s=x(t.certificate.subject,"hex");n.write(s);const a=x(t.certificate.serialNumber,"base64");n.write(a);const o=x(t.certificate.certifier,"hex");n.write(o);const c=this.encodeOutpoint(t.certificate.revocationOutpoint??"");n.write(c);const f=x(t.certificate.signature,"hex");n.writeVarIntNum(f.length),n.write(f);const u=Object.entries(t.certificate.fields??{});n.writeVarIntNum(u.length);for(const[m,y]of u){const k=x(m,"utf8"),I=x(y,"utf8");n.writeVarIntNum(k.length),n.write(k),n.writeVarIntNum(I.length),n.write(I)}n.writeVarIntNum(t.fieldsToReveal.length);for(const m of t.fieldsToReveal){const y=x(m,"utf8");n.writeVarIntNum(y.length),n.write(y)}n.write(x(t.verifier,"hex")),n.write(this.encodePrivilegedParams(t.privileged,t.privilegedReason));const h=await this.transmit("proveCertificate",e,n.toArray()),b=new tt(h),g=b.readVarIntNum(),p={};for(let m=0;m<g;m++){const y=b.readVarIntNum(),k=H(b.read(y)),I=b.readVarIntNum();p[k]=Ot(b.read(I))}return{keyringForVerifier:p}}async relinquishCertificate(t,e){const n=new B,i=x(t.type,"base64");n.write(i);const s=x(t.serialNumber,"base64");n.write(s);const a=x(t.certifier,"hex");return n.write(a),await this.transmit("relinquishCertificate",e,n.toArray()),{relinquished:!0}}parseDiscoveryResult(t){const e=new tt(t),n=e.readVarIntNum(),i=[];for(let s=0;s<n;s++){const a=e.readVarIntNum(),o=e.read(a),c=$t.fromBinary(o),f=e.readVarIntNum(),u=H(e.read(f)),h=e.readVarIntNum(),b=H(e.read(h)),g=e.readVarIntNum(),p=H(e.read(g)),m=e.readUInt8(),y={},k=e.readVarIntNum();for(let E=0;E<k;E++){const _=e.readVarIntNum(),V=H(e.read(_)),U=e.readVarIntNum();y[V]=e.read(U)}const I={},v=e.readVarIntNum();for(let E=0;E<v;E++){const _=e.readVarIntNum(),V=H(e.read(_)),U=e.readVarIntNum();I[V]=H(e.read(U))}i.push({...c,signature:c.signature,certifierInfo:{iconUrl:b,name:u,description:p,trust:m},publiclyRevealedKeyring:y,decryptedFields:I})}return{totalCertificates:n,certificates:i}}async discoverByIdentityKey(t,e){const n=new B;n.write(x(t.identityKey,"hex")),typeof t.limit=="number"?n.writeVarIntNum(t.limit):n.writeVarIntNum(-1),typeof t.offset=="number"?n.writeVarIntNum(t.offset):n.writeVarIntNum(-1),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1);const i=await this.transmit("discoverByIdentityKey",e,n.toArray());return this.parseDiscoveryResult(i)}async discoverByAttributes(t,e){const n=new B,i=Object.keys(t.attributes);n.writeVarIntNum(i.length);for(let a=0;a<i.length;a++)n.writeVarIntNum(i[a].length),n.write(x(i[a],"utf8")),n.writeVarIntNum(t.attributes[i[a]].length),n.write(x(t.attributes[i[a]],"utf8"));typeof t.limit=="number"?n.writeVarIntNum(t.limit):n.writeVarIntNum(-1),typeof t.offset=="number"?n.writeVarIntNum(t.offset):n.writeVarIntNum(-1),n.writeInt8(typeof t.seekPermission=="boolean"?t.seekPermission?1:0:-1);const s=await this.transmit("discoverByAttributes",e,n.toArray());return this.parseDiscoveryResult(s)}async isAuthenticated(t,e){return{authenticated:(await this.transmit("isAuthenticated",e))[0]===1}}async waitForAuthentication(t,e){return await this.transmit("waitForAuthentication",e),{authenticated:!0}}async getHeight(t,e){const n=await this.transmit("getHeight",e);return{height:new tt(n).readVarIntNum()}}async getHeaderForHeight(t,e){const n=new B;n.writeVarIntNum(t.height);const i=await this.transmit("getHeaderForHeight",e,n.toArray());return{header:N(i)}}async getNetwork(t,e){return{network:(await this.transmit("getNetwork",e))[0]===0?"mainnet":"testnet"}}async getVersion(t,e){const n=await this.transmit("getVersion",e);return{version:H(n)}}}class Dn{constructor(t,e="http://localhost:3301",n=fetch){l(this,"baseUrl");l(this,"httpClient");l(this,"originator");this.baseUrl=e,this.httpClient=n,this.originator=t}async transmitToWallet(t){const e=new tt(t),n=e.readUInt8(),i=yi[n];if(i===void 0||i==="")throw new Error(`Invalid call code: ${n}`);const s=e.readUInt8();let a;if(s>0){const u=e.read(s);a=H(u)}const o=e.read(),f=await(await fetch(`${this.baseUrl}/${i}`,{method:"POST",headers:{"Content-Type":"application/octet-stream",Origin:a??""},body:new Uint8Array(o)})).arrayBuffer();return Array.from(new Uint8Array(f))}}class ps extends Error{constructor(e,n,i,s,a){super("Undelayed createAction or signAction results require review.");l(this,"reviewActionResults");l(this,"sendWithResults");l(this,"txid");l(this,"tx");l(this,"noSendChange");l(this,"code");l(this,"isError",!0);this.reviewActionResults=e,this.sendWithResults=n,this.txid=i,this.tx=s,this.noSendChange=a,this.code=5,this.name=this.constructor.name}}class T extends Error{constructor(e,n){super(`The ${e} parameter must be ${n??"valid."}`);l(this,"parameter");l(this,"code");l(this,"isError",!0);this.parameter=e,this.code=6,this.name=this.constructor.name}}function gs(r,t="http"){if(/^[a-z][a-z0-9+.-]*:\/\//i.test(r))try{return new URL(r).origin}catch{}try{return new URL(`${t}://${r}`).origin}catch{throw new Error(`Invalid originator value: ${r}`)}}class ws extends Error{constructor(e,n){super(`Insufficient funds in the available inputs to cover the cost of the required outputs and the transaction fee (${n} more satoshis are needed, for a total of ${e}), plus whatever would be required in order to pay the fee to unlock and spend the outputs used to provide the additional satoshis.`);l(this,"totalSatoshisNeeded");l(this,"moreSatoshisNeeded");l(this,"code");l(this,"isError",!0);this.totalSatoshisNeeded=e,this.moreSatoshisNeeded=n,this.code=7,this.name=this.constructor.name}}class ge{constructor(t,e="http://localhost:3321",n=fetch){l(this,"baseUrl");l(this,"httpClient");l(this,"originator");l(this,"api");this.baseUrl=e,this.originator=t,this.httpClient=n;const i=typeof window<"u"&&typeof document<"u"&&(window==null?void 0:window.origin)!=="file://";this.api=async(s,a)=>{const o=!i&&this.originator?gs(this.originator,"http"):void 0;!i&&o===void 0&&console.error("Originator is required in Node.js environments");const c=await await n(`${this.baseUrl}/${s}`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",...o?{Origin:o}:{},...o?{Originator:o}:{}},body:JSON.stringify(a)}),f=await c.json();if(!c.ok){if(c.status===400&&f.isError){let h;switch(f.code){case 5:h=new ps(f.reviewActionResults,f.sendWithResults,f.txid,f.tx,f.noSendChange);break;case 6:h=new T(f.parameter),h.message=f.message;break;case 7:h=new ws(f.totalSatoshisNeeded,f.moreSatoshisNeeded);break}if(h)throw h}const u={call:s,args:a,message:f.message??`HTTP Client error ${c.status}`};throw new Error(JSON.stringify(u))}return f}}async createAction(t){return await this.api("createAction",t)}async signAction(t){return await this.api("signAction",t)}async abortAction(t){return await this.api("abortAction",t)}async listActions(t){return await this.api("listActions",t)}async internalizeAction(t){return await this.api("internalizeAction",t)}async listOutputs(t){return await this.api("listOutputs",t)}async relinquishOutput(t){return await this.api("relinquishOutput",t)}async getPublicKey(t){return await this.api("getPublicKey",t)}async revealCounterpartyKeyLinkage(t){return await this.api("revealCounterpartyKeyLinkage",t)}async revealSpecificKeyLinkage(t){return await this.api("revealSpecificKeyLinkage",t)}async encrypt(t){return await this.api("encrypt",t)}async decrypt(t){return await this.api("decrypt",t)}async createHmac(t){return await this.api("createHmac",t)}async verifyHmac(t){return await this.api("verifyHmac",t)}async createSignature(t){return await this.api("createSignature",t)}async verifySignature(t){return await this.api("verifySignature",t)}async acquireCertificate(t){return await this.api("acquireCertificate",t)}async listCertificates(t){return await this.api("listCertificates",t)}async proveCertificate(t){return await this.api("proveCertificate",t)}async relinquishCertificate(t){return await this.api("relinquishCertificate",t)}async discoverByIdentityKey(t){return await this.api("discoverByIdentityKey",t)}async discoverByAttributes(t){return await this.api("discoverByAttributes",t)}async isAuthenticated(t){return await this.api("isAuthenticated",t)}async waitForAuthentication(t){return await this.api("waitForAuthentication",t)}async getHeight(t){return await this.api("getHeight",t)}async getHeaderForHeight(t){return await this.api("getHeaderForHeight",t)}async getNetwork(t){return await this.api("getNetwork",t)}async getVersion(t){return await this.api("getVersion",t)}}class Mn{constructor(t="*"){l(this,"domain");if(typeof window!="object")throw new Error("The XDM substrate requires a global window object.");if(!window.hasOwnProperty("ReactNativeWebView"))throw new Error("The window object does not have a ReactNativeWebView property.");if(typeof window.ReactNativeWebView.postMessage!="function")throw new Error("The window.ReactNativeWebView property does not seem to support postMessage calls.");this.domain=t}async invoke(t,e){return await new Promise((n,i)=>{const s=Ot(xt(12)),a=o=>{const c=JSON.parse(o.data);if(!(c.type!=="CWI"||c.id!==s||c.isInvocation===!0))if(typeof window.removeEventListener=="function"&&window.removeEventListener("message",a),c.status==="error"){const f=new cn(c.description,c.code);i(f)}else n(c.result)};window.addEventListener("message",a),window.ReactNativeWebView.postMessage(JSON.stringify({type:"CWI",isInvocation:!0,id:s,call:t,args:e}))})}async createAction(t){return await this.invoke("createAction",t)}async signAction(t){return await this.invoke("signAction",t)}async abortAction(t){return await this.invoke("abortAction",t)}async listActions(t){return await this.invoke("listActions",t)}async internalizeAction(t){return await this.invoke("internalizeAction",t)}async listOutputs(t){return await this.invoke("listOutputs",t)}async relinquishOutput(t){return await this.invoke("relinquishOutput",t)}async getPublicKey(t){return await this.invoke("getPublicKey",t)}async revealCounterpartyKeyLinkage(t){return await this.invoke("revealCounterpartyKeyLinkage",t)}async revealSpecificKeyLinkage(t){return await this.invoke("revealSpecificKeyLinkage",t)}async encrypt(t){return await this.invoke("encrypt",t)}async decrypt(t){return await this.invoke("decrypt",t)}async createHmac(t){return await this.invoke("createHmac",t)}async verifyHmac(t){return await this.invoke("verifyHmac",t)}async createSignature(t){return await this.invoke("createSignature",t)}async verifySignature(t){return await this.invoke("verifySignature",t)}async acquireCertificate(t){return await this.invoke("acquireCertificate",t)}async listCertificates(t){return await this.invoke("listCertificates",t)}async proveCertificate(t){return await this.invoke("proveCertificate",t)}async relinquishCertificate(t){return await this.invoke("relinquishCertificate",t)}async discoverByIdentityKey(t){return await this.invoke("discoverByIdentityKey",t)}async discoverByAttributes(t){return await this.invoke("discoverByAttributes",t)}async isAuthenticated(t){return await this.invoke("isAuthenticated",t)}async waitForAuthentication(t){return await this.invoke("waitForAuthentication",t)}async getHeight(t){return await this.invoke("getHeight",t)}async getHeaderForHeight(t){return await this.invoke("getHeaderForHeight",t)}async getNetwork(t){return await this.invoke("getNetwork",t)}async getVersion(t){return await this.invoke("getVersion",t)}}function xi(r){const[t,e]=r.split(".");return{txid:t,vout:Number(e)}}function Vt(r){return r??!0}function z(r){return r??!1}function Be(r){return r??0}function ms(r){return r??4294967295}function ys(r){return r??1}function ft(r){return r??[]}function fe(r,t,e,n){if(r!==void 0)return dt(r,t,e,n)}function xs(r,t,e){if(r===void 0||!Number.isInteger(r)||r<0||r>21e14)throw new T(t,"a valid number of satoshis");return r}function Bt(r,t,e,n,i){if(r===void 0){if(e!==void 0)return e;throw new T(t,"a valid integer")}if(!Number.isInteger(r))throw new T(t,"an integer");if(r=Number(r),n!==void 0&&r<n)throw new T(t,`at least ${n} length.`);if(i!==void 0&&r>i)throw new T(t,`no more than ${i} length.`);return r}function ue(r,t){return Bt(r,t,0,0)}function dt(r,t,e,n){const i=x(r,"utf8").length;if(e!==void 0&&i<e)throw new T(t,`at least ${e} length.`);if(n!==void 0&&i>n)throw new T(t,`no more than ${n} length.`);return r}function Is(r){if(r!==void 0)return fn(r)}function fn(r){return hn(r,"basket",1,300)}function un(r){return hn(r,"label",1,300)}function Ii(r){return hn(r,"tag",1,300)}function hn(r,t,e,n){r=r.trim().toLowerCase();const i=x(r,"utf8").length;if(i<e)throw new T(t,`at least ${e} length.`);if(i>n)throw new T(t,`no more than ${n} length.`);return r}function Fn(r,t,e,n){if(r!==void 0)return lt(r,t)}function lt(r,t,e,n){if(r=r.trim(),r.length===0)throw new T(t,"valid base64 string");let i=0;for(let a=0;a<r.length;a++){const o=r.charCodeAt(a);if(!(o>=65&&o<=90)&&!(o>=97&&o<=122)&&!(o>=48&&o<=57)&&o!==43&&o!==47){if(o===61){if(a<r.length-2)throw new T(t,"valid base64 string");i++;continue}throw new T(t,"valid base64 string")}}if(i>2)throw new T(t,"valid base64 string");if(i>0&&r.length%4!==0)throw new T(t,"valid base64 string");const s=r.length%4;if(s!==0&&s!==4-i)throw new T(t,"valid base64 string");return r.length-i,r}function me(r,t,e,n){if(r!==void 0)return ut(r,t,e,n)}function ut(r,t,e,n){if(r=r.trim().toLowerCase(),r.length%2===1)throw new T(t,`even length, not ${r.length}.`);if(!/^[0-9A-Fa-f]+$/.test(r))throw new T(t,"hexadecimal string.");if(e!==void 0&&r.length<e)throw new T(t,`at least ${e} length.`);if(n!==void 0&&r.length>n)throw new T(t,`no more than ${n} length.`);return r}function Ss(r){if(r.unlockingScript===void 0&&r.unlockingScriptLength===void 0)throw new T("unlockingScript, unlockingScriptLength","at least one valid value.");const t=me(r.unlockingScript,"unlockingScript"),e=r.unlockingScriptLength??(t!=null?t.length/2:0);if(t&&e!==t.length/2)throw new T("unlockingScriptLength","length unlockingScript if both valid.");return{outpoint:xi(r.outpoint),inputDescription:dt(r.inputDescription,"inputDescription",5,2e3),unlockingScript:t,unlockingScriptLength:e,sequenceNumber:ms(r.sequenceNumber)}}function ks(r){return{lockingScript:ut(r.lockingScript,"lockingScript"),satoshis:xs(r.satoshis,"satoshis"),outputDescription:dt(r.outputDescription,"outputDescription",5,2e3),basket:Is(r.basket),customInstructions:r.customInstructions,tags:ft(r.tags).map(e=>Ii(e))}}function vs(r){const t=r??{};return{signAndProcess:Vt(t.signAndProcess),acceptDelayedBroadcast:Vt(t.acceptDelayedBroadcast),knownTxids:ft(t.knownTxids),returnTXIDOnly:z(t.returnTXIDOnly),noSend:z(t.noSend),noSendChange:ft(t.noSendChange).map(n=>xi(n)),sendWith:ft(t.sendWith),randomizeOutputs:Vt(t.randomizeOutputs)}}function Os(r,t){var n;const e={description:dt(r.description,"description",5,2e3),inputBEEF:r.inputBEEF,inputs:ft(r.inputs).map(i=>Ss(i)),outputs:ft(r.outputs).map(i=>ks(i)),lockTime:Be(r.lockTime),version:ys(r.version),labels:ft((n=r.labels)==null?void 0:n.map(i=>un(i))),options:vs(r.options),logger:t,isSendWith:!1,isDelayed:!1,isNoSend:!1,isNewTx:!1,isRemixChange:!1,isSignAction:!1,randomVals:void 0,includeAllSourceTransactions:!1,isTestWerrReviewActions:!1};return e.isTestWerrReviewActions=e.labels.includes(Xs),e.isSendWith=e.options.sendWith.length>0,e.isRemixChange=!e.isSendWith&&e.inputs.length===0&&e.outputs.length===0,e.isNewTx=e.isRemixChange||e.inputs.length>0||e.outputs.length>0,e.isSignAction=e.isNewTx&&(!e.options.signAndProcess||e.inputs.some(i=>i.unlockingScript===void 0)),e.isDelayed=e.options.acceptDelayedBroadcast,e.isNoSend=e.options.noSend,e}function Es(r){const t=r??{};return{acceptDelayedBroadcast:Vt(t.acceptDelayedBroadcast),returnTXIDOnly:z(t.returnTXIDOnly),noSend:z(t.noSend),sendWith:ft(t.sendWith)}}function As(r){const t={spends:r.spends,reference:r.reference,options:Es(r.options),isSendWith:!1,isDelayed:!1,isNoSend:!1,isNewTx:!0,isRemixChange:!1,isTestWerrReviewActions:!1};return t.isSendWith=t.options.sendWith.length>0,t.isDelayed=t.options.acceptDelayedBroadcast,t.isNoSend=t.options.noSend,t}function Ps(r){return{reference:lt(r.reference,"reference")}}function Ns(r){return r===void 0?void 0:{derivationPrefix:lt(r.derivationPrefix,"derivationPrefix"),derivationSuffix:lt(r.derivationSuffix,"derivationSuffix"),senderIdentityKey:ut(r.senderIdentityKey,"senderIdentityKey")}}function _s(r){return r===void 0?void 0:{basket:fn(r.basket),customInstructions:fe(r.customInstructions,"customInstructions",0,1e3),tags:ft(r.tags).map(e=>Ii(e))}}function Ts(r){if(r.protocol!=="basket insertion"&&r.protocol!=="wallet payment")throw new T("protocol","'basket insertion' or 'wallet payment'");return{outputIndex:ue(r.outputIndex,"outputIndex"),protocol:r.protocol,paymentRemittance:Ns(r.paymentRemittance),insertionRemittance:_s(r.insertionRemittance)}}function Bs(r){const t={tx:r.tx,outputs:r.outputs.map(e=>Ts(e)),description:dt(r.description,"description",5,2e3),labels:(r.labels!=null?r.labels:[]).map(e=>un(e)),seekPermission:Vt(r.seekPermission)};try{if(gt.fromBinary(t.tx).txs.length<1)throw new T("tx","at least one transaction to internalize an output from")}catch{throw new T("tx","valid with at least one transaction to internalize an output from")}if(t.outputs.length<1)throw new T("outputs","at least one output to internalize from the transaction");return t}function Cs(r,t){if(r!==void 0)return dn(r,t)}function dn(r,t){const e=r.split(".");if(e.length!==2||!Number.isInteger(Number(e[1])))throw new T(t,"txid as hex string and numeric output index joined with '.'");const n=ut(e[0],`${t} txid`,void 0,64),i=ue(Number(e[1]),`${t} vout`);return`${n}.${i}`}function Rs(r){return{basket:fn(r.basket),output:dn(r.output,"output")}}function Ls(r){return{type:lt(r.type,"type"),serialNumber:lt(r.serialNumber,"serialNumber"),certifier:ut(r.certifier,"certifier")}}function Us(r){return{certifiers:ft(r.certifiers.map(e=>ut(e.trim(),"certifiers"))),types:ft(r.types.map(e=>lt(e.trim(),"types"))),limit:Bt(r.limit,"limit",10,1,1e4),offset:ue(Be(r.offset),"offset"),privileged:z(r.privileged),privilegedReason:fe(r.privilegedReason,"privilegedReason",5,50),partial:void 0}}function Si(r){for(const t of Object.keys(r))dt(t,"field name",1,50);return r}function Vs(r,t){return r==="certifier"?r:ut(r,t)}function Hs(r,t){for(const e of Object.keys(r))dt(e,`${t} field name`,1,50),lt(r[e],`${t} field value`);return r}function Ds(r){if(r.acquisitionProtocol!=="issuance")throw new Error("Only acquire certificate via issuance requests allowed here.");if(r.serialNumber)throw new T("serialNumber",'valid when acquisitionProtocol is "direct"');if(r.signature)throw new T("signature",'valid when acquisitionProtocol is "direct"');if(r.revocationOutpoint)throw new T("revocationOutpoint",'valid when acquisitionProtocol is "direct"');if(r.keyringRevealer)throw new T("keyringRevealer",'valid when acquisitionProtocol is "direct"');if(r.keyringForSubject!=null)throw new T("keyringForSubject",'valid when acquisitionProtocol is "direct"');if(!r.certifierUrl)throw new T("certifierUrl",'valid when acquisitionProtocol is "issuance"');if(r.privileged&&!r.privilegedReason)throw new T("privilegedReason","valid when 'privileged' is true ");return{type:lt(r.type,"type"),certifier:ut(r.certifier,"certifier"),certifierUrl:r.certifierUrl,fields:Si(r.fields),privileged:z(r.privileged),privilegedReason:fe(r.privilegedReason,"privilegedReason",5,50),subject:""}}function Ms(r){if(r.acquisitionProtocol!=="direct")throw new Error("Only acquire direct certificate requests allowed here.");if(!r.serialNumber)throw new T("serialNumber",'valid when acquisitionProtocol is "direct"');if(!r.signature)throw new T("signature",'valid when acquisitionProtocol is "direct"');if(!r.revocationOutpoint)throw new T("revocationOutpoint",'valid when acquisitionProtocol is "direct"');if(!r.keyringRevealer)throw new T("keyringRevealer",'valid when acquisitionProtocol is "direct"');if(r.keyringForSubject==null)throw new T("keyringForSubject",'valid when acquisitionProtocol is "direct"');if(r.privileged&&!r.privilegedReason)throw new T("privilegedReason","valid when 'privileged' is true ");return{type:lt(r.type,"type"),serialNumber:lt(r.serialNumber,"serialNumber"),certifier:ut(r.certifier,"certifier"),revocationOutpoint:dn(r.revocationOutpoint,"revocationOutpoint"),fields:Si(r.fields),signature:ut(r.signature,"signature"),keyringRevealer:Vs(r.keyringRevealer,"keyringRevealer"),keyringForSubject:Hs(r.keyringForSubject,"keyringForSubject"),privileged:z(r.privileged),privilegedReason:fe(r.privilegedReason,"privilegedReason",5,50),subject:""}}function Fs(r){if(r.privileged&&!r.privilegedReason)throw new T("privilegedReason","valid when 'privileged' is true ");return{type:Fn(r.certificate.type,"certificate.type"),serialNumber:Fn(r.certificate.serialNumber,"certificate.serialNumber"),certifier:me(r.certificate.certifier,"certificate.certifier"),subject:me(r.certificate.subject,"certificate.subject"),revocationOutpoint:Cs(r.certificate.revocationOutpoint,"certificate.revocationOutpoint"),signature:me(r.certificate.signature,"certificate.signature"),fieldsToReveal:ft(r.fieldsToReveal).map(e=>dt(e,`fieldsToReveal ${e}`,1,50)),verifier:ut(r.verifier,"verifier"),privileged:z(r.privileged),privilegedReason:fe(r.privilegedReason,"privilegedReason",5,50)}}function qs(r){return{identityKey:ut(r.identityKey,"identityKey",66,66),limit:Bt(r.limit,"limit",10,1,1e4),offset:ue(Be(r.offset),"offset"),seekPermission:z(r.seekPermission)}}function Ks(r){for(const t of Object.keys(r))dt(t,`field name ${t}`,1,50);return r}function Ws(r){return{attributes:Ks(r.attributes),limit:Bt(r.limit,"limit",10,1,1e4),offset:ue(Be(r.offset),"offset"),seekPermission:z(r.seekPermission)}}function zs(r){let t;if(r.tagQueryMode===void 0||r.tagQueryMode==="any")t="any";else if(r.tagQueryMode==="all")t="all";else throw new T("tagQueryMode","undefined, 'any', or 'all'");return{basket:dt(r.basket,"basket",1,300),tags:(r.tags!=null?r.tags:[]).map(n=>dt(n,"tag",1,300)),tagQueryMode:t,includeLockingScripts:r.include==="locking scripts",includeTransactions:r.include==="entire transactions",includeCustomInstructions:z(r.includeCustomInstructions),includeTags:z(r.includeTags),includeLabels:z(r.includeLabels),limit:Bt(r.limit,"limit",10,1,1e4),offset:Bt(r.offset,"offset",0,void 0,void 0),seekPermission:Vt(r.seekPermission),knownTxids:[]}}function $s(r){let t;if(r.labelQueryMode===void 0||r.labelQueryMode==="any")t="any";else if(r.labelQueryMode==="all")t="all";else throw new T("labelQueryMode","undefined, 'any', or 'all'");return{labels:(r.labels!=null?r.labels:[]).map(n=>un(n)),labelQueryMode:t,includeLabels:z(r.includeLabels),includeInputs:z(r.includeInputs),includeInputSourceLockingScripts:z(r.includeInputSourceLockingScripts),includeInputUnlockingScripts:z(r.includeInputUnlockingScripts),includeOutputs:z(r.includeOutputs),includeOutputLockingScripts:z(r.includeOutputLockingScripts),limit:Bt(r.limit,"limit",10,1,1e4),offset:Bt(r.offset,"offset",0,0),seekPermission:Vt(r.seekPermission)}}const Xs="a496e747fc3ad5fabdd4ae8f91184e71f87539bd3d962aa2548942faaaf0047a",js=200;class Gs{constructor(t="auto",e){l(this,"substrate");l(this,"originator");t==="Cicada"&&(t=new Hn(new Dn(e))),t==="window.CWI"&&(t=new Ln),t==="XDM"&&(t=new Vn),t==="json-api"&&(t=new ge(e)),t==="react-native"&&(t=new Mn(e)),t==="secure-json-api"&&(t=new ge(e,"https://localhost:2121")),this.substrate=t,this.originator=e}async connectToSubstrate(){if(typeof this.substrate=="object")return;const t=async(a,o)=>{try{const c=a();let f;return typeof o=="number"?f=await Promise.race([c.getVersion({}),new Promise((u,h)=>setTimeout(()=>h(new Error("Timed out.")),o))]):f=await c.getVersion({}),typeof f!="object"||typeof f.version!="string"?{success:!1}:{success:!0,sub:c}}catch{return{success:!1}}},e=[t(()=>new Ln),t(()=>new Hn(new Dn(this.originator))),t(()=>new ge(this.originator,"https://localhost:2121")),t(()=>new ge(this.originator)),t(()=>new Mn(this.originator))],i=(await Promise.allSettled(e)).filter(a=>a.status==="fulfilled"&&a.value.success&&a.value.sub!==void 0).map(a=>a.value.sub);if(i.length>0){this.substrate=i[0];return}const s=await t(()=>new Vn,js);if(s.success&&s.sub!==void 0)this.substrate=s.sub;else throw new Error("No wallet available over any communication substrate. Install a BSV wallet today!")}async createAction(t){return Os(t),await this.connectToSubstrate(),await this.substrate.createAction(t,this.originator)}async signAction(t){return As(t),await this.connectToSubstrate(),await this.substrate.signAction(t,this.originator)}async abortAction(t){return Ps(t),await this.connectToSubstrate(),await this.substrate.abortAction(t,this.originator)}async listActions(t){return $s(t),await this.connectToSubstrate(),await this.substrate.listActions(t,this.originator)}async internalizeAction(t){return Bs(t),await this.connectToSubstrate(),await this.substrate.internalizeAction(t,this.originator)}async listOutputs(t){return zs(t),await this.connectToSubstrate(),await this.substrate.listOutputs(t,this.originator)}async relinquishOutput(t){return Rs(t),await this.connectToSubstrate(),await this.substrate.relinquishOutput(t,this.originator)}async getPublicKey(t){return await this.connectToSubstrate(),await this.substrate.getPublicKey(t,this.originator)}async revealCounterpartyKeyLinkage(t){return await this.connectToSubstrate(),await this.substrate.revealCounterpartyKeyLinkage(t,this.originator)}async revealSpecificKeyLinkage(t){return await this.connectToSubstrate(),await this.substrate.revealSpecificKeyLinkage(t,this.originator)}async encrypt(t){return await this.connectToSubstrate(),await this.substrate.encrypt(t,this.originator)}async decrypt(t){return await this.connectToSubstrate(),await this.substrate.decrypt(t,this.originator)}async createHmac(t){return await this.connectToSubstrate(),await this.substrate.createHmac(t,this.originator)}async verifyHmac(t){return await this.connectToSubstrate(),await this.substrate.verifyHmac(t,this.originator)}async createSignature(t){return await this.connectToSubstrate(),await this.substrate.createSignature(t,this.originator)}async verifySignature(t){return await this.connectToSubstrate(),await this.substrate.verifySignature(t,this.originator)}async acquireCertificate(t){if(t.acquisitionProtocol==="direct")Ms(t);else if(t.acquisitionProtocol==="issuance")Ds(t);else throw new T("acquisitionProtocol",`valid. ${String(t.acquisitionProtocol)} is unrecognized.`);return await this.connectToSubstrate(),await this.substrate.acquireCertificate(t,this.originator)}async listCertificates(t){return Us(t),await this.connectToSubstrate(),await this.substrate.listCertificates(t,this.originator)}async proveCertificate(t){return Fs(t),await this.connectToSubstrate(),await this.substrate.proveCertificate(t,this.originator)}async relinquishCertificate(t){return Ls(t),await this.connectToSubstrate(),await this.substrate.relinquishCertificate(t,this.originator)}async discoverByIdentityKey(t){return qs(t),await this.connectToSubstrate(),await this.substrate.discoverByIdentityKey(t,this.originator)}async discoverByAttributes(t){return Ws(t),await this.connectToSubstrate(),await this.substrate.discoverByAttributes(t,this.originator)}async isAuthenticated(t={}){return await this.connectToSubstrate(),await this.substrate.isAuthenticated(t,this.originator)}async waitForAuthentication(t={}){return await this.connectToSubstrate(),await this.substrate.waitForAuthentication(t,this.originator)}async getHeight(t={}){return await this.connectToSubstrate(),await this.substrate.getHeight(t,this.originator)}async getHeaderForHeight(t){return await this.connectToSubstrate(),await this.substrate.getHeaderForHeight(t,this.originator)}async getNetwork(t={}){return await this.connectToSubstrate(),await this.substrate.getNetwork(t,this.originator)}async getVersion(t={}){return await this.connectToSubstrate(),await this.substrate.getVersion(t,this.originator)}}typeof globalThis<"u"&&typeof globalThis.fetch=="function"&&globalThis.fetch.bind(globalThis);const qn=1500,Kn=.25,Ys=1e3,Zs=6e4,Qs=400,Js=30,He=2,Wn="bsvsdk_overlay_host_reputation_v1";class ta{constructor(t){l(this,"stats");l(this,"store");this.stats=new Map,this.store=t??this.getLocalStorageAdapter(),this.loadFromStorage()}reset(){this.stats.clear()}recordSuccess(t,e){const n=this.getOrCreate(t),i=Date.now(),s=Number.isFinite(e)&&e>=0?e:qn;n.avgLatencyMs===null?n.avgLatencyMs=s:n.avgLatencyMs=(1-Kn)*n.avgLatencyMs+Kn*s,n.lastLatencyMs=s,n.totalSuccesses+=1,n.consecutiveFailures=0,n.backoffUntil=0,n.lastUpdatedAt=i,n.lastError=void 0,this.saveToStorage()}recordFailure(t,e){const n=this.getOrCreate(t),i=Date.now();n.totalFailures+=1,n.consecutiveFailures+=1;const s=typeof e=="string"?e:e instanceof Error?e.message:void 0;typeof s=="string"&&(s.includes("ERR_NAME_NOT_RESOLVED")||s.includes("ENOTFOUND")||s.includes("getaddrinfo")||s.includes("Failed to fetch"))&&n.consecutiveFailures<He+1&&(n.consecutiveFailures=He+1);const o=Math.max(n.consecutiveFailures-He,0);if(o===0)n.backoffUntil=0;else{const c=Math.min(Zs,Ys*Math.pow(2,o-1));n.backoffUntil=i+c}n.lastUpdatedAt=i,n.lastError=typeof e=="string"?e:e instanceof Error?e.message:void 0,this.saveToStorage()}rankHosts(t,e=Date.now()){const n=new Map;t.forEach((a,o)=>{typeof a!="string"||a.length===0||n.has(a)||n.set(a,o)});const s=Array.from(n.keys()).map(a=>{const o=this.getOrCreate(a);return{...o,score:this.computeScore(o,e),originalOrder:n.get(a)??0}});return s.sort((a,o)=>{const c=a.backoffUntil>e,f=o.backoffUntil>e;return c!==f?c?1:-1:a.score!==o.score?a.score-o.score:a.totalSuccesses!==o.totalSuccesses?o.totalSuccesses-a.totalSuccesses:a.originalOrder-o.originalOrder}),s.map(({originalOrder:a,...o})=>o)}snapshot(t){const e=this.stats.get(t);return e!=null?{...e}:void 0}getStorage(){try{const t=typeof globalThis=="object"?globalThis:void 0;return t==null||t.localStorage==null?void 0:t.localStorage}catch{return}}getLocalStorageAdapter(){const t=this.getStorage();if(t!=null)return{get:e=>{try{return t.getItem(e)}catch{return null}},set:(e,n)=>{try{t.setItem(e,n)}catch{}}}}loadFromStorage(){const t=this.store;if(t!=null)try{const e=t.get(Wn);if(typeof e!="string"||e.length===0)return;const n=JSON.parse(e);if(typeof n!="object"||n===null)return;this.stats.clear();for(const i of Object.keys(n)){const s=n[i];if(s!=null&&typeof s=="object"){const a={host:String(s.host??i),totalSuccesses:Number(s.totalSuccesses??0),totalFailures:Number(s.totalFailures??0),consecutiveFailures:Number(s.consecutiveFailures??0),avgLatencyMs:s.avgLatencyMs==null?null:Number(s.avgLatencyMs),lastLatencyMs:s.lastLatencyMs==null?null:Number(s.lastLatencyMs),backoffUntil:Number(s.backoffUntil??0),lastUpdatedAt:Number(s.lastUpdatedAt??0),lastError:typeof s.lastError=="string"?s.lastError:void 0};this.stats.set(a.host,a)}}}catch{}}saveToStorage(){const t=this.store;if(t!=null)try{const e={};for(const[n,i]of this.stats.entries())e[n]=i;t.set(Wn,JSON.stringify(e))}catch{}}computeScore(t,e){const n=t.avgLatencyMs??qn,i=t.consecutiveFailures*Qs,s=Math.min(t.totalSuccesses*Js,n/2),a=t.backoffUntil>e?t.backoffUntil-e:0;return n+i+a-s}getOrCreate(t){let e=this.stats.get(t);return e==null&&(e={host:t,totalSuccesses:0,totalFailures:0,consecutiveFailures:0,avgLatencyMs:null,lastLatencyMs:null,backoffUntil:0,lastUpdatedAt:0},this.stats.set(t,e)),e}}new ta;typeof globalThis<"u"&&typeof globalThis.fetch=="function"&&globalThis.fetch.bind(globalThis);const ea="02c1934bb9bf000bc6e232502a270b7acac1a807a2d78e6325629a6c4762907e70",ki="0d8df58c7c2b44e0bba5e9b2ec2bb42814c545eb0511c7820b2855493e13e2e1",vi="https://api.whatsonchain.com/v1/bsv/main",ye=document.getElementById("log"),zn=document.getElementById("run"),na=document.getElementById("password");function J(r,t="info"){const e=document.createElement("span");e.className=t,e.textContent=r+`
`,ye.appendChild(e),ye.scrollTop=ye.scrollHeight}async function ia(){const r=await fetch(`${vi}/script/${ki}/unspent`);if(!r.ok)throw new Error(`WoC unspent API error: ${r.status}`);return r.json()}async function ra(r){const t=await fetch(`${vi}/tx/${r}/beef`);if(!t.ok)throw new Error(`WoC BEEF API error: ${t.status}`);const e=await t.text();return x(e,"hex")}async function sa(){const r=na.value.trim();if(!r){J("Please enter the unlock password.","error");return}zn.disabled=!0,ye.innerHTML="";try{J("Connecting to wallet...");const t=new Gs;J("Checking identity key...");const{publicKey:e}=await t.getPublicKey({identityKey:!0});if(J(`Identity: ${e}`),e!==ea){J("Not authorized  identity key does not match admin key.","error");return}J("Admin key verified.","success"),J(`Fetching UTXOs for scripthash ${ki.slice(0,12)}...`);const n=await ia();if(!n.length){J("No UTXOs found for this scripthash.","error");return}n.sort((o,c)=>(o.height||1/0)-(c.height||1/0)||o.tx_pos-c.tx_pos);const i=n[0];J(`Found ${n.length} UTXO(s). Using oldest: ${i.tx_hash}:${i.tx_pos} (${i.value} sats, block ${i.height})`),J("Fetching BEEF...");const s=await ra(i.tx_hash);J(`BEEF fetched: ${s.length} bytes`,"success"),J("Calling createAction...");const a=await t.createAction({description:"Fund wallet from UTXO",inputs:[{outpoint:i.tx_hash+"."+i.tx_pos,inputDescription:"Fund wallet from secret UTXO",unlockingScript:M.fromASM(N(x(r,"utf8"))).toHex()}],inputBEEF:s});J(`txid: ${a.txid}`,"success")}catch(t){J(`Error: ${t.message||t}`,"error")}finally{zn.disabled=!1}}window.runFunding=sa;</script>
</head>
<body>
  <div class="container">
    <h1>BSV Wallet Funding</h1>
    <div id="log" class="log"></div>
    <div class="password-row">
      <input id="password" type="password" placeholder="Enter unlock password" />
      <button id="run" onclick="runFunding()">Fund Wallet</button>
    </div>
  </div>
</body>
</html>
